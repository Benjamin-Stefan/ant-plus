{"version":3,"file":"ant-plus-next.mjs","sources":["../src/types/constants.ts","../src/utils/messages.ts","../src/core/usbDriver.ts","../src/core/garminStick2.ts","../src/core/garminStick3.ts","../src/sensors/heartRate/heartRateUtils.ts","../src/sensors/heartRate/heartRateSensorState.ts","../src/sensors/heartRate/heartRateScannerState.ts","../src/sensors/baseSensor.ts","../src/sensors/antPlusBaseSensor.ts","../src/sensors/antPlusSensor.ts","../src/sensors/heartRate/heartRateSensor.ts","../src/sensors/antPlusScanner.ts","../src/sensors/heartRate/heartRateScanner.ts","../src/sensors/strideSpeedDistance/strideSpeedDistanceUtils.ts","../src/sensors/strideSpeedDistance/strideSpeedDistanceSensorState.ts","../src/sensors/strideSpeedDistance/strideSpeedDistanceScanState.ts","../src/sensors/strideSpeedDistance/strideSpeedDistanceSensor.ts","../src/sensors/strideSpeedDistance/strideSpeedDistanceScanner.ts","../src/sensors/speedCadence/speedCadenceUtils.ts","../src/sensors/speedCadence/speedCadenceSensorState.ts","../src/sensors/speedCadence/speedCadenceScanState.ts","../src/sensors/speedCadence/speedCadenceSensor.ts","../src/sensors/speedCadence/speedCadenceScanner.ts","../src/sensors/speed/speedUtils.ts","../src/sensors/speed/speedSensorState.ts","../src/sensors/speed/speedScanState.ts","../src/sensors/speed/speedSensor.ts","../src/sensors/speed/speedScanner.ts","../src/sensors/cadence/cadenceUtils.ts","../src/sensors/cadence/cadenceSensorState.ts","../src/sensors/cadence/cadenceScanState.ts","../src/sensors/cadence/cadenceSensor.ts","../src/sensors/cadence/cadenceScanner.ts","../src/sensors/bicyclePower/bicyclePowerUtils.ts","../src/sensors/bicyclePower/bicyclePowerSensorState.ts","../src/sensors/bicyclePower/bicyclePowerScanState.ts","../src/sensors/bicyclePower/bicyclePowerSensor.ts","../src/sensors/bicyclePower/bicyclePowerScanner.ts","../src/sensors/fitnessEquipment/fitnessEquipmentUtils.ts","../src/sensors/fitnessEquipment/fitnessEquipmentSensorState.ts","../src/sensors/fitnessEquipment/fitnessEquipmentScanState.ts","../src/sensors/fitnessEquipment/fitnessEquipmentSensor.ts","../src/sensors/fitnessEquipment/fitnessEquipmentScanner.ts","../src/sensors/muscleOxygen/muscleOxygenUtils.ts","../src/sensors/muscleOxygen/muscleOxygenSensorState.ts","../src/sensors/muscleOxygen/muscleOxygenScanState.ts","../src/sensors/muscleOxygen/muscleOxygenSensor.ts","../src/sensors/muscleOxygen/muscleOxygenScanner.ts","../src/sensors/environment/environmentUtils.ts","../src/sensors/environment/environmentSensorState.ts","../src/sensors/environment/environmentScanState.ts","../src/sensors/environment/environmentSensor.ts","../src/sensors/environment/environmentScanner.ts"],"sourcesContent":["/**\n * A collection of constants used in the ANT+ protocol for wireless communication.\n * These constants define various message types, configuration parameters, events,\n * and capabilities used to control and manage channels, transmit data, and handle\n * protocol-specific operations.\n *\n * @class Constants\n * @see {@link https://www.thisisant.com/developer/resources/downloads#documents} for the ANT+ protocol documentation.\n */\nexport class Constants {\n    // Message Types\n    /**\n     * Represents a generic Radio Frequency (RF) message type used in the ANT+ protocol.\n     * @type {number}\n     */\n    static readonly MESSAGE_RF: number = 0x01;\n\n    /**\n     * Represents a synchronization message used to align data transmission.\n     * @type {number}\n     */\n    static readonly MESSAGE_TX_SYNC: number = 0xa4;\n\n    /**\n     * Default network number used by ANT+ devices.\n     * @type {number}\n     */\n    static readonly DEFAULT_NETWORK_NUMBER: number = 0x00;\n\n    // Configuration Messages\n    /**\n     * Unassigns a channel, making it available for reassignment or closing.\n     * @type {number}\n     */\n    static readonly MESSAGE_CHANNEL_UNASSIGN: number = 0x41;\n\n    /**\n     * Assigns a channel with a specific type and network number.\n     * @type {number}\n     */\n    static readonly MESSAGE_CHANNEL_ASSIGN: number = 0x42;\n\n    /**\n     * Sets the unique identifier for a channel.\n     * @type {number}\n     */\n    static readonly MESSAGE_CHANNEL_ID: number = 0x51;\n\n    /**\n     * Configures the message period for a channel, defining the frequency of data messages.\n     * @type {number}\n     */\n    static readonly MESSAGE_CHANNEL_PERIOD: number = 0x43;\n\n    /**\n     * Sets the timeout period for channel searching operations.\n     * @type {number}\n     */\n    static readonly MESSAGE_CHANNEL_SEARCH_TIMEOUT: number = 0x44;\n\n    /**\n     * Configures the frequency of the channel in the RF spectrum.\n     * @type {number}\n     */\n    static readonly MESSAGE_CHANNEL_FREQUENCY: number = 0x45;\n\n    /**\n     * Sets the transmission power level for a specific channel.\n     * @type {number}\n     */\n    static readonly MESSAGE_CHANNEL_TX_POWER: number = 0x60;\n\n    /**\n     * Sets the network key for secure communication between ANT+ devices.\n     * @type {number}\n     */\n    static readonly MESSAGE_NETWORK_KEY: number = 0x46;\n\n    /**\n     * Defines the transmit power for the device.\n     * @type {number}\n     */\n    static readonly MESSAGE_TX_POWER: number = 0x47;\n\n    /**\n     * Enables proximity search for devices within a specified range.\n     * @type {number}\n     */\n    static readonly MESSAGE_PROXIMITY_SEARCH: number = 0x71;\n\n    /**\n     * Enables extended receive mode for handling additional data.\n     * @type {number}\n     */\n    static readonly MESSAGE_ENABLE_RX_EXT: number = 0x66;\n\n    /**\n     * Configures the library settings for ANT+ communication.\n     * @type {number}\n     */\n    static readonly MESSAGE_LIB_CONFIG: number = 0x6e;\n\n    /**\n     * Opens a channel for RX scan mode, allowing the device to search for broadcasts.\n     * @type {number}\n     */\n    static readonly MESSAGE_CHANNEL_OPEN_RX_SCAN: number = 0x5b;\n\n    // Notifications\n    /**\n     * Indicates a startup event, typically sent after a device reset or initialization.\n     * @type {number}\n     */\n    static readonly MESSAGE_STARTUP: number = 0x6f;\n\n    // Control Messages\n    /**\n     * Resets the ANT+ device system.\n     * @type {number}\n     */\n    static readonly MESSAGE_SYSTEM_RESET: number = 0x4a;\n\n    /**\n     * Opens a communication channel for data transmission.\n     * @type {number}\n     */\n    static readonly MESSAGE_CHANNEL_OPEN: number = 0x4b;\n\n    /**\n     * Closes a previously opened communication channel.\n     * @type {number}\n     */\n    static readonly MESSAGE_CHANNEL_CLOSE: number = 0x4c;\n\n    /**\n     * Requests a specific operation or status update for a channel.\n     * @type {number}\n     */\n    static readonly MESSAGE_CHANNEL_REQUEST: number = 0x4d;\n\n    // Data Messages\n    /**\n     * Transmits broadcast data over an open channel.\n     * @type {number}\n     */\n    static readonly MESSAGE_CHANNEL_BROADCAST_DATA: number = 0x4e;\n\n    /**\n     * Sends acknowledged data that requires a response confirmation.\n     * @type {number}\n     */\n    static readonly MESSAGE_CHANNEL_ACKNOWLEDGED_DATA: number = 0x4f;\n\n    /**\n     * Sends burst data packets over a channel, useful for high-throughput scenarios.\n     * @type {number}\n     */\n    static readonly MESSAGE_CHANNEL_BURST_DATA: number = 0x50;\n\n    // Channel Event Messages\n    /**\n     * Represents various events occurring on a channel, such as RX or TX completion.\n     * @type {number}\n     */\n    static readonly MESSAGE_CHANNEL_EVENT: number = 0x40;\n\n    // Requested Response Messages\n    /**\n     * Queries the status of a channel, returning details like state or assigned ID.\n     * @type {number}\n     */\n    static readonly MESSAGE_CHANNEL_STATUS: number = 0x52;\n\n    /**\n     * Retrieves the version of the ANT+ device software or protocol.\n     * @type {number}\n     */\n    static readonly MESSAGE_VERSION: number = 0x3e;\n\n    /**\n     * Retrieves the capabilities of the ANT+ device, such as supported features.\n     * @type {number}\n     */\n    static readonly MESSAGE_CAPABILITIES: number = 0x54;\n\n    /**\n     * Retrieves the unique serial number of the ANT+ device.\n     * @type {number}\n     */\n    static readonly MESSAGE_SERIAL_NUMBER: number = 0x61;\n\n    // Message Parameters\n    /**\n     * Channel type for two-way data reception.\n     * @type {number}\n     */\n    static readonly CHANNEL_TYPE_TWOWAY_RECEIVE: number = 0x00;\n\n    /**\n     * Channel type for two-way data transmission.\n     * @type {number}\n     */\n    static readonly CHANNEL_TYPE_TWOWAY_TRANSMIT: number = 0x10;\n\n    /**\n     * Channel type for shared data reception.\n     * @type {number}\n     */\n    static readonly CHANNEL_TYPE_SHARED_RECEIVE: number = 0x20;\n\n    /**\n     * Channel type for shared data transmission.\n     * @type {number}\n     */\n    static readonly CHANNEL_TYPE_SHARED_TRANSMIT: number = 0x30;\n\n    /**\n     * Channel type for one-way data reception.\n     * @type {number}\n     */\n    static readonly CHANNEL_TYPE_ONEWAY_RECEIVE: number = 0x40;\n\n    /**\n     * Channel type for one-way data transmission.\n     * @type {number}\n     */\n    static readonly CHANNEL_TYPE_ONEWAY_TRANSMIT: number = 0x50;\n\n    /**\n     * Radio transmit power level: -20 dB.\n     * @type {number}\n     */\n    static readonly RADIO_TX_POWER_MINUS20DB: number = 0x00;\n\n    /**\n     * Radio transmit power level: -10 dB.\n     * @type {number}\n     */\n    static readonly RADIO_TX_POWER_MINUS10DB: number = 0x01;\n\n    /**\n     * Radio transmit power level: 0 dB.\n     * @type {number}\n     */\n    static readonly RADIO_TX_POWER_0DB: number = 0x02;\n\n    /**\n     * Radio transmit power level: +4 dB.\n     * @type {number}\n     */\n    static readonly RADIO_TX_POWER_PLUS4DB: number = 0x03;\n\n    // Event Codes\n    /**\n     * No error occurred in the response.\n     * @type {number}\n     */\n    static readonly RESPONSE_NO_ERROR: number = 0x00;\n\n    /**\n     * RX search timed out.\n     * @type {number}\n     */\n    static readonly EVENT_RX_SEARCH_TIMEOUT: number = 0x01;\n\n    /**\n     * RX failed.\n     * @type {number}\n     */\n    static readonly EVENT_RX_FAIL: number = 0x02;\n\n    /**\n     * TX completed successfully.\n     * @type {number}\n     */\n    static readonly EVENT_TX: number = 0x03;\n\n    /**\n     * Transfer RX failed.\n     * @type {number}\n     */\n    static readonly EVENT_TRANSFER_RX_FAILED: number = 0x04;\n\n    /**\n     * Transfer TX completed successfully.\n     * @type {number}\n     */\n    static readonly EVENT_TRANSFER_TX_COMPLETED: number = 0x05;\n\n    /**\n     * Transfer TX failed.\n     * @type {number}\n     */\n    static readonly EVENT_TRANSFER_TX_FAILED: number = 0x06;\n\n    /**\n     * Channel was closed.\n     * @type {number}\n     */\n    static readonly EVENT_CHANNEL_CLOSED: number = 0x07;\n\n    /**\n     * RX failed; channel will go to search.\n     * @type {number}\n     */\n    static readonly EVENT_RX_FAIL_GO_TO_SEARCH: number = 0x08;\n\n    /**\n     * Channel collision detected.\n     * @type {number}\n     */\n    static readonly EVENT_CHANNEL_COLLISION: number = 0x09;\n\n    /**\n     * Transfer TX started.\n     * @type {number}\n     */\n    static readonly EVENT_TRANSFER_TX_START: number = 0x0a;\n\n    // Error and State Codes\n    /**\n     * Channel is in the wrong state for the requested operation.\n     * @type {number}\n     */\n    static readonly CHANNEL_IN_WRONG_STATE: number = 0x15;\n\n    /**\n     * Channel is not opened.\n     * @type {number}\n     */\n    static readonly CHANNEL_NOT_OPENED: number = 0x16;\n\n    /**\n     * Channel ID is not set.\n     * @type {number}\n     */\n    static readonly CHANNEL_ID_NOT_SET: number = 0x18;\n\n    /**\n     * Command to close all channels.\n     * @type {number}\n     */\n    static readonly CLOSE_ALL_CHANNELS: number = 0x19;\n\n    /**\n     * Transfer is currently in progress.\n     * @type {number}\n     */\n    static readonly TRANSFER_IN_PROGRESS: number = 0x1f;\n\n    /**\n     * Transfer sequence number error.\n     * @type {number}\n     */\n    static readonly TRANSFER_SEQUENCE_NUMBER_ERROR: number = 0x20;\n\n    /**\n     * Transfer is in an error state.\n     * @type {number}\n     */\n    static readonly TRANSFER_IN_ERROR: number = 0x21;\n\n    /**\n     * Message size exceeds allowed limit.\n     * @type {number}\n     */\n    static readonly MESSAGE_SIZE_EXCEEDS_LIMIT: number = 0x27;\n\n    /**\n     * Invalid message received.\n     * @type {number}\n     */\n    static readonly INVALID_MESSAGE: number = 0x28;\n\n    /**\n     * Invalid network number provided.\n     * @type {number}\n     */\n    static readonly INVALID_NETWORK_NUMBER: number = 0x29;\n\n    /**\n     * Invalid list ID provided.\n     * @type {number}\n     */\n    static readonly INVALID_LIST_ID: number = 0x30;\n\n    /**\n     * Invalid scan TX channel specified.\n     * @type {number}\n     */\n    static readonly INVALID_SCAN_TX_CHANNEL: number = 0x31;\n\n    /**\n     * Invalid parameter provided for a message or operation.\n     * @type {number}\n     */\n    static readonly INVALID_PARAMETER_PROVIDED: number = 0x33;\n\n    /**\n     * Event queue overflow occurred.\n     * @type {number}\n     */\n    static readonly EVENT_QUEUE_OVERFLOW: number = 0x35;\n\n    /**\n     * USB string write operation failed.\n     * @type {number}\n     */\n    static readonly USB_STRING_WRITE_FAIL: number = 0x70;\n\n    // Channel States\n    /**\n     * Channel is unassigned.\n     * @type {number}\n     */\n    static readonly CHANNEL_STATE_UNASSIGNED: number = 0x00;\n\n    /**\n     * Channel is assigned.\n     * @type {number}\n     */\n    static readonly CHANNEL_STATE_ASSIGNED: number = 0x01;\n\n    /**\n     * Channel is searching for another device.\n     * @type {number}\n     */\n    static readonly CHANNEL_STATE_SEARCHING: number = 0x02;\n\n    /**\n     * Channel is tracking another device.\n     * @type {number}\n     */\n    static readonly CHANNEL_STATE_TRACKING: number = 0x03;\n\n    // Capability Flags\n    /**\n     * Device has no receive channels.\n     * @type {number}\n     */\n    static readonly CAPABILITIES_NO_RECEIVE_CHANNELS: number = 0x01;\n\n    /**\n     * Device has no transmit channels.\n     * @type {number}\n     */\n    static readonly CAPABILITIES_NO_TRANSMIT_CHANNELS: number = 0x02;\n\n    /**\n     * Device has no receive message capability.\n     * @type {number}\n     */\n    static readonly CAPABILITIES_NO_RECEIVE_MESSAGES: number = 0x04;\n\n    /**\n     * Device has no transmit message capability.\n     * @type {number}\n     */\n    static readonly CAPABILITIES_NO_TRANSMIT_MESSAGES: number = 0x08;\n\n    /**\n     * Device has no acknowledged message capability.\n     * @type {number}\n     */\n    static readonly CAPABILITIES_NO_ACKNOWLEDGED_MESSAGES: number = 0x10;\n\n    /**\n     * Device has no burst message capability.\n     * @type {number}\n     */\n    static readonly CAPABILITIES_NO_BURST_MESSAGES: number = 0x20;\n\n    /**\n     * Device supports network communication.\n     * @type {number}\n     */\n    static readonly CAPABILITIES_NETWORK_ENABLED: number = 0x02;\n\n    /**\n     * Device serial number feature enabled.\n     * @type {number}\n     */\n    static readonly CAPABILITIES_SERIAL_NUMBER_ENABLED: number = 0x08;\n\n    /**\n     * Per-channel transmit power adjustment enabled.\n     * @type {number}\n     */\n    static readonly CAPABILITIES_PER_CHANNEL_TX_POWER_ENABLED: number = 0x10;\n\n    /**\n     * Low priority search capability enabled.\n     * @type {number}\n     */\n    static readonly CAPABILITIES_LOW_PRIORITY_SEARCH_ENABLED: number = 0x20;\n\n    /**\n     * Script feature enabled.\n     * @type {number}\n     */\n    static readonly CAPABILITIES_SCRIPT_ENABLED: number = 0x40;\n\n    /**\n     * Search list capability enabled.\n     * @type {number}\n     */\n    static readonly CAPABILITIES_SEARCH_LIST_ENABLED: number = 0x80;\n\n    /**\n     * LED feature enabled.\n     * @type {number}\n     */\n    static readonly CAPABILITIES_LED_ENABLED: number = 0x01;\n\n    /**\n     * Extended messaging enabled.\n     * @type {number}\n     */\n    static readonly CAPABILITIES_EXT_MESSAGE_ENABLED: number = 0x02;\n\n    /**\n     * Scan mode enabled.\n     * @type {number}\n     */\n    static readonly CAPABILITIES_SCAN_MODE_ENABLED: number = 0x04;\n\n    /**\n     * Proximity search capability enabled.\n     * @type {number}\n     */\n    static readonly CAPABILITIES_PROX_SEARCH_ENABLED: number = 0x10;\n\n    /**\n     * Extended channel assignment enabled.\n     * @type {number}\n     */\n    static readonly CAPABILITIES_EXT_ASSIGN_ENABLED: number = 0x20;\n\n    /**\n     * File share (ANT-FS) feature enabled.\n     * @type {number}\n     */\n    static readonly CAPABILITIES_FS_ANTFS_ENABLED: number = 0x40;\n\n    // Miscellaneous\n    /**\n     * Special value indicating that the timeout for an operation is set to never expire.\n     * @type {number}\n     */\n    static readonly TIMEOUT_NEVER: number = 0xff;\n}\n","import { Constants } from \"../types/constants.js\";\n\nexport class Messages {\n    static BUFFER_INDEX_MSG_LEN: number = 1;\n    static BUFFER_INDEX_MSG_TYPE: number = 2;\n    static BUFFER_INDEX_CHANNEL_NUM: number = 3;\n    static BUFFER_INDEX_MSG_DATA: number = 4;\n    static BUFFER_INDEX_EXT_MSG_BEGIN: number = 12;\n\n    static resetSystem(): Buffer {\n        const payload: number[] = [];\n        payload.push(0x00);\n        return this.buildMessage(payload, Constants.MESSAGE_SYSTEM_RESET);\n    }\n\n    static requestMessage(channel: number, messageId: number): Buffer {\n        let payload: number[] = [];\n        payload = payload.concat(this.intToLEHexArray(channel));\n        payload.push(messageId);\n        return this.buildMessage(payload, Constants.MESSAGE_CHANNEL_REQUEST);\n    }\n\n    static setNetworkKey(): Buffer {\n        const payload: number[] = [];\n        payload.push(Constants.DEFAULT_NETWORK_NUMBER);\n        payload.push(0xb9);\n        payload.push(0xa5);\n        payload.push(0x21);\n        payload.push(0xfb);\n        payload.push(0xbd);\n        payload.push(0x72);\n        payload.push(0xc3);\n        payload.push(0x45);\n        return this.buildMessage(payload, Constants.MESSAGE_NETWORK_KEY);\n    }\n\n    static assignChannel(channel: number, type = \"receive\"): Buffer {\n        let payload: number[] = [];\n        payload = payload.concat(this.intToLEHexArray(channel));\n        if (type === \"receive\") {\n            payload.push(Constants.CHANNEL_TYPE_TWOWAY_RECEIVE);\n        } else if (type === \"receive_only\") {\n            payload.push(Constants.CHANNEL_TYPE_ONEWAY_RECEIVE);\n        } else if (type === \"receive_shared\") {\n            payload.push(Constants.CHANNEL_TYPE_SHARED_RECEIVE);\n        } else if (type === \"transmit\") {\n            payload.push(Constants.CHANNEL_TYPE_TWOWAY_TRANSMIT);\n        } else if (type === \"transmit_only\") {\n            payload.push(Constants.CHANNEL_TYPE_ONEWAY_TRANSMIT);\n        } else if (type === \"transmit_shared\") {\n            payload.push(Constants.CHANNEL_TYPE_SHARED_TRANSMIT);\n        } else {\n            throw new Error(\"type not allowed\");\n        }\n        payload.push(Constants.DEFAULT_NETWORK_NUMBER);\n        return this.buildMessage(payload, Constants.MESSAGE_CHANNEL_ASSIGN);\n    }\n\n    static setDevice(channel: number, deviceId: number, deviceType: number, transmissionType: number): Buffer {\n        let payload: number[] = [];\n        payload = payload.concat(this.intToLEHexArray(channel));\n        payload = payload.concat(this.intToLEHexArray(deviceId, 2));\n        payload = payload.concat(this.intToLEHexArray(deviceType));\n        payload = payload.concat(this.intToLEHexArray(transmissionType));\n        return this.buildMessage(payload, Constants.MESSAGE_CHANNEL_ID);\n    }\n\n    static searchChannel(channel: number, timeout: number): Buffer {\n        let payload: number[] = [];\n        payload = payload.concat(this.intToLEHexArray(channel));\n        payload = payload.concat(this.intToLEHexArray(timeout));\n        return this.buildMessage(payload, Constants.MESSAGE_CHANNEL_SEARCH_TIMEOUT);\n    }\n\n    static setPeriod(channel: number, period: number): Buffer {\n        let payload: number[] = [];\n        payload = payload.concat(this.intToLEHexArray(channel));\n        payload = payload.concat(this.intToLEHexArray(period));\n        return this.buildMessage(payload, Constants.MESSAGE_CHANNEL_PERIOD);\n    }\n\n    static setFrequency(channel: number, frequency: number): Buffer {\n        let payload: number[] = [];\n        payload = payload.concat(this.intToLEHexArray(channel));\n        payload = payload.concat(this.intToLEHexArray(frequency));\n        return this.buildMessage(payload, Constants.MESSAGE_CHANNEL_FREQUENCY);\n    }\n\n    static setRxExt(): Buffer {\n        let payload: number[] = [];\n        payload = payload.concat(this.intToLEHexArray(0));\n        payload = payload.concat(this.intToLEHexArray(1));\n        return this.buildMessage(payload, Constants.MESSAGE_ENABLE_RX_EXT);\n    }\n\n    static libConfig(channel: number, how: number): Buffer {\n        let payload: number[] = [];\n        payload = payload.concat(this.intToLEHexArray(channel));\n        payload = payload.concat(this.intToLEHexArray(how));\n        return this.buildMessage(payload, Constants.MESSAGE_LIB_CONFIG);\n    }\n\n    static openRxScan(): Buffer {\n        let payload: number[] = [];\n        payload = payload.concat(this.intToLEHexArray(0));\n        payload = payload.concat(this.intToLEHexArray(1));\n        return this.buildMessage(payload, Constants.MESSAGE_CHANNEL_OPEN_RX_SCAN);\n    }\n\n    static openChannel(channel: number): Buffer {\n        let payload: number[] = [];\n        payload = payload.concat(this.intToLEHexArray(channel));\n        return this.buildMessage(payload, Constants.MESSAGE_CHANNEL_OPEN);\n    }\n\n    static closeChannel(channel: number): Buffer {\n        let payload: number[] = [];\n        payload = payload.concat(this.intToLEHexArray(channel));\n        return this.buildMessage(payload, Constants.MESSAGE_CHANNEL_CLOSE);\n    }\n\n    static unassignChannel(channel: number): Buffer {\n        let payload: number[] = [];\n        payload = payload.concat(this.intToLEHexArray(channel));\n        return this.buildMessage(payload, Constants.MESSAGE_CHANNEL_UNASSIGN);\n    }\n\n    static acknowledgedData(channel: number, payload: number[]): Buffer {\n        payload = this.intToLEHexArray(channel).concat(payload);\n        return this.buildMessage(payload, Constants.MESSAGE_CHANNEL_ACKNOWLEDGED_DATA);\n    }\n\n    static broadcastData(channel: number, payload: number[]): Buffer {\n        payload = this.intToLEHexArray(channel).concat(payload);\n        return this.buildMessage(payload, Constants.MESSAGE_CHANNEL_BROADCAST_DATA);\n    }\n\n    static buildMessage(payload: number[] = [], messageId = 0x00): Buffer {\n        const message: number[] = [];\n        message.push(Constants.MESSAGE_TX_SYNC);\n        message.push(payload.length);\n        message.push(messageId);\n        payload.forEach((byte) => {\n            message.push(byte);\n        });\n        message.push(this.getChecksum(message));\n\n        return Buffer.from(message);\n    }\n\n    static intToLEHexArray(int: number, numBytes = 1): number[] {\n        numBytes = numBytes || 1;\n        const a: number[] = [];\n        const b = Buffer.from(this.decimalToHex(int, numBytes * 2), \"hex\");\n        let i = b.length - 1;\n        while (i >= 0) {\n            a.push(b[i]);\n            i--;\n        }\n\n        return a;\n    }\n\n    static decimalToHex(d: number, numDigits: number): string {\n        let hex = Number(d).toString(16);\n        numDigits = numDigits || 2;\n        while (hex.length < numDigits) {\n            hex = \"0\" + hex;\n        }\n\n        return hex;\n    }\n\n    static getChecksum(message: number[]): number {\n        let checksum = 0;\n        message.forEach((byte) => {\n            checksum = (checksum ^ byte) % 0xff;\n        });\n\n        return checksum;\n    }\n}\n","import { EventEmitter } from \"events\";\nimport * as usb from \"usb\";\nimport { Constants } from \"../types/constants.js\";\nimport { Messages } from \"../utils/messages.js\";\nimport { BaseSensor } from \"../sensors/baseSensor.js\";\nimport { DebugOptions } from \"../types/debugOptions.js\";\n\n/**\n * Class representing a USB driver that handles communication with USB devices.\n * Extends EventEmitter to emit various events related to USB operations.\n */\nexport class USBDriver extends EventEmitter {\n    private static deviceInUse: usb.Device[] = [];\n    private device: usb.Device | undefined;\n    private iface: usb.Interface | undefined;\n    private detachedKernelDriver = false;\n    private inEndpoint: (usb.InEndpoint & EventEmitter) | undefined;\n    private outEndpoint: (usb.OutEndpoint & EventEmitter) | undefined;\n    private leftover: Buffer | undefined;\n    private usedChannels: number = 0;\n    private attachedSensors: BaseSensor[] = [];\n\n    maxChannels: number = 0;\n    canScan: boolean = false;\n\n    /**\n     * Creates an instance of USBDriver.\n     *\n     * @param {number} idVendor - The vendor ID of the USB device.\n     * @param {number} idProduct - The product ID of the USB device.\n     * @param {DebugOptions} [debugOptions={}] - Optional debug options for USB operations.\n     */\n    constructor(\n        private idVendor: number,\n        private idProduct: number,\n        debugOptions: DebugOptions = {}\n    ) {\n        super();\n        this.setMaxListeners(50);\n        usb.usb.setDebugLevel(debugOptions.usbDebugLevel || 0);\n    }\n\n    /**\n     * Retrieves a list of USB devices matching the specified vendor and product IDs.\n     *\n     * @private\n     * @returns {usb.usb.Device[]} An array of USB devices that match the specified criteria.\n     */\n    private getDevices(): usb.usb.Device[] {\n        const allDevices = usb.getDeviceList();\n\n        return allDevices.filter((d) => d.deviceDescriptor.idVendor === this.idVendor && d.deviceDescriptor.idProduct === this.idProduct).filter((d) => USBDriver.deviceInUse.indexOf(d) === -1);\n    }\n\n    /**\n     * Checks if a USB device matching the specified criteria is present.\n     *\n     * @returns {boolean} True if a matching device is present; otherwise, false.\n     *\n     * @example\n     * ```typescript\n     * if (usbDriver.isPresent()) {\n     *   console.log(\"Device is present.\");\n     * }\n     * ```\n     */\n    public isPresent(): boolean {\n        return this.getDevices().length > 0;\n    }\n\n    /**\n     * Opens a connection to a matching USB device and initializes the interface.\n     *\n     * @returns {boolean} True if a device is successfully opened; otherwise, false.\n     *\n     * @example\n     * ```typescript\n     * if (usbDriver.open()) {\n     *   console.log(\"Device opened successfully.\");\n     * } else {\n     *   console.log(\"Failed to open device.\");\n     * }\n     * ```\n     */\n    public open(): boolean {\n        const devices = this.getDevices();\n\n        while (devices.length) {\n            try {\n                const device = devices.shift();\n                if (!device) {\n                    continue;\n                }\n\n                this.device = device;\n                this.device.open();\n                this.iface = this.device.interfaces![0];\n\n                try {\n                    if (this.iface && this.iface.isKernelDriverActive()) {\n                        this.detachedKernelDriver = true;\n                        this.iface.detachKernelDriver();\n                    }\n                } catch {\n                    // Ignore kernel driver errors;\n                }\n\n                this.iface.claim();\n                break;\n            } catch {\n                // Ignore the error and try with the next device, if present\n                if (this.device) {\n                    this.device.close();\n                }\n\n                this.device = undefined;\n                this.iface = undefined;\n            }\n        }\n\n        if (!this.device) {\n            return false;\n        }\n\n        USBDriver.deviceInUse.push(this.device);\n\n        if (!this.iface) {\n            throw new Error(\"Interface not initialized.\");\n        }\n\n        this.inEndpoint = this.iface.endpoints[0] as usb.InEndpoint;\n\n        this.inEndpoint.on(\"data\", (data: Buffer) => {\n            if (!data.length) {\n                return;\n            }\n\n            if (this.leftover) {\n                data = Buffer.concat([this.leftover, data]);\n                this.leftover = undefined;\n            }\n\n            if (data.readUInt8(0) !== 0xa4) {\n                throw new Error(\"SYNC missing\");\n            }\n\n            const len = data.length;\n            let beginBlock = 0;\n            while (beginBlock < len) {\n                if (beginBlock + 1 === len) {\n                    this.leftover = data.slice(beginBlock);\n                    break;\n                }\n                const blockLen = data.readUInt8(beginBlock + 1);\n                const endBlock = beginBlock + blockLen + 4;\n                if (endBlock > len) {\n                    this.leftover = data.slice(beginBlock);\n                    break;\n                }\n                const readData = data.slice(beginBlock, endBlock);\n                this.read(readData);\n                beginBlock = endBlock;\n            }\n        });\n\n        this.inEndpoint.on(\"error\", (err: Error) => {\n            console.error(\"ERROR RECV: \", err);\n        });\n\n        this.inEndpoint.on(\"end\", () => {\n            //console.info(\"STOP RECV\");\n        });\n\n        this.inEndpoint.startPoll();\n\n        this.outEndpoint = this.iface.endpoints[1] as usb.OutEndpoint;\n\n        this.reset();\n\n        return true;\n    }\n\n    /**\n     * Asynchronously opens a connection to a USB device and listens for the \"attach\" event.\n     *\n     * @param {AbortSignal} signal - An AbortSignal to control the asynchronous operation.\n     * @returns {Promise<void>} A promise that resolves when the connection is successfully opened.\n     *\n     * @example\n     * ```typescript\n     * const controller = new AbortController();\n     * usbDriver.openAsync(controller.signal).catch(console.error);\n     * ```\n     */\n    public async openAsync(signal: AbortSignal): Promise<void> {\n        const controller = new AbortController();\n        signal.addEventListener(\"abort\", () => controller.abort());\n\n        const doOpen = (): Promise<void> => {\n            return new Promise((resolve, reject) => {\n                try {\n                    const result = this.open();\n                    if (result) {\n                        resolve();\n                    } else {\n                        reject(new Error(\"Open failed\"));\n                    }\n                } catch (err) {\n                    reject(err instanceof Error ? err : new Error(\"Unknown error\"));\n                }\n            });\n        };\n\n        const fn = (d: usb.Device) => {\n            if (!d || (d.deviceDescriptor.idVendor === this.idVendor && d.deviceDescriptor.idProduct === this.idProduct)) {\n                doOpen()\n                    .then(() => {\n                        usb.usb.removeListener(\"attach\", fn);\n                    })\n                    .catch((err) => {\n                        if (!controller.signal.aborted) {\n                            console.error(err); // handle errors\n                        }\n                    });\n            }\n        };\n\n        usb.usb.on(\"attach\", fn);\n        if (this.isPresent()) {\n            setImmediate(() => usb.usb.emit(\"attach\", this.device!));\n        }\n\n        await new Promise<void>((resolve, reject) => {\n            controller.signal.addEventListener(\"abort\", () => {\n                usb.usb.removeListener(\"attach\", fn);\n                reject(new Error(\"Operation canceled\"));\n            });\n        });\n    }\n\n    /**\n     * Closes the connection to the USB device and releases all resources.\n     */\n    public close() {\n        this.detach_all();\n        if (this.inEndpoint) {\n            this.inEndpoint.stopPoll(() => {\n                if (this.iface) {\n                    this.iface.release(true, () => {\n                        if (this.detachedKernelDriver) {\n                            this.detachedKernelDriver = false;\n                            try {\n                                this.iface?.attachKernelDriver();\n                            } catch {\n                                // Ignore kernel driver errors;\n                            }\n                        }\n                        this.iface = undefined;\n                        if (this.device) {\n                            this.device.reset(() => {\n                                this.device?.close();\n                                this.emit(\"shutdown\");\n                                const devIdx = USBDriver.deviceInUse.indexOf(this.device!);\n                                if (devIdx >= 0) {\n                                    USBDriver.deviceInUse.splice(devIdx, 1);\n                                }\n                                if (usb.usb.listenerCount(\"attach\")) {\n                                    usb.usb.emit(\"attach\", this.device!);\n                                }\n                                this.device = undefined;\n                            });\n                        }\n                    });\n                }\n            });\n        }\n    }\n\n    /**\n     * Resets the USB device and prepares it for operation.\n     */\n    public reset() {\n        this.detach_all();\n        this.maxChannels = 0;\n        this.usedChannels = 0;\n        this.write(Messages.resetSystem());\n    }\n\n    /**\n     * Checks if the device is currently in scanning mode.\n     *\n     * @returns {boolean} True if the device is scanning; otherwise, false.\n     */\n    public isScanning(): boolean {\n        return this.usedChannels === -1;\n    }\n\n    /**\n     * Attaches a sensor to the USB driver for data handling.\n     *\n     * @param {BaseSensor} sensor - The sensor to attach.\n     * @param {boolean} forScan - Indicates if the attachment is for scanning purposes.\n     * @returns {boolean} True if the sensor is successfully attached; otherwise, false.\n     */\n    public attach(sensor: BaseSensor, forScan: boolean): boolean {\n        if (this.usedChannels < 0) {\n            return false;\n        }\n        if (forScan) {\n            if (this.usedChannels !== 0) {\n                return false;\n            }\n\n            this.usedChannels = -1;\n        } else {\n            if (this.maxChannels <= this.usedChannels) {\n                return false;\n            }\n\n            ++this.usedChannels;\n        }\n\n        this.attachedSensors.push(sensor);\n\n        return true;\n    }\n\n    /**\n     * Detaches a sensor from the USB driver.\n     *\n     * @param {BaseSensor} sensor - The sensor to detach.\n     * @returns {boolean} True if the sensor is successfully detached; otherwise, false.\n     */\n    public detach(sensor: BaseSensor): boolean {\n        const idx = this.attachedSensors.indexOf(sensor);\n        if (idx < 0) {\n            return false;\n        }\n\n        if (this.usedChannels < 0) {\n            this.usedChannels = 0;\n        } else {\n            --this.usedChannels;\n        }\n\n        this.attachedSensors.splice(idx, 1);\n\n        return true;\n    }\n\n    /**\n     * Detaches all sensors from the USB driver.\n     */\n    public detach_all() {\n        const copy = this.attachedSensors;\n        copy.forEach((sensor: BaseSensor) => sensor.detach());\n    }\n\n    /**\n     * Writes data to the USB device's output endpoint.\n     *\n     * @param {Buffer} data - The data buffer to write to the output endpoint.\n     */\n    public write(data: Buffer) {\n        if (this.outEndpoint) {\n            //console.debug(\"DATA SEND: \", data);\n            this.outEndpoint.transfer(data, (error) => {\n                if (error) {\n                    console.error(\"ERROR SEND: \", error);\n                }\n            });\n        }\n    }\n\n    /**\n     * Reads data from the USB device's input endpoint and handles it accordingly.\n     *\n     * @param {Buffer} data - The data buffer received from the input endpoint.\n     */\n    public read(data: Buffer) {\n        //console.debug(\"DATA RECV: \", data);\n        const messageId = data.readUInt8(2);\n        if (messageId === Constants.MESSAGE_STARTUP) {\n            this.write(Messages.requestMessage(0, Constants.MESSAGE_CAPABILITIES));\n        } else if (messageId === Constants.MESSAGE_CAPABILITIES) {\n            this.maxChannels = data.readUInt8(3);\n            this.canScan = (data.readUInt8(7) & 0x06) === 0x06;\n            this.write(Messages.setNetworkKey());\n        } else if (messageId === Constants.MESSAGE_CHANNEL_EVENT && data.readUInt8(4) === Constants.MESSAGE_NETWORK_KEY) {\n            this.emit(\"startup\", data);\n        } else {\n            this.emit(\"read\", data);\n        }\n    }\n}\n","import { DebugOptions } from \"../types/debugOptions.js\";\nimport { USBDriver } from \"./usbDriver.js\";\n\n/**\n * Class representing a Garmin Stick 2 USB driver, which extends the base USBDriver class.\n */\nexport class GarminStick2 extends USBDriver {\n    /**\n     * Creates an instance of GarminStick2.\n     *\n     * @param {DebugOptions} [debugOptions={}] - Optional debug options for USB operations.\n     *\n     * @example\n     * ```typescript\n     * const garminStick = new GarminStick2();\n     * garminStick.open(); // Opens the connection to the Garmin Stick 2 device.\n     * ```\n     */\n    constructor(debugOptions: DebugOptions = {}) {\n        super(0x0fcf, 0x1008, debugOptions);\n    }\n}\n","import { DebugOptions } from \"../types/debugOptions.js\";\nimport { USBDriver } from \"./usbDriver.js\";\n\n/**\n * Class representing a Garmin Stick 3 USB driver, which extends the base USBDriver class.\n */\nexport class GarminStick3 extends USBDriver {\n    /**\n     * Creates an instance of GarminStick3.\n     *\n     * @param {DebugOptions} [debugOptions={}] - Optional debug options for USB operations.\n     *\n     * @example\n     * ```typescript\n     * const garminStick = new GarminStick3({ usbDebugLevel: 1 });\n     * garminStick.open(); // Opens the connection to the Garmin Stick 3 device.\n     * ```\n     */\n    constructor(debugOptions: DebugOptions = {}) {\n        super(0x0fcf, 0x1009, debugOptions);\n    }\n}\n","import { HeartRateScanner } from \"./heartRateScanner.js\";\r\nimport { HeartRateScannerState } from \"./heartRateScannerState.js\";\r\nimport { HeartRateSensor } from \"./heartRateSensor.js\";\r\nimport { HeartRateSensorState } from \"./heartRateSensorState.js\";\r\nimport { Messages } from \"../../utils/messages.js\";\r\n\r\nexport enum PageState {\r\n    INIT_PAGE,\r\n    STD_PAGE,\r\n    EXT_PAGE,\r\n}\r\n\r\nexport type Page = {\r\n    oldPage: number;\r\n    pageState: PageState; // sets the state of the receiver - INIT, STD_PAGE, EXT_PAGE\r\n};\r\n\r\nconst TOGGLE_MASK = 0x80;\r\n\r\n/**\r\n * Updates the state of a Heart Rate sensor or scanner based on incoming data.\r\n * Decodes various pages of data to update the state, including operating time, manufacturer details,\r\n * battery status, heart rate data, and more.\r\n *\r\n * @param {HeartRateSensor | HeartRateScanner} sensor - The sensor or scanner instance emitting the data.\r\n * @param {HeartRateSensorState | HeartRateScannerState} state - The current state of the sensor or scanner.\r\n * @param {Page} page - The page information containing the current and old page number.\r\n * @param {Buffer} data - The raw data buffer received from the sensor.\r\n * @returns {void}\r\n *\r\n * @example\r\n * const sensor = new HeartRateSensor();\r\n * const state = new HeartRateSensorState(12345);\r\n * const page = { oldPage: 0, pageState: PageState.INIT_PAGE };\r\n * const dataBuffer = getDataFromSensor(); // Assume this function gets data from a sensor\r\n * updateState(sensor, state, page, dataBuffer);\r\n */\r\nexport function updateState(sensor: HeartRateSensor | HeartRateScanner, state: HeartRateSensorState | HeartRateScannerState, page: Page, data: Buffer): void {\r\n    const pageNum = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA);\r\n    if (page.pageState === PageState.INIT_PAGE) {\r\n        page.pageState = PageState.STD_PAGE; // change the state to STD_PAGE and allow the checking of old and new pages\r\n    } else if (pageNum !== page.oldPage || page.pageState === PageState.EXT_PAGE) {\r\n        page.pageState = PageState.EXT_PAGE; // set the state to use the extended page format\r\n        switch (\r\n            pageNum & ~TOGGLE_MASK // Check the new pages and remove the toggle bit\r\n        ) {\r\n            case 1:\r\n                // Decode the cumulative operating time\r\n                state.OperatingTime = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 1);\r\n                state.OperatingTime |= data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 2) << 8;\r\n                state.OperatingTime |= data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 3) << 16;\r\n                state.OperatingTime *= 2;\r\n                break;\r\n            case 2:\r\n                // Decode the Manufacturer ID\r\n                state.ManId = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 1);\r\n                // Decode the 4-byte serial number\r\n                state.SerialNumber = state.DeviceId;\r\n                state.SerialNumber |= data.readUInt16LE(Messages.BUFFER_INDEX_MSG_DATA + 2) << 16;\r\n                state.SerialNumber >>>= 0;\r\n                break;\r\n            case 3:\r\n                // Decode hardware version, software version, and model number\r\n                state.HwVersion = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 1);\r\n                state.SwVersion = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 2);\r\n                state.ModelNum = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 3);\r\n                break;\r\n            case 4:\r\n                // Decode the previous heart beat measurement time\r\n                state.PreviousBeat = data.readUInt16LE(Messages.BUFFER_INDEX_MSG_DATA + 2);\r\n                break;\r\n            case 5:\r\n                state.IntervalAverage = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 1);\r\n                state.IntervalMax = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 2);\r\n                state.SessionAverage = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 3);\r\n                break;\r\n            case 6:\r\n                state.SupportedFeatures = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 2);\r\n                state.EnabledFeatures = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 3);\r\n                break;\r\n            case 7: {\r\n                const batteryLevel = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 1);\r\n                const batteryFrac = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 2);\r\n                const batteryStatus = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 3);\r\n                if (batteryLevel !== 0xff) {\r\n                    state.BatteryLevel = batteryLevel;\r\n                }\r\n                state.BatteryVoltage = (batteryStatus & 0x0f) + batteryFrac / 256;\r\n                const batteryFlags = (batteryStatus & 0x70) >>> 4;\r\n                state.BatteryStatusBit = batteryFlags;\r\n                switch (batteryFlags) {\r\n                    case 1:\r\n                        state.BatteryStatus = \"New\";\r\n                        break;\r\n                    case 2:\r\n                        state.BatteryStatus = \"Good\";\r\n                        break;\r\n                    case 3:\r\n                        state.BatteryStatus = \"Ok\";\r\n                        break;\r\n                    case 4:\r\n                        state.BatteryStatus = \"Low\";\r\n                        break;\r\n                    case 5:\r\n                        state.BatteryStatus = \"Critical\";\r\n                        break;\r\n                    default:\r\n                        state.BatteryVoltage = undefined;\r\n                        state.BatteryStatus = \"Invalid\";\r\n                        break;\r\n                }\r\n                break;\r\n            }\r\n            default:\r\n                break;\r\n        }\r\n    }\r\n    // Decode the last four bytes of the HRM format, the first byte of this message is the channel number\r\n    DecodeDefaultHRM(state, data.slice(Messages.BUFFER_INDEX_MSG_DATA + 4));\r\n    page.oldPage = pageNum;\r\n\r\n    sensor.emit(\"hbdata\", state);\r\n    sensor.emit(\"hbData\", state);\r\n}\r\n\r\n/**\r\n * Decodes the default Heart Rate Monitor (HRM) data from the buffer and updates the sensor state.\r\n *\r\n * @param {HeartRateSensorState | HeartRateScannerState} state - The current state of the sensor or scanner.\r\n * @param {Buffer} pucPayload - The buffer containing the HRM data.\r\n * @returns {void}\r\n *\r\n * @example\r\n * const state = new HeartRateSensorState(12345);\r\n * const hrmData = Buffer.from([0x00, 0x01, 0x02, 0x03]); // Sample HRM data buffer\r\n * DecodeDefaultHRM(state, hrmData);\r\n */\r\nfunction DecodeDefaultHRM(state: HeartRateSensorState | HeartRateScannerState, pucPayload: Buffer): void {\r\n    // Decode the measurement time data (two bytes)\r\n    state.BeatTime = pucPayload.readUInt16LE(0);\r\n    // Decode the measurement count data\r\n    state.BeatCount = pucPayload.readUInt8(2);\r\n    // Decode the computed heart rate data\r\n    state.ComputedHeartRate = pucPayload.readUInt8(3);\r\n}\r\n","/**\r\n * Represents the state of a Heart Rate sensor.\r\n * This class holds the data fields associated with the state of a Heart Rate sensor,\r\n * including heart rate measurements, device details, and battery status.\r\n */\r\nexport class HeartRateSensorState {\r\n    /**\r\n     * Creates an instance of the HeartRateSensorState.\r\n     *\r\n     * @param {number} deviceId - The unique identifier of the sensor device.\r\n     * @example\r\n     * const sensorState = new HeartRateSensorState(12345);\r\n     */\r\n    constructor(deviceId: number) {\r\n        this.DeviceId = deviceId;\r\n    }\r\n\r\n    /**\r\n     * The unique identifier of the sensor device.\r\n     * @type {number}\r\n     */\r\n    DeviceId: number;\r\n\r\n    /**\r\n     * The time of the last beat event in milliseconds.\r\n     * @type {number | undefined}\r\n     */\r\n    BeatTime: number | undefined;\r\n\r\n    /**\r\n     * The cumulative count of beat events since the sensor started.\r\n     * @type {number | undefined}\r\n     */\r\n    BeatCount: number | undefined;\r\n\r\n    /**\r\n     * The computed heart rate in beats per minute (BPM).\r\n     * @type {number | undefined}\r\n     */\r\n    ComputedHeartRate: number | undefined;\r\n\r\n    /**\r\n     * The cumulative operating time of the sensor in seconds.\r\n     * @type {number | undefined}\r\n     */\r\n    OperatingTime?: number;\r\n\r\n    /**\r\n     * The manufacturer ID of the sensor.\r\n     * @type {number | undefined}\r\n     */\r\n    ManId?: number;\r\n\r\n    /**\r\n     * The serial number of the sensor.\r\n     * @type {number | undefined}\r\n     */\r\n    SerialNumber?: number;\r\n\r\n    /**\r\n     * The hardware version of the sensor.\r\n     * @type {number | undefined}\r\n     */\r\n    HwVersion?: number;\r\n\r\n    /**\r\n     * The software version of the sensor.\r\n     * @type {number | undefined}\r\n     */\r\n    SwVersion?: number;\r\n\r\n    /**\r\n     * The model number of the sensor.\r\n     * @type {number | undefined}\r\n     */\r\n    ModelNum?: number;\r\n\r\n    /**\r\n     * The time of the previous beat measurement.\r\n     * @type {number | undefined}\r\n     */\r\n    PreviousBeat?: number;\r\n\r\n    /**\r\n     * The average heart rate over a certain interval.\r\n     * @type {number | undefined}\r\n     */\r\n    IntervalAverage?: number;\r\n\r\n    /**\r\n     * The maximum heart rate over a certain interval.\r\n     * @type {number | undefined}\r\n     */\r\n    IntervalMax?: number;\r\n\r\n    /**\r\n     * The average heart rate over the current session.\r\n     * @type {number | undefined}\r\n     */\r\n    SessionAverage?: number;\r\n\r\n    /**\r\n     * The supported features of the sensor.\r\n     * @type {number | undefined}\r\n     */\r\n    SupportedFeatures?: number;\r\n\r\n    /**\r\n     * The enabled features of the sensor.\r\n     * @type {number | undefined}\r\n     */\r\n    EnabledFeatures?: number;\r\n\r\n    /**\r\n     * The battery level of the sensor.\r\n     * @type {number | undefined}\r\n     */\r\n    BatteryLevel?: number;\r\n\r\n    /**\r\n     * The battery voltage of the sensor.\r\n     * @type {number | undefined}\r\n     */\r\n    BatteryVoltage?: number;\r\n\r\n    /**\r\n     * The battery status of the sensor.\r\n     * Can be \"New\", \"Good\", \"Ok\", \"Low\", \"Critical\", or \"Invalid\".\r\n     * @type {\"New\" | \"Good\" | \"Ok\" | \"Low\" | \"Critical\" | \"Invalid\" | undefined}\r\n     */\r\n    BatteryStatus?: \"New\" | \"Good\" | \"Ok\" | \"Low\" | \"Critical\" | \"Invalid\";\r\n\r\n    /**\r\n     * The battery status bit of the sensor.\r\n     */\r\n    BatteryStatusBit?: number;\r\n}\r\n","import { HeartRateSensorState } from \"./heartRateSensorState.js\";\n\n/**\n * Represents the state of a Heart Rate sensor during scanning.\n * Extends the HeartRateSensorState to include additional fields specific to scanning,\n * such as RSSI (Received Signal Strength Indicator) and signal threshold.\n */\nexport class HeartRateScannerState extends HeartRateSensorState {\n    /**\n     * The received signal strength indicator (RSSI) of the sensor signal.\n     * @type {number | undefined}\n     */\n    Rssi: number | undefined;\n\n    /**\n     * The signal threshold value for the sensor.\n     * @type {number | undefined}\n     */\n    Threshold: number | undefined;\n}\n","import { EventEmitter } from \"events\";\nimport { USBDriver } from \"../core/usbDriver.js\";\nimport { SendCallback } from \"../types/sendCallback.js\";\nimport { Constants } from \"../types/constants.js\";\nimport { Messages } from \"../utils/messages.js\";\nimport { Status } from \"../types/status.js\";\n\n/**\n * Abstract base class for sensors that communicates over a USB connection.\n * Extends EventEmitter to handle various events related to sensor data and status.\n */\nexport abstract class BaseSensor extends EventEmitter {\n    channel: number | undefined;\n    deviceId!: number;\n    transmissionType!: number;\n\n    private messageQueue: { msg: Buffer; cbk?: SendCallback }[] = [];\n\n    protected decodeDataCbk: ((data: Buffer) => void) | undefined;\n    protected statusCbk: ((status: Status) => boolean) | undefined;\n\n    /**\n     * Abstract method to update the state of the sensor.\n     * Must be implemented by subclasses.\n     *\n     * @param {number} deviceId - The device ID to update.\n     * @param {Buffer} data - The data buffer containing the state information.\n     */\n    protected abstract updateState(deviceId: number, data: Buffer): void;\n\n    /**\n     * Creates an instance of BaseSensor.\n     *\n     * @param {USBDriver} stick - The USB driver used for communication with the sensor.\n     */\n    constructor(private stick: USBDriver) {\n        super();\n        stick.on(\"read\", this.handleEventMessages.bind(this));\n    }\n\n    /**\n     * Starts scanning for devices of the specified type at a given frequency.\n     *\n     * @param {string} type - The type of device to scan for.\n     * @param {number} frequency - The frequency at which to scan.\n     *\n     * @throws Will throw an error if already attached or if the stick cannot scan.\n     */\n    protected scan(type: string, frequency: number) {\n        if (this.channel !== undefined) {\n            throw new Error(\"already attached\");\n        }\n\n        if (!this.stick.canScan) {\n            throw new Error(\"stick cannot scan\");\n        }\n\n        const channel = 0;\n\n        const onStatus = (status: Status) => {\n            switch (status.msg) {\n                case Constants.MESSAGE_RF:\n                    // Handle various message statuses\n                    switch (status.code) {\n                        case Constants.EVENT_CHANNEL_CLOSED:\n                        case Constants.EVENT_RX_FAIL_GO_TO_SEARCH:\n                            this.write(Messages.unassignChannel(channel));\n                            return true;\n                        case Constants.EVENT_TRANSFER_TX_COMPLETED:\n                        case Constants.EVENT_TRANSFER_TX_FAILED:\n                        case Constants.EVENT_RX_FAIL:\n                        case Constants.INVALID_SCAN_TX_CHANNEL: {\n                            const mc = this.messageQueue.shift();\n                            if (mc && mc.cbk) {\n                                mc.cbk(status.code === Constants.EVENT_TRANSFER_TX_COMPLETED);\n                            }\n                            if (this.messageQueue.length) {\n                                this.write(this.messageQueue[0].msg);\n                            }\n                            return true;\n                        }\n                        default:\n                            break;\n                    }\n                    break;\n                case Constants.MESSAGE_CHANNEL_ASSIGN:\n                    this.write(Messages.setDevice(channel, 0, 0, 0));\n                    return true;\n                case Constants.MESSAGE_CHANNEL_ID:\n                    this.write(Messages.setFrequency(channel, frequency));\n                    return true;\n                case Constants.MESSAGE_CHANNEL_FREQUENCY:\n                    this.write(Messages.setRxExt());\n                    return true;\n                case Constants.MESSAGE_ENABLE_RX_EXT:\n                    this.write(Messages.libConfig(channel, 0xe0));\n                    return true;\n                case Constants.MESSAGE_LIB_CONFIG:\n                    this.write(Messages.openRxScan());\n                    return true;\n                case Constants.MESSAGE_CHANNEL_OPEN_RX_SCAN:\n                    process.nextTick(() => this.emit(\"attached\"));\n                    return true;\n                case Constants.MESSAGE_CHANNEL_CLOSE:\n                    return true;\n                case Constants.MESSAGE_CHANNEL_UNASSIGN:\n                    this.statusCbk = undefined;\n                    this.channel = undefined;\n                    process.nextTick(() => this.emit(\"detached\"));\n                    return true;\n                case Constants.MESSAGE_CHANNEL_ACKNOWLEDGED_DATA:\n                    return status.code === Constants.TRANSFER_IN_PROGRESS;\n                default:\n                    break;\n            }\n            return false;\n        };\n\n        if (this.stick.isScanning()) {\n            this.channel = channel;\n            this.deviceId = 0;\n            this.transmissionType = 0;\n\n            this.statusCbk = onStatus;\n\n            process.nextTick(() => this.emit(\"attached\"));\n        } else if (this.stick.attach(this, true)) {\n            this.channel = channel;\n            this.deviceId = 0;\n            this.transmissionType = 0;\n\n            this.statusCbk = onStatus;\n\n            this.write(Messages.assignChannel(channel, type));\n        } else {\n            throw new Error(\"cannot attach\");\n        }\n    }\n\n    /**\n     * Attaches the sensor to a specific channel with the given parameters.\n     *\n     * @param {number} channel - The channel number to attach to.\n     * @param {string} type - The type of device.\n     * @param {number} deviceId - The device ID.\n     * @param {number} deviceType - The type of the device.\n     * @param {number} transmissionType - The transmission type.\n     * @param {number} timeout - The timeout value for the channel.\n     * @param {number} period - The period for communication.\n     * @param {number} frequency - The frequency for communication.\n     *\n     * @throws Will throw an error if already attached or if unable to attach.\n     */\n    protected attachSensor(channel: number, type: string, deviceId: number, deviceType: number, transmissionType: number, timeout: number, period: number, frequency: number) {\n        if (this.channel !== undefined) {\n            throw new Error(\"already attached\");\n        }\n        if (!this.stick.attach(this, false)) {\n            throw new Error(\"cannot attach\");\n        }\n        this.channel = channel;\n        this.deviceId = deviceId;\n        this.transmissionType = transmissionType;\n\n        const onStatus = (status: Status) => {\n            switch (status.msg) {\n                case Constants.MESSAGE_RF:\n                    // Handle various message statuses\n                    switch (status.code) {\n                        case Constants.EVENT_CHANNEL_CLOSED:\n                        case Constants.EVENT_RX_FAIL_GO_TO_SEARCH:\n                            this.write(Messages.unassignChannel(channel));\n                            return true;\n                        case Constants.EVENT_TRANSFER_TX_COMPLETED:\n                        case Constants.EVENT_TRANSFER_TX_FAILED:\n                        case Constants.EVENT_RX_FAIL:\n                        case Constants.INVALID_SCAN_TX_CHANNEL: {\n                            const mc = this.messageQueue.shift();\n                            if (mc && mc.cbk) {\n                                mc.cbk(status.code === Constants.EVENT_TRANSFER_TX_COMPLETED);\n                            }\n                            if (this.messageQueue.length) {\n                                this.write(this.messageQueue[0].msg);\n                            }\n                            return true;\n                        }\n                        case Constants.EVENT_CHANNEL_COLLISION:\n                            return true;\n                        default:\n                            break;\n                    }\n                    break;\n                case Constants.MESSAGE_CHANNEL_ASSIGN:\n                    this.write(Messages.setDevice(channel, deviceId, deviceType, transmissionType));\n                    return true;\n                case Constants.MESSAGE_CHANNEL_ID:\n                    this.write(Messages.searchChannel(channel, timeout));\n                    return true;\n                case Constants.MESSAGE_CHANNEL_SEARCH_TIMEOUT:\n                    this.write(Messages.setFrequency(channel, frequency));\n                    return true;\n                case Constants.MESSAGE_CHANNEL_FREQUENCY:\n                    this.write(Messages.setPeriod(channel, period));\n                    return true;\n                case Constants.MESSAGE_CHANNEL_PERIOD:\n                    this.write(Messages.libConfig(channel, 0xe0));\n                    return true;\n                case Constants.MESSAGE_LIB_CONFIG:\n                    this.write(Messages.openChannel(channel));\n                    return true;\n                case Constants.MESSAGE_CHANNEL_OPEN:\n                    process.nextTick(() => this.emit(\"attached\"));\n                    return true;\n                case Constants.MESSAGE_CHANNEL_CLOSE:\n                    return true;\n                case Constants.MESSAGE_CHANNEL_UNASSIGN:\n                    this.statusCbk = undefined;\n                    this.channel = undefined;\n                    process.nextTick(() => this.emit(\"detached\"));\n                    return true;\n                case Constants.MESSAGE_CHANNEL_ACKNOWLEDGED_DATA:\n                    return status.code === Constants.TRANSFER_IN_PROGRESS;\n                default:\n                    break;\n            }\n            return false;\n        };\n\n        this.statusCbk = onStatus;\n\n        this.write(Messages.assignChannel(channel, type));\n    }\n\n    /**\n     * Detaches the sensor from its assigned channel and stops communication.\n     *\n     * @throws Will throw an error if there is an issue detaching.\n     */\n    public detach() {\n        if (this.channel === undefined) {\n            return;\n        }\n        this.write(Messages.closeChannel(this.channel));\n        if (!this.stick.detach(this)) {\n            throw new Error(\"error detaching\");\n        }\n    }\n\n    /**\n     * Sends data to the USB device.\n     *\n     * @param {Buffer} data - The data buffer to send.\n     */\n    protected write(data: Buffer) {\n        this.stick.write(data);\n    }\n\n    /**\n     * Handles incoming event messages from the USB device.\n     *\n     * @private\n     * @param {Buffer} data - The data buffer containing the event message.\n     */\n    private handleEventMessages(data: Buffer) {\n        const messageId = data.readUInt8(Messages.BUFFER_INDEX_MSG_TYPE);\n        const channel = data.readUInt8(Messages.BUFFER_INDEX_CHANNEL_NUM);\n\n        if (channel === this.channel) {\n            if (messageId === Constants.MESSAGE_CHANNEL_EVENT) {\n                const status: Status = {\n                    msg: data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA),\n                    code: data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 1),\n                };\n\n                const handled = this.statusCbk && this.statusCbk(status);\n                if (!handled) {\n                    console.log(\"Unhandled event: \" + data.toString(\"hex\"));\n                    this.emit(\"eventData\", {\n                        message: data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA),\n                        code: data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 1),\n                    });\n                }\n            } else if (this.decodeDataCbk) {\n                this.decodeDataCbk(data);\n            }\n        }\n    }\n\n    /**\n     * Sends data and optionally a callback to handle the result of the send operation.\n     *\n     * @param {Buffer} data - The data buffer to send.\n     * @param {SendCallback} [cbk] - Optional callback to handle the send result.\n     */\n    protected send(data: Buffer, cbk?: SendCallback) {\n        this.messageQueue.push({ msg: data, cbk });\n        if (this.messageQueue.length === 1) {\n            this.write(data);\n        }\n    }\n}\n","import { BaseSensor } from \"./baseSensor.js\";\n\n/**\n * Abstract base class for ANT+ sensors, extending the functionality of the BaseSensor class.\n * This class provides methods to scan and attach ANT+ sensors with specific configurations.\n */\nexport abstract class AntPlusBaseSensor extends BaseSensor {\n    /**\n     * Initiates a scan for ANT+ sensors of a specific type.\n     *\n     * @protected\n     * @param {string} type - The type of sensor to scan for.\n     * @returns {Promise<void>} A promise that resolves when the scan is complete.\n     *\n     * @example\n     * // Example usage:\n     * const sensor = new AntPlusSensor();\n     * sensor.scan('heartRate');\n     */\n    protected scan(type: string) {\n        return super.scan(type, 57);\n    }\n\n    /**\n     * Attaches to a specific ANT+ sensor by configuring the channel, type, device ID, device type, transmission type, timeout, and period.\n     *\n     * @protected\n     * @param {number} channel - The channel number to use for communication with the sensor.\n     * @param {string} type - The type of sensor to attach to.\n     * @param {number} deviceId - The unique ID of the device to attach to.\n     * @param {number} deviceType - The type of the device (e.g., heart rate monitor, speed sensor).\n     * @param {number} transmissionType - The transmission type used by the sensor.\n     * @param {number} timeout - The timeout period for communication in seconds.\n     * @param {number} period - The communication period with the sensor in milliseconds.\n     * @returns {Promise<void>} A promise that resolves when the sensor is successfully attached.\n     *\n     * @example\n     * // Example usage:\n     * const sensor = new AntPlusSensor();\n     * sensor.attachSensor(1, 'heartRate', 12345, 120, 5, 60, 8070);\n     */\n    protected attachSensor(channel: number, type: string, deviceId: number, deviceType: number, transmissionType: number, timeout: number, period: number) {\n        return super.attachSensor(channel, type, deviceId, deviceType, transmissionType, timeout, period, 57);\n    }\n}\n","import { AntPlusBaseSensor } from \"./antPlusBaseSensor.js\";\nimport { Constants } from \"../types/constants.js\";\nimport { Messages } from \"../utils/messages.js\";\nimport { USBDriver } from \"../core/usbDriver.js\";\n\n/**\n * Abstract base class for managing a specific ANT+ sensor, extending the functionality\n * of the AntPlusBaseSensor class. Provides methods for attaching sensors and decoding data.\n */\nexport abstract class AntPlusSensor extends AntPlusBaseSensor {\n    /**\n     * Constructs an instance of the AntPlusSensor class.\n     *\n     * @param {USBDriver} stick - The USB driver instance used for communication with the ANT+ stick.\n     */\n    constructor(stick: USBDriver) {\n        super(stick);\n        this.decodeDataCbk = this.decodeData.bind(this);\n    }\n\n    /**\n     * Unsupported method for scanning sensors. Throws an error when called.\n     *\n     * @protected\n     * @throws {Error} Always throws an error indicating that scanning is unsupported.\n     */\n    protected scan() {\n        throw new Error(\"scanning unsupported\");\n    }\n\n    /**\n     * Attaches to a specific ANT+ sensor by configuring the channel, type, device ID, device type,\n     * transmission type, timeout, and period.\n     *\n     * @protected\n     * @param {number} channel - The channel number to use for communication with the sensor.\n     * @param {string} type - The type of sensor to attach to.\n     * @param {number} deviceId - The unique ID of the device to attach to.\n     * @param {number} deviceType - The type of the device (e.g., heart rate monitor, speed sensor).\n     * @param {number} transmissionType - The transmission type used by the sensor.\n     * @param {number} timeout - The timeout period for communication in seconds.\n     * @param {number} period - The communication period with the sensor in milliseconds.\n     * @returns {Promise<void>} A promise that resolves when the sensor is successfully attached.\n     *\n     * @example\n     * // Example usage:\n     * const sensor = new AntPlusSensor();\n     * sensor.attachSensor(1, 'heartRate', 12345, 120, 5, 60, 8070);\n     */\n    protected attachSensor(channel: number, type: string, deviceId: number, deviceType: number, transmissionType: number, timeout: number, period: number) {\n        return super.attachSensor(channel, type, deviceId, deviceType, transmissionType, timeout, period);\n    }\n\n    /**\n     * Decodes the incoming data from the ANT+ sensor and updates the sensor state.\n     *\n     * @private\n     * @param {Buffer} data - The raw data buffer received from the ANT+ sensor.\n     * @returns {void}\n     *\n     * @example\n     * // Example usage:\n     * const dataBuffer = getDataFromSensor(); // assume this function gets data from a sensor\n     * decodeData(dataBuffer);\n     */\n    private decodeData(data: Buffer) {\n        switch (data.readUInt8(Messages.BUFFER_INDEX_MSG_TYPE)) {\n            case Constants.MESSAGE_CHANNEL_BROADCAST_DATA:\n            case Constants.MESSAGE_CHANNEL_ACKNOWLEDGED_DATA:\n            case Constants.MESSAGE_CHANNEL_BURST_DATA:\n                if (this.deviceId === 0 && this.channel) {\n                    this.write(Messages.requestMessage(this.channel, Constants.MESSAGE_CHANNEL_ID));\n                }\n                this.updateState(this.deviceId, data);\n                break;\n            case Constants.MESSAGE_CHANNEL_ID:\n                this.deviceId = data.readUInt16LE(Messages.BUFFER_INDEX_MSG_DATA);\n                this.transmissionType = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 3);\n                break;\n            default:\n                break;\n        }\n    }\n}\n","/*\n * ANT+ profile: https://www.thisisant.com/developer/ant-plus/device-profiles/#526_tab\n * Spec sheet: https://www.thisisant.com/resources/heart-rate-monitor/\n */\n\nimport { Page, PageState, updateState } from \"./heartRateUtils.js\";\nimport { HeartRateSensorState } from \"./heartRateSensorState.js\";\nimport { AntPlusSensor } from \"../antPlusSensor.js\";\n\n/**\n * Represents a Heart Rate sensor.\n * This class extends the AntPlusSensor class to handle specific data related to heart rate monitoring.\n */\nexport class HeartRateSensor extends AntPlusSensor {\n    /**\n     * The device type code for Heart Rate sensors.\n     * @type {number}\n     * @readonly\n     */\n    static deviceType: number = 120;\n\n    /**\n     * Attaches the sensor to a specified ANT+ channel and initializes its state.\n     *\n     * @public\n     * @param {number} channel - The ANT+ channel number used for communication with the sensor.\n     * @param {number} deviceId - The unique identifier of the sensor device.\n     * @returns {void}\n     *\n     * @example\n     * const sensor = new HeartRateSensor();\n     * sensor.attach(1, 12345); // Attaches to channel 1 with device ID 12345\n     */\n    public attach(channel: number, deviceId: number) {\n        super.attachSensor(channel, \"receive\", deviceId, HeartRateSensor.deviceType, 0, 255, 8070);\n        this.state = new HeartRateSensorState(deviceId);\n    }\n\n    /**\n     * The current state of the Heart Rate sensor.\n     * @private\n     * @type {HeartRateSensorState}\n     */\n    private state!: HeartRateSensorState;\n\n    /**\n     * Represents the page information used in communication with the sensor.\n     * @private\n     * @type {Page}\n     * @default { oldPage: -1, pageState: PageState.INIT_PAGE }\n     */\n    private page: Page = {\n        oldPage: -1,\n        pageState: PageState.INIT_PAGE,\n    };\n\n    /**\n     * Updates the state of the sensor based on incoming data.\n     *\n     * @protected\n     * @param {number} deviceId - The unique identifier of the sensor device.\n     * @param {Buffer} data - The raw data buffer received from the sensor.\n     * @returns {void}\n     *\n     * @example\n     * const dataBuffer = getDataFromSensor(); // assume this function gets data from a sensor\n     * sensor.updateState(12345, dataBuffer);\n     */\n    protected updateState(deviceId: number, data: Buffer) {\n        this.state.DeviceId = deviceId;\n        updateState(this, this.state, this.page, data);\n    }\n}\n","import { AntPlusBaseSensor } from \"./antPlusBaseSensor.js\";\nimport { Constants } from \"../types/constants.js\";\nimport { Messages } from \"../utils/messages.js\";\nimport { USBDriver } from \"../core/usbDriver.js\";\n\n/**\n * Abstract base class for scanning and decoding data from ANT+ sensors.\n * This class provides methods to scan for sensors, handle sensor data, and manage sensor states.\n */\nexport abstract class AntPlusScanner extends AntPlusBaseSensor {\n    /**\n     * Returns the type of device being scanned for.\n     *\n     * @protected\n     * @returns {number} The numeric code representing the device type.\n     */\n    protected abstract deviceType(): number;\n\n    /**\n     * Creates a new state for the device if it does not already exist.\n     *\n     * @protected\n     * @param {number} deviceId - The unique identifier of the device.\n     */\n    protected abstract createStateIfNew(deviceId: number): void;\n\n    /**\n     * Updates the RSSI (Received Signal Strength Indicator) and the signal threshold for the specified device.\n     *\n     * @protected\n     * @param {number} deviceId - The unique identifier of the device.\n     * @param {number} rssi - The received signal strength indicator of the device.\n     * @param {number} threshold - The signal threshold value for the device.\n     */\n    protected abstract updateRssiAndThreshold(deviceId: number, rssi: number, threshold: number): void;\n\n    /**\n     * Constructs an instance of the AntPlusScanner class.\n     *\n     * @param {USBDriver} stick - The USB driver instance used for communication with the ANT+ stick.\n     */\n    constructor(stick: USBDriver) {\n        super(stick);\n        this.decodeDataCbk = this.decodeData.bind(this);\n    }\n\n    /**\n     * Initiates a scan for ANT+ sensors by receiving broadcast messages.\n     *\n     * @public\n     * @returns {Promise<void>} A promise that resolves when the scanning process is complete.\n     *\n     * @example\n     * // Example usage:\n     * const scanner = new AntPlusScanner();\n     * scanner.scan();\n     */\n    public scan() {\n        return super.scan(\"receive\");\n    }\n\n    /**\n     * Unsupported method for attaching to a sensor. Throws an error when called.\n     *\n     * @protected\n     * @throws {Error} Always throws an error indicating that attaching is unsupported.\n     */\n    protected attach() {\n        throw new Error(\"attach unsupported\");\n    }\n\n    /**\n     * Unsupported method for sending data to a sensor. Throws an error when called.\n     *\n     * @protected\n     * @throws {Error} Always throws an error indicating that sending is unsupported.\n     */\n    protected send() {\n        throw new Error(\"send unsupported\");\n    }\n\n    /**\n     * Decodes the incoming data from the ANT+ sensors and updates the sensor state.\n     *\n     * @private\n     * @param {Buffer} data - The raw data buffer received from the ANT+ sensor.\n     * @returns {void}\n     *\n     * @example\n     * // Example usage:\n     * const dataBuffer = getDataFromSensor(); // assume this function gets data from a sensor\n     * decodeData(dataBuffer);\n     */\n    private decodeData(data: Buffer) {\n        if (data.length <= Messages.BUFFER_INDEX_EXT_MSG_BEGIN + 3 || !(data.readUInt8(Messages.BUFFER_INDEX_EXT_MSG_BEGIN) & 0x80)) {\n            console.log(\"wrong message format\", data.toString(\"hex\"));\n            return;\n        }\n\n        const deviceId = data.readUInt16LE(Messages.BUFFER_INDEX_EXT_MSG_BEGIN + 1);\n        const deviceType = data.readUInt8(Messages.BUFFER_INDEX_EXT_MSG_BEGIN + 3);\n\n        if (deviceType !== this.deviceType()) {\n            return;\n        }\n\n        this.createStateIfNew(deviceId);\n\n        if (data.readUInt8(Messages.BUFFER_INDEX_EXT_MSG_BEGIN) & 0x40) {\n            if (data.readUInt8(Messages.BUFFER_INDEX_EXT_MSG_BEGIN + 5) === 0x20) {\n                this.updateRssiAndThreshold(deviceId, data.readInt8(Messages.BUFFER_INDEX_EXT_MSG_BEGIN + 6), data.readInt8(Messages.BUFFER_INDEX_EXT_MSG_BEGIN + 7));\n            }\n        }\n\n        switch (data.readUInt8(Messages.BUFFER_INDEX_MSG_TYPE)) {\n            case Constants.MESSAGE_CHANNEL_BROADCAST_DATA:\n            case Constants.MESSAGE_CHANNEL_ACKNOWLEDGED_DATA:\n            case Constants.MESSAGE_CHANNEL_BURST_DATA:\n                this.updateState(deviceId, data);\n                break;\n            default:\n                break;\n        }\n    }\n}\n","import { Page, PageState, updateState } from \"./heartRateUtils.js\";\nimport { HeartRateScannerState } from \"./heartRateScannerState.js\";\nimport { HeartRateSensor } from \"./heartRateSensor.js\";\nimport { AntPlusScanner } from \"../antPlusScanner.js\";\n\n/**\n * Represents a scanner for Heart Rate sensors.\n * Extends the AntPlusScanner class to handle scanning and state updates for multiple Heart Rate sensors.\n */\nexport class HeartRateScanner extends AntPlusScanner {\n    /**\n     * Returns the device type code for Heart Rate sensors.\n     *\n     * @protected\n     * @returns {number} The device type code for Heart Rate sensors.\n     */\n    protected deviceType(): number {\n        return HeartRateSensor.deviceType;\n    }\n\n    /**\n     * A dictionary to store the states of detected Heart Rate sensors by their device ID.\n     * @private\n     * @type {{ [id: number]: HeartRateScannerState }}\n     */\n    private states: { [id: number]: HeartRateScannerState } = {};\n\n    /**\n     * A dictionary to store page information for each detected Heart Rate sensor by their device ID.\n     * @private\n     * @type {{ [id: number]: Page }}\n     */\n    private pages: { [id: number]: Page } = {};\n\n    /**\n     * Creates a new state entry and page information for a sensor if they do not already exist.\n     *\n     * @protected\n     * @param {number} deviceId - The unique identifier of the sensor device.\n     * @returns {void}\n     *\n     * @example\n     * scanner.createStateIfNew(12345); // Creates a new state and page info for device ID 12345 if they do not exist.\n     */\n    protected createStateIfNew(deviceId: number): void {\n        if (!this.states[deviceId]) {\n            this.states[deviceId] = new HeartRateScannerState(deviceId);\n        }\n\n        if (!this.pages[deviceId]) {\n            this.pages[deviceId] = { oldPage: -1, pageState: PageState.INIT_PAGE };\n        }\n    }\n\n    /**\n     * Updates the RSSI (Received Signal Strength Indicator) and signal threshold for a specific sensor.\n     *\n     * @protected\n     * @param {number} deviceId - The unique identifier of the sensor device.\n     * @param {number} rssi - The received signal strength indicator of the device.\n     * @param {number} threshold - The signal threshold value for the device.\n     * @returns {void}\n     *\n     * @example\n     * scanner.updateRssiAndThreshold(12345, -70, 30); // Updates the RSSI and threshold for device ID 12345.\n     */\n    protected updateRssiAndThreshold(deviceId: number, rssi: number, threshold: number): void {\n        this.states[deviceId].Rssi = rssi;\n        this.states[deviceId].Threshold = threshold;\n    }\n\n    /**\n     * Updates the state of a sensor based on incoming data.\n     *\n     * @protected\n     * @param {number} deviceId - The unique identifier of the sensor device.\n     * @param {Buffer} data - The raw data buffer received from the sensor.\n     * @returns {void}\n     *\n     * @example\n     * const dataBuffer = getDataFromSensor(); // Assume this function gets data from a sensor\n     * scanner.updateState(12345, dataBuffer); // Updates the state for device ID 12345.\n     */\n    protected updateState(deviceId: number, data: Buffer): void {\n        updateState(this, this.states[deviceId], this.pages[deviceId], data);\n    }\n}\n","import { StrideSpeedDistanceScanner } from \"./strideSpeedDistanceScanner.js\";\nimport { StrideSpeedDistanceScanState } from \"./strideSpeedDistanceScanState.js\";\nimport { StrideSpeedDistanceSensor } from \"./strideSpeedDistanceSensor.js\";\nimport { StrideSpeedDistanceSensorState } from \"./strideSpeedDistanceSensorState.js\";\nimport { Messages } from \"../../utils/messages.js\";\n\n/**\n * Updates the state of a Stride-Based Speed and Distance Monitor (SDM) sensor or scanner\n * based on the data received from the sensor.\n *\n * @param {StrideSpeedDistanceSensor | StrideSpeedDistanceScanner} sensor - The sensor or scanner instance emitting the data.\n * @param {StrideSpeedDistanceSensorState | StrideSpeedDistanceScanState} state - The current state of the sensor or scanner.\n * @param {Buffer} data - The raw data buffer received from the sensor.\n * @returns {void}\n *\n * @example\n * const sensor = new StrideSpeedDistanceSensor();\n * const state = new StrideSpeedDistanceSensorState(12345);\n * const dataBuffer = getDataFromSensor(); // Assume this function gets data from a sensor\n * updateState(sensor, state, dataBuffer);\n */\nexport function updateState(sensor: StrideSpeedDistanceSensor | StrideSpeedDistanceScanner, state: StrideSpeedDistanceSensorState | StrideSpeedDistanceScanState, data: Buffer) {\n    const page = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA);\n\n    if (page === 1) {\n        state.TimeFractional = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 1);\n        state.TimeInteger = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 2);\n        state.DistanceInteger = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 3);\n        state.DistanceFractional = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 4) >>> 4;\n        state.SpeedInteger = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 4) & 0x0f;\n        state.SpeedFractional = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 5);\n        state.StrideCount = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 6);\n        state.UpdateLatency = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 7);\n    } else if (page >= 2 && page <= 15) {\n        state.CadenceInteger = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 3);\n        state.CadenceFractional = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 4) >>> 4;\n        state.SpeedInteger = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 4) & 0x0f;\n        state.SpeedFractional = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 5);\n        state.Status = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 7);\n\n        switch (page) {\n            case 3:\n                state.Calories = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 6);\n                break;\n            default:\n                break;\n        }\n    }\n\n    sensor.emit(\"ssddata\", state);\n    sensor.emit(\"ssdData\", state);\n}\n","/**\n * Represents the state of a Stride-Based Speed and Distance Monitor (SDM) sensor.\n * This class holds the data fields associated with the SDM sensor's state, including device ID,\n * speed, distance, cadence, and other relevant metrics.\n */\nexport class StrideSpeedDistanceSensorState {\n    /**\n     * Creates an instance of the StrideSpeedDistanceSensorState.\n     *\n     * @param {number} deviceId - The unique identifier of the sensor device.\n     * @example\n     * const sensorState = new StrideSpeedDistanceSensorState(12345);\n     */\n    constructor(deviceId: number) {\n        this.DeviceId = deviceId;\n    }\n\n    /**\n     * The unique identifier of the sensor device.\n     * @type {number}\n     */\n    DeviceId: number;\n\n    /**\n     * The fractional part of the elapsed time in seconds.\n     * @type {number | undefined}\n     */\n    TimeFractional: number | undefined;\n\n    /**\n     * The integer part of the elapsed time in seconds.\n     * @type {number | undefined}\n     */\n    TimeInteger: number | undefined;\n\n    /**\n     * The integer part of the total distance traveled in meters.\n     * @type {number | undefined}\n     */\n    DistanceInteger: number | undefined;\n\n    /**\n     * The fractional part of the total distance traveled in meters.\n     * @type {number | undefined}\n     */\n    DistanceFractional: number | undefined;\n\n    /**\n     * The integer part of the speed in meters per second.\n     * @type {number | undefined}\n     */\n    SpeedInteger: number | undefined;\n\n    /**\n     * The fractional part of the speed in meters per second.\n     * @type {number | undefined}\n     */\n    SpeedFractional: number | undefined;\n\n    /**\n     * The total number of strides counted.\n     * @type {number | undefined}\n     */\n    StrideCount: number | undefined;\n\n    /**\n     * The latency in milliseconds between updates.\n     * @type {number | undefined}\n     */\n    UpdateLatency: number | undefined;\n\n    /**\n     * The integer part of the cadence in strides per minute.\n     * @type {number | undefined}\n     */\n    CadenceInteger: number | undefined;\n\n    /**\n     * The fractional part of the cadence in strides per minute.\n     * @type {number | undefined}\n     */\n    CadenceFractional: number | undefined;\n\n    /**\n     * The status of the sensor, represented by a numeric value.\n     * @type {number | undefined}\n     */\n    Status: number | undefined;\n\n    /**\n     * The total calories burned, if available.\n     * @type {number | undefined}\n     */\n    Calories: number | undefined;\n}\n","import { StrideSpeedDistanceSensorState } from \"./strideSpeedDistanceSensorState.js\";\n\n/**\n * Represents the state of a Stride-Based Speed and Distance Monitor (SDM) sensor during scanning.\n * Extends the StrideSpeedDistanceSensorState to include additional fields specific to scanning,\n * such as RSSI (Received Signal Strength Indicator) and the signal threshold.\n */\nexport class StrideSpeedDistanceScanState extends StrideSpeedDistanceSensorState {\n    /**\n     * The received signal strength indicator (RSSI) of the sensor signal.\n     * @type {number | undefined}\n     */\n    Rssi: number | undefined;\n\n    /**\n     * The signal threshold value.\n     * @type {number | undefined}\n     */\n    Threshold: number | undefined;\n}\n","/*\n * ANT+ profile: https://www.thisisant.com/developer/ant-plus/device-profiles/#528_tab\n * Spec sheet: https://www.thisisant.com/resources/stride-based-speed-and-distance-monitor/\n */\n\nimport { AntPlusSensor } from \"../antPlusSensor.js\";\nimport { updateState } from \"./strideSpeedDistanceUtils.js\";\nimport { StrideSpeedDistanceSensorState } from \"./strideSpeedDistanceSensorState.js\";\n\n/**\n * Represents a Stride-Based Speed and Distance Monitor (SDM) sensor.\n * This class extends the AntPlusSensor class to provide specific functionality for handling SDM sensor data.\n */\nexport class StrideSpeedDistanceSensor extends AntPlusSensor {\n    /**\n     * The device type code for Stride-Based Speed and Distance Monitor (SDM) sensors.\n     * @type {number}\n     * @readonly\n     */\n    static deviceType: number = 124;\n\n    /**\n     * Attaches the sensor to a specified ANT+ channel and initializes its state.\n     *\n     * @public\n     * @param {number} channel - The ANT+ channel number used for communication with the sensor.\n     * @param {number} deviceId - The unique identifier of the sensor device.\n     * @returns {void}\n     *\n     * @example\n     * const sensor = new StrideSpeedDistanceSensor();\n     * sensor.attach(1, 12345); // Attaches to channel 1 with device ID 12345\n     */\n    public attach(channel: number, deviceId: number) {\n        super.attachSensor(channel, \"receive\", deviceId, StrideSpeedDistanceSensor.deviceType, 0, 255, 8134);\n        this.state = new StrideSpeedDistanceSensorState(deviceId);\n    }\n\n    /**\n     * The current state of the Stride-Based Speed and Distance Monitor sensor.\n     * @private\n     * @type {StrideSpeedDistanceSensorState}\n     */\n    private state!: StrideSpeedDistanceSensorState;\n\n    /**\n     * Updates the state of the sensor based on incoming data.\n     *\n     * @protected\n     * @param {number} deviceId - The unique identifier of the sensor device.\n     * @param {Buffer} data - The raw data buffer received from the sensor.\n     * @returns {void}\n     *\n     * @example\n     * const dataBuffer = getDataFromSensor(); // assume this function gets data from a sensor\n     * sensor.updateState(12345, dataBuffer);\n     */\n    protected updateState(deviceId: number, data: Buffer) {\n        this.state.DeviceId = deviceId;\n        updateState(this, this.state, data);\n    }\n}\n","import { AntPlusScanner } from \"../antPlusScanner.js\";\nimport { updateState } from \"./strideSpeedDistanceUtils.js\";\nimport { StrideSpeedDistanceScanState } from \"./strideSpeedDistanceScanState.js\";\nimport { StrideSpeedDistanceSensor } from \"./strideSpeedDistanceSensor.js\";\n\n/**\n * Represents a scanner for Stride-Based Speed and Distance Monitor (SDM) sensors.\n * Extends the AntPlusScanner class to handle scanning and state updates for multiple SDM sensors.\n */\nexport class StrideSpeedDistanceScanner extends AntPlusScanner {\n    /**\n     * Returns the device type code for Stride-Based Speed and Distance Monitor sensors.\n     *\n     * @protected\n     * @returns {number} The device type code for SDM sensors.\n     */\n    protected deviceType(): number {\n        return StrideSpeedDistanceSensor.deviceType;\n    }\n\n    /**\n     * A dictionary to store the states of detected SDM sensors by their device ID.\n     * @private\n     * @type {{ [id: number]: StrideSpeedDistanceScanState }}\n     */\n    private states: { [id: number]: StrideSpeedDistanceScanState } = {};\n\n    /**\n     * Creates a new state entry for a sensor if it does not already exist.\n     *\n     * @protected\n     * @param {number} deviceId - The unique identifier of the sensor device.\n     * @returns {void}\n     *\n     * @example\n     * scanner.createStateIfNew(12345); // Creates a new state for device ID 12345 if it does not exist.\n     */\n    protected createStateIfNew(deviceId: number): void {\n        if (!this.states[deviceId]) {\n            this.states[deviceId] = new StrideSpeedDistanceScanState(deviceId);\n        }\n    }\n\n    /**\n     * Updates the RSSI (Received Signal Strength Indicator) and signal threshold for a specific sensor.\n     *\n     * @protected\n     * @param {number} deviceId - The unique identifier of the sensor device.\n     * @param {number} rssi - The received signal strength indicator of the device.\n     * @param {number} threshold - The signal threshold value for the device.\n     * @returns {void}\n     *\n     * @example\n     * scanner.updateRssiAndThreshold(12345, -70, 30); // Updates the RSSI and threshold for device ID 12345.\n     */\n    protected updateRssiAndThreshold(deviceId: number, rssi: number, threshold: number): void {\n        this.states[deviceId].Rssi = rssi;\n        this.states[deviceId].Threshold = threshold;\n    }\n\n    /**\n     * Updates the state of a sensor based on incoming data.\n     *\n     * @protected\n     * @param {number} deviceId - The unique identifier of the sensor device.\n     * @param {Buffer} data - The raw data buffer received from the sensor.\n     * @returns {void}\n     *\n     * @example\n     * const dataBuffer = getDataFromSensor(); // Assume this function gets data from a sensor\n     * scanner.updateState(12345, dataBuffer); // Updates the state for device ID 12345.\n     */\n    protected updateState(deviceId: number, data: Buffer): void {\n        updateState(this, this.states[deviceId], data);\n    }\n}\n","import { SpeedCadenceScanner } from \"./speedCadenceScanner.js\";\nimport { SpeedCadenceScanState } from \"./speedCadenceScanState.js\";\nimport { SpeedCadenceSensor } from \"./speedCadenceSensor.js\";\nimport { SpeedCadenceSensorState } from \"./speedCadenceSensorState.js\";\nimport { Messages } from \"../../utils/messages.js\";\n\n/**\n * Updates the state of a Speed and Cadence sensor or scanner based on the incoming data.\n * Calculates the cadence and speed based on the revolution counts and event times provided in the data buffer.\n *\n * @param {SpeedCadenceSensor | SpeedCadenceScanner} sensor - The sensor or scanner instance emitting the data.\n * @param {SpeedCadenceSensorState | SpeedCadenceScanState} state - The current state of the sensor or scanner.\n * @param {Buffer} data - The raw data buffer received from the sensor.\n * @returns {void}\n *\n * @example\n * const sensor = new SpeedCadenceSensor();\n * const state = new SpeedCadenceSensorState(12345);\n * const dataBuffer = getDataFromSensor(); // Assume this function gets data from a sensor\n * updateState(sensor, state, dataBuffer);\n */\nexport function updateState(sensor: SpeedCadenceSensor | SpeedCadenceScanner, state: SpeedCadenceSensorState | SpeedCadenceScanState, data: Buffer) {\n    // Get old state for calculating cumulative values\n    const oldCadenceTime = state.CadenceEventTime ?? 0;\n    const oldCadenceCount = state.CumulativeCadenceRevolutionCount ?? 0;\n    const oldSpeedTime = state.SpeedEventTime ?? 0;\n    const oldSpeedCount = state.CumulativeSpeedRevolutionCount ?? 0;\n\n    let cadenceTime = data.readUInt16LE(Messages.BUFFER_INDEX_MSG_DATA);\n    let cadenceCount = data.readUInt16LE(Messages.BUFFER_INDEX_MSG_DATA + 2);\n    let speedEventTime = data.readUInt16LE(Messages.BUFFER_INDEX_MSG_DATA + 4);\n    let speedRevolutionCount = data.readUInt16LE(Messages.BUFFER_INDEX_MSG_DATA + 6);\n\n    if (cadenceTime !== oldCadenceTime) {\n        state.CadenceEventTime = cadenceTime;\n        state.CumulativeCadenceRevolutionCount = cadenceCount;\n\n        if (oldCadenceTime > cadenceTime) {\n            // Hit rollover value\n            cadenceTime += 1024 * 64;\n        }\n\n        if (oldCadenceCount > cadenceCount) {\n            // Hit rollover value\n            cadenceCount += 1024 * 64;\n        }\n\n        const cadence = (60 * (cadenceCount - oldCadenceCount) * 1024) / (cadenceTime - oldCadenceTime);\n        if (!isNaN(cadence)) {\n            state.CalculatedCadence = cadence;\n            sensor.emit(\"cadenceData\", state);\n        }\n    }\n\n    if (speedEventTime !== oldSpeedTime) {\n        state.SpeedEventTime = speedEventTime;\n        state.CumulativeSpeedRevolutionCount = speedRevolutionCount;\n\n        if (oldSpeedTime > speedEventTime) {\n            // Hit rollover value\n            speedEventTime += 1024 * 64;\n        }\n\n        if (oldSpeedCount > speedRevolutionCount) {\n            // Hit rollover value\n            speedRevolutionCount += 1024 * 64;\n        }\n\n        const distance = sensor.wheelCircumference * (speedRevolutionCount - oldSpeedCount);\n        state.CalculatedDistance = distance;\n\n        // Calculate speed in m/sec\n        const speed = (distance * 1024) / (speedEventTime - oldSpeedTime);\n        if (!isNaN(speed)) {\n            state.CalculatedSpeed = speed;\n            sensor.emit(\"speedData\", state);\n        }\n    }\n}\n","/**\n * Represents the state of a Speed and Cadence sensor.\n * This class holds the data fields associated with the state of a Speed and Cadence sensor, including\n * cadence, speed, distance, and event times.\n */\nexport class SpeedCadenceSensorState {\n    /**\n     * Creates an instance of the SpeedCadenceSensorState.\n     *\n     * @param {number} deviceId - The unique identifier of the sensor device.\n     * @example\n     * const sensorState = new SpeedCadenceSensorState(12345);\n     */\n    constructor(deviceId: number) {\n        this.DeviceId = deviceId;\n    }\n\n    /**\n     * The unique identifier of the sensor device.\n     * @type {number}\n     */\n    DeviceId: number;\n\n    /**\n     * The time of the last cadence event in seconds, measured as a fractional part.\n     * @type {number | undefined}\n     */\n    CadenceEventTime: number | undefined;\n\n    /**\n     * The cumulative count of cadence revolutions since the sensor started.\n     * @type {number | undefined}\n     */\n    CumulativeCadenceRevolutionCount: number | undefined;\n\n    /**\n     * The time of the last speed event in seconds, measured as a fractional part.\n     * @type {number | undefined}\n     */\n    SpeedEventTime: number | undefined;\n\n    /**\n     * The cumulative count of speed revolutions since the sensor started.\n     * @type {number | undefined}\n     */\n    CumulativeSpeedRevolutionCount: number | undefined;\n\n    /**\n     * The calculated cadence in revolutions per minute (RPM).\n     * @type {number | undefined}\n     */\n    CalculatedCadence: number | undefined;\n\n    /**\n     * The calculated distance traveled in meters.\n     * @type {number | undefined}\n     */\n    CalculatedDistance: number | undefined;\n\n    /**\n     * The calculated speed in meters per second (m/s).\n     * @type {number | undefined}\n     */\n    CalculatedSpeed: number | undefined;\n}\n","import { SpeedCadenceSensorState } from \"./speedCadenceSensorState.js\";\n\n/**\n * Represents the state of a Speed and Cadence sensor during scanning.\n * Extends the SpeedCadenceSensorState to include additional fields specific to scanning,\n * such as RSSI (Received Signal Strength Indicator) and signal threshold.\n */\nexport class SpeedCadenceScanState extends SpeedCadenceSensorState {\n    /**\n     * The received signal strength indicator (RSSI) of the sensor signal.\n     * @type {number | undefined}\n     */\n    Rssi: number | undefined;\n\n    /**\n     * The signal threshold value.\n     * @type {number | undefined}\n     */\n    Threshold: number | undefined;\n}\n","/*\n * ANT+ profile: https://www.thisisant.com/developer/ant-plus/device-profiles/#523_tab\n * Spec sheet: https://www.thisisant.com/resources/bicycle-speed-and-cadence/\n */\n\nimport { AntPlusSensor } from \"../antPlusSensor.js\";\nimport { updateState } from \"./speedCadenceUtils.js\";\nimport { SpeedCadenceSensorState } from \"./speedCadenceSensorState.js\";\n\n/**\n * Represents a Bicycle Speed and Cadence sensor.\n * This class extends the AntPlusSensor class to handle specific data related to speed and cadence.\n */\nexport class SpeedCadenceSensor extends AntPlusSensor {\n    /**\n     * The device type code for Bicycle Speed and Cadence sensors.\n     * @type {number}\n     * @readonly\n     */\n    static deviceType: number = 0x79;\n\n    /**\n     * The wheel circumference in meters, used to calculate speed.\n     * @type {number}\n     * @default 2.199\n     */\n    wheelCircumference: number = 2.199; // default 70cm wheel\n\n    /**\n     * Sets the wheel circumference for speed calculation.\n     *\n     * @public\n     * @param {number} wheelCircumference - The wheel circumference in meters.\n     * @returns {void}\n     *\n     * @example\n     * const sensor = new SpeedCadenceSensor();\n     * sensor.setWheelCircumference(2.105); // Sets the wheel circumference to 2.105 meters\n     */\n    public setWheelCircumference(wheelCircumference: number) {\n        this.wheelCircumference = wheelCircumference;\n    }\n\n    /**\n     * Attaches the sensor to a specified ANT+ channel and initializes its state.\n     *\n     * @public\n     * @param {number} channel - The ANT+ channel number used for communication with the sensor.\n     * @param {number} deviceId - The unique identifier of the sensor device.\n     * @returns {void}\n     *\n     * @example\n     * const sensor = new SpeedCadenceSensor();\n     * sensor.attach(1, 12345); // Attaches to channel 1 with device ID 12345\n     */\n    public attach(channel: number, deviceId: number) {\n        super.attachSensor(channel, \"receive\", deviceId, SpeedCadenceSensor.deviceType, 0, 255, 8086);\n        this.state = new SpeedCadenceSensorState(deviceId);\n    }\n\n    /**\n     * The current state of the Bicycle Speed and Cadence sensor.\n     * @private\n     * @type {SpeedCadenceSensorState}\n     */\n    private state!: SpeedCadenceSensorState;\n\n    /**\n     * Updates the state of the sensor based on incoming data.\n     *\n     * @protected\n     * @param {number} deviceId - The unique identifier of the sensor device.\n     * @param {Buffer} data - The raw data buffer received from the sensor.\n     * @returns {void}\n     *\n     * @example\n     * const dataBuffer = getDataFromSensor(); // assume this function gets data from a sensor\n     * sensor.updateState(12345, dataBuffer);\n     */\n    protected updateState(deviceId: number, data: Buffer) {\n        this.state.DeviceId = deviceId;\n        updateState(this, this.state, data);\n    }\n}\n","import { AntPlusScanner } from \"../antPlusScanner.js\";\nimport { updateState } from \"./speedCadenceUtils.js\";\nimport { SpeedCadenceScanState } from \"./speedCadenceScanState.js\";\nimport { SpeedCadenceSensor } from \"./speedCadenceSensor.js\";\n\n/**\n * Represents a scanner for Speed and Cadence sensors.\n * Extends the AntPlusScanner class to handle scanning and state updates for multiple Speed and Cadence sensors.\n */\nexport class SpeedCadenceScanner extends AntPlusScanner {\n    /**\n     * Returns the device type code for Speed and Cadence sensors.\n     *\n     * @protected\n     * @returns {number} The device type code for Speed and Cadence sensors.\n     */\n    protected deviceType(): number {\n        return SpeedCadenceSensor.deviceType;\n    }\n\n    /**\n     * The wheel circumference in meters, used to calculate speed.\n     * @type {number}\n     * @default 2.199\n     */\n    wheelCircumference: number = 2.199; // default 70cm wheel\n\n    /**\n     * Sets the wheel circumference for speed calculation.\n     *\n     * @public\n     * @param {number} wheelCircumference - The wheel circumference in meters.\n     * @returns {void}\n     *\n     * @example\n     * const scanner = new SpeedCadenceScanner();\n     * scanner.setWheelCircumference(2.105); // Sets the wheel circumference to 2.105 meters\n     */\n    public setWheelCircumference(wheelCircumference: number): void {\n        this.wheelCircumference = wheelCircumference;\n    }\n\n    /**\n     * A dictionary to store the states of detected Speed and Cadence sensors by their device ID.\n     * @private\n     * @type {{ [id: number]: SpeedCadenceScanState }}\n     */\n    private states: { [id: number]: SpeedCadenceScanState } = {};\n\n    /**\n     * Creates a new state entry for a sensor if it does not already exist.\n     *\n     * @protected\n     * @param {number} deviceId - The unique identifier of the sensor device.\n     * @returns {void}\n     *\n     * @example\n     * scanner.createStateIfNew(12345); // Creates a new state for device ID 12345 if it does not exist.\n     */\n    protected createStateIfNew(deviceId: number): void {\n        if (!this.states[deviceId]) {\n            this.states[deviceId] = new SpeedCadenceScanState(deviceId);\n        }\n    }\n\n    /**\n     * Updates the RSSI (Received Signal Strength Indicator) and signal threshold for a specific sensor.\n     *\n     * @protected\n     * @param {number} deviceId - The unique identifier of the sensor device.\n     * @param {number} rssi - The received signal strength indicator of the device.\n     * @param {number} threshold - The signal threshold value for the device.\n     * @returns {void}\n     *\n     * @example\n     * scanner.updateRssiAndThreshold(12345, -70, 30); // Updates the RSSI and threshold for device ID 12345.\n     */\n    protected updateRssiAndThreshold(deviceId: number, rssi: number, threshold: number): void {\n        this.states[deviceId].Rssi = rssi;\n        this.states[deviceId].Threshold = threshold;\n    }\n\n    /**\n     * Updates the state of a sensor based on incoming data.\n     *\n     * @protected\n     * @param {number} deviceId - The unique identifier of the sensor device.\n     * @param {Buffer} data - The raw data buffer received from the sensor.\n     * @returns {void}\n     *\n     * @example\n     * const dataBuffer = getDataFromSensor(); // Assume this function gets data from a sensor\n     * scanner.updateState(12345, dataBuffer); // Updates the state for device ID 12345.\n     */\n    protected updateState(deviceId: number, data: Buffer): void {\n        updateState(this, this.states[deviceId], data);\n    }\n}\n","import { SpeedScanner } from \"./speedScanner.js\";\r\nimport { SpeedScanState } from \"./speedScanState.js\";\r\nimport { SpeedSensor } from \"./speedSensor.js\";\r\nimport { SpeedSensorState } from \"./speedSensorState.js\";\r\nimport { Messages } from \"../../utils/messages.js\";\r\n\r\nconst TOGGLE_MASK = 0x80;\r\n\r\n/**\r\n * Updates the state of a Speed sensor or scanner based on the incoming data.\r\n * Decodes various pages of data to update the state, including cumulative operating time,\r\n * manufacturer details, hardware and software versions, battery status, motion status, and speed.\r\n *\r\n * @param {SpeedSensor | SpeedScanner} sensor - The sensor or scanner instance emitting the data.\r\n * @param {SpeedSensorState | SpeedScanState} state - The current state of the sensor or scanner.\r\n * @param {Buffer} data - The raw data buffer received from the sensor.\r\n * @returns {void}\r\n * @example\r\n * const sensor = new SpeedSensor();\r\n * const state = new SpeedSensorState(12345);\r\n * const dataBuffer = getDataFromSensor(); // Assume this function gets data from a sensor\r\n * updateState(sensor, state, dataBuffer);\r\n */\r\nexport function updateState(sensor: SpeedSensor | SpeedScanner, state: SpeedSensorState | SpeedScanState, data: Buffer) {\r\n    const pageNum = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA);\r\n    switch (\r\n        pageNum & ~TOGGLE_MASK // Check the new pages and remove the toggle bit\r\n    ) {\r\n        case 1:\r\n            // Decode the cumulative operating time\r\n            state.OperatingTime = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 1);\r\n            state.OperatingTime |= data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 2) << 8;\r\n            state.OperatingTime |= data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 3) << 16;\r\n            state.OperatingTime *= 2;\r\n            break;\r\n        case 2:\r\n            // Decode the Manufacturer ID\r\n            state.ManId = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 1);\r\n            // Decode the 4-byte serial number\r\n            state.SerialNumber = state.DeviceId;\r\n            state.SerialNumber |= data.readUInt16LE(Messages.BUFFER_INDEX_MSG_DATA + 2) << 16;\r\n            state.SerialNumber >>>= 0;\r\n            break;\r\n        case 3:\r\n            // Decode hardware version, software version, and model number\r\n            state.HwVersion = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 1);\r\n            state.SwVersion = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 2);\r\n            state.ModelNum = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 3);\r\n            break;\r\n        case 4: {\r\n            // Decode battery status\r\n            const batteryFrac = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 2);\r\n            const batteryStatus = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 3);\r\n            state.BatteryVoltage = (batteryStatus & 0x0f) + batteryFrac / 256;\r\n            const batteryFlags = (batteryStatus & 0x70) >>> 4;\r\n            state.BatteryStatusBit = batteryFlags;\r\n            switch (batteryFlags) {\r\n                case 1:\r\n                    state.BatteryStatus = \"New\";\r\n                    break;\r\n                case 2:\r\n                    state.BatteryStatus = \"Good\";\r\n                    break;\r\n                case 3:\r\n                    state.BatteryStatus = \"Ok\";\r\n                    break;\r\n                case 4:\r\n                    state.BatteryStatus = \"Low\";\r\n                    break;\r\n                case 5:\r\n                    state.BatteryStatus = \"Critical\";\r\n                    break;\r\n                default:\r\n                    state.BatteryVoltage = undefined;\r\n                    state.BatteryStatus = \"Invalid\";\r\n                    break;\r\n            }\r\n            break;\r\n        }\r\n        case 5:\r\n            // Decode motion status\r\n            state.Motion = (data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 1) & 0x01) === 0x01;\r\n            break;\r\n        default:\r\n            break;\r\n    }\r\n\r\n    // Get old state for calculating cumulative values\r\n    const oldSpeedTime = state.SpeedEventTime ?? 0;\r\n    const oldSpeedCount = state.CumulativeSpeedRevolutionCount ?? 0;\r\n\r\n    let speedEventTime = data.readUInt16LE(Messages.BUFFER_INDEX_MSG_DATA + 4);\r\n    let speedRevolutionCount = data.readUInt16LE(Messages.BUFFER_INDEX_MSG_DATA + 6);\r\n\r\n    if (speedEventTime !== oldSpeedTime) {\r\n        state.SpeedEventTime = speedEventTime;\r\n        state.CumulativeSpeedRevolutionCount = speedRevolutionCount;\r\n\r\n        if (oldSpeedTime > speedEventTime) {\r\n            // Hit rollover value\r\n            speedEventTime += 1024 * 64;\r\n        }\r\n\r\n        if (oldSpeedCount > speedRevolutionCount) {\r\n            // Hit rollover value\r\n            speedRevolutionCount += 1024 * 64;\r\n        }\r\n\r\n        const distance = sensor.wheelCircumference * (speedRevolutionCount - oldSpeedCount);\r\n        state.CalculatedDistance = distance;\r\n\r\n        // Calculate speed in m/sec\r\n        const speed = (distance * 1024) / (speedEventTime - oldSpeedTime);\r\n        if (!isNaN(speed)) {\r\n            state.CalculatedSpeed = speed;\r\n            sensor.emit(\"speedData\", state);\r\n        }\r\n    }\r\n}\r\n","/**\r\n * Represents the state of a Speed sensor.\r\n * This class holds the data fields associated with the state of a Speed sensor, including\r\n * speed, distance, event times, and various sensor-specific details.\r\n */\r\nexport class SpeedSensorState {\r\n    /**\r\n     * Creates an instance of the SpeedSensorState.\r\n     *\r\n     * @param {number} deviceId - The unique identifier of the sensor device.\r\n     * @example\r\n     * const sensorState = new SpeedSensorState(12345);\r\n     */\r\n    constructor(deviceId: number) {\r\n        this.DeviceId = deviceId;\r\n    }\r\n\r\n    /**\r\n     * The unique identifier of the sensor device.\r\n     * @type {number}\r\n     */\r\n    DeviceId: number;\r\n\r\n    /**\r\n     * The time of the last speed event in seconds, measured as a fractional part.\r\n     * @type {number | undefined}\r\n     */\r\n    SpeedEventTime: number | undefined;\r\n\r\n    /**\r\n     * The cumulative count of speed revolutions since the sensor started.\r\n     * @type {number | undefined}\r\n     */\r\n    CumulativeSpeedRevolutionCount: number | undefined;\r\n\r\n    /**\r\n     * The calculated distance traveled in meters.\r\n     * @type {number | undefined}\r\n     */\r\n    CalculatedDistance: number | undefined;\r\n\r\n    /**\r\n     * The calculated speed in meters per second (m/s).\r\n     * @type {number | undefined}\r\n     */\r\n    CalculatedSpeed: number | undefined;\r\n\r\n    /**\r\n     * The cumulative operating time of the sensor in seconds.\r\n     * @type {number | undefined}\r\n     */\r\n    OperatingTime?: number;\r\n\r\n    /**\r\n     * The manufacturer ID of the sensor.\r\n     * @type {number | undefined}\r\n     */\r\n    ManId?: number;\r\n\r\n    /**\r\n     * The serial number of the sensor.\r\n     * @type {number | undefined}\r\n     */\r\n    SerialNumber?: number;\r\n\r\n    /**\r\n     * The hardware version of the sensor.\r\n     * @type {number | undefined}\r\n     */\r\n    HwVersion?: number;\r\n\r\n    /**\r\n     * The software version of the sensor.\r\n     * @type {number | undefined}\r\n     */\r\n    SwVersion?: number;\r\n\r\n    /**\r\n     * The model number of the sensor.\r\n     * @type {number | undefined}\r\n     */\r\n    ModelNum?: number;\r\n\r\n    /**\r\n     * The battery voltage of the sensor.\r\n     * @type {number | undefined}\r\n     */\r\n    BatteryVoltage?: number;\r\n\r\n    /**\r\n     * The battery status of the sensor.\r\n     * Can be \"New\", \"Good\", \"Ok\", \"Low\", \"Critical\", or \"Invalid\".\r\n     * @type {\"New\" | \"Good\" | \"Ok\" | \"Low\" | \"Critical\" | \"Invalid\" | undefined}\r\n     */\r\n    BatteryStatus?: \"New\" | \"Good\" | \"Ok\" | \"Low\" | \"Critical\" | \"Invalid\";\r\n\r\n    /**\r\n     * The battery status bit of the sensor.\r\n     */\r\n    BatteryStatusBit?: number;\r\n\r\n    /**\r\n     * Indicates whether the sensor detects motion.\r\n     * @type {boolean | undefined}\r\n     */\r\n    Motion?: boolean;\r\n}\r\n","import { SpeedSensorState } from \"./speedSensorState.js\";\n\n/**\n * Represents the state of a Speed sensor during scanning.\n * Extends the SpeedSensorState to include additional fields specific to scanning,\n * such as RSSI (Received Signal Strength Indicator) and signal threshold.\n */\nexport class SpeedScanState extends SpeedSensorState {\n    /**\n     * The received signal strength indicator (RSSI) of the sensor signal.\n     * @type {number | undefined}\n     */\n    Rssi: number | undefined;\n\n    /**\n     * The signal threshold value for the sensor.\n     * @type {number | undefined}\n     */\n    Threshold: number | undefined;\n}\n","/*\n * ANT+ profile: https://www.thisisant.com/developer/ant-plus/device-profiles/#523_tab\n * Spec sheet: https://www.thisisant.com/resources/bicycle-speed-and-cadence/\n */\n\nimport { AntPlusSensor } from \"../antPlusSensor.js\";\nimport { updateState } from \"./speedUtils.js\";\nimport { SpeedSensorState } from \"./speedSensorState.js\";\n\n/**\n * Represents a Bicycle Speed sensor.\n * This class extends the AntPlusSensor class to handle specific data related to speed measurement.\n */\nexport class SpeedSensor extends AntPlusSensor {\n    /**\n     * The device type code for Bicycle Speed sensors.\n     * @type {number}\n     * @readonly\n     */\n    static deviceType: number = 0x7b;\n\n    /**\n     * The wheel circumference in meters, used to calculate speed.\n     * @type {number}\n     * @default 2.199\n     */\n    wheelCircumference: number = 2.199; // default 70cm wheel\n\n    /**\n     * Sets the wheel circumference for speed calculation.\n     *\n     * @public\n     * @param {number} wheelCircumference - The wheel circumference in meters.\n     * @returns {void}\n     *\n     * @example\n     * const sensor = new SpeedSensor();\n     * sensor.setWheelCircumference(2.105); // Sets the wheel circumference to 2.105 meters\n     */\n    public setWheelCircumference(wheelCircumference: number) {\n        this.wheelCircumference = wheelCircumference;\n    }\n\n    /**\n     * Attaches the sensor to a specified ANT+ channel and initializes its state.\n     *\n     * @public\n     * @param {number} channel - The ANT+ channel number used for communication with the sensor.\n     * @param {number} deviceId - The unique identifier of the sensor device.\n     * @returns {void}\n     *\n     * @example\n     * const sensor = new SpeedSensor();\n     * sensor.attach(1, 12345); // Attaches to channel 1 with device ID 12345\n     */\n    public attach(channel: number, deviceId: number) {\n        super.attachSensor(channel, \"receive\", deviceId, SpeedSensor.deviceType, 0, 255, 8118);\n        this.state = new SpeedSensorState(deviceId);\n    }\n\n    /**\n     * The current state of the Bicycle Speed sensor.\n     * @private\n     * @type {SpeedSensorState}\n     */\n    private state!: SpeedSensorState;\n\n    /**\n     * Updates the state of the sensor based on incoming data.\n     *\n     * @protected\n     * @param {number} deviceId - The unique identifier of the sensor device.\n     * @param {Buffer} data - The raw data buffer received from the sensor.\n     * @returns {void}\n     *\n     * @example\n     * const dataBuffer = getDataFromSensor(); // assume this function gets data from a sensor\n     * sensor.updateState(12345, dataBuffer);\n     */\n    protected updateState(deviceId: number, data: Buffer) {\n        this.state.DeviceId = deviceId;\n        updateState(this, this.state, data);\n    }\n}\n","import { AntPlusScanner } from \"../antPlusScanner.js\";\nimport { updateState } from \"./speedUtils.js\";\nimport { SpeedScanState } from \"./speedScanState.js\";\nimport { SpeedSensor } from \"./speedSensor.js\";\n\n/**\n * Represents a scanner for Speed sensors.\n * Extends the AntPlusScanner class to handle scanning and state updates for multiple Speed sensors.\n */\nexport class SpeedScanner extends AntPlusScanner {\n    /**\n     * Returns the device type code for Speed sensors.\n     *\n     * @protected\n     * @returns {number} The device type code for Speed sensors.\n     */\n    protected deviceType(): number {\n        return SpeedSensor.deviceType;\n    }\n\n    /**\n     * The wheel circumference in meters, used to calculate speed.\n     * @type {number}\n     * @default 2.199\n     */\n    wheelCircumference: number = 2.199; // default 70cm wheel\n\n    /**\n     * Sets the wheel circumference for speed calculation.\n     *\n     * @public\n     * @param {number} wheelCircumference - The wheel circumference in meters.\n     * @returns {void}\n     *\n     * @example\n     * const scanner = new SpeedScanner();\n     * scanner.setWheelCircumference(2.105); // Sets the wheel circumference to 2.105 meters\n     */\n    public setWheelCircumference(wheelCircumference: number): void {\n        this.wheelCircumference = wheelCircumference;\n    }\n\n    /**\n     * A dictionary to store the states of detected Speed sensors by their device ID.\n     * @private\n     * @type {{ [id: number]: SpeedScanState }}\n     */\n    private states: { [id: number]: SpeedScanState } = {};\n\n    /**\n     * Creates a new state entry for a sensor if it does not already exist.\n     *\n     * @protected\n     * @param {number} deviceId - The unique identifier of the sensor device.\n     * @returns {void}\n     *\n     * @example\n     * scanner.createStateIfNew(12345); // Creates a new state for device ID 12345 if it does not exist.\n     */\n    protected createStateIfNew(deviceId: number): void {\n        if (!this.states[deviceId]) {\n            this.states[deviceId] = new SpeedScanState(deviceId);\n        }\n    }\n\n    /**\n     * Updates the RSSI (Received Signal Strength Indicator) and signal threshold for a specific sensor.\n     *\n     * @protected\n     * @param {number} deviceId - The unique identifier of the sensor device.\n     * @param {number} rssi - The received signal strength indicator of the device.\n     * @param {number} threshold - The signal threshold value for the device.\n     * @returns {void}\n     *\n     * @example\n     * scanner.updateRssiAndThreshold(12345, -70, 30); // Updates the RSSI and threshold for device ID 12345.\n     */\n    protected updateRssiAndThreshold(deviceId: number, rssi: number, threshold: number): void {\n        this.states[deviceId].Rssi = rssi;\n        this.states[deviceId].Threshold = threshold;\n    }\n\n    /**\n     * Updates the state of a sensor based on incoming data.\n     *\n     * @protected\n     * @param {number} deviceId - The unique identifier of the sensor device.\n     * @param {Buffer} data - The raw data buffer received from the sensor.\n     * @returns {void}\n     *\n     * @example\n     * const dataBuffer = getDataFromSensor(); // Assume this function gets data from a sensor\n     * scanner.updateState(12345, dataBuffer); // Updates the state for device ID 12345.\n     */\n    protected updateState(deviceId: number, data: Buffer): void {\n        updateState(this, this.states[deviceId], data);\n    }\n}\n","import { CadenceScanner } from \"./cadenceScanner.js\";\r\nimport { CadenceScanState } from \"./cadenceScanState.js\";\r\nimport { CadenceSensor } from \"./cadenceSensor.js\";\r\nimport { CadenceSensorState } from \"./cadenceSensorState.js\";\r\nimport { Messages } from \"../../utils/messages.js\";\r\n\r\nconst TOGGLE_MASK = 0x80;\r\n\r\n/**\r\n * Updates the state of a Cadence sensor or scanner based on incoming data.\r\n * Decodes the data buffer and updates the sensor state accordingly, including\r\n * cumulative values such as operating time, manufacturer details, battery status,\r\n * and calculated cadence.\r\n *\r\n * @param {CadenceSensor | CadenceScanner} sensor - The sensor or scanner instance emitting the data.\r\n * @param {CadenceSensorState | CadenceScanState} state - The current state of the sensor or scanner.\r\n * @param {Buffer} data - The raw data buffer received from the sensor.\r\n * @returns {void}\r\n *\r\n * @example\r\n * const sensor = new CadenceSensor();\r\n * const state = new CadenceSensorState(12345);\r\n * const dataBuffer = getDataFromSensor(); // Assume this function gets data from a sensor\r\n * updateState(sensor, state, dataBuffer); // Updates the state based on the received data.\r\n */\r\nexport function updateState(sensor: CadenceSensor | CadenceScanner, state: CadenceSensorState | CadenceScanState, data: Buffer): void {\r\n    const pageNum = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA);\r\n    switch (\r\n        pageNum & ~TOGGLE_MASK // Check the new pages and remove the toggle bit\r\n    ) {\r\n        case 1:\r\n            // Decode the cumulative operating time\r\n            state.OperatingTime = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 1);\r\n            state.OperatingTime |= data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 2) << 8;\r\n            state.OperatingTime |= data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 3) << 16;\r\n            state.OperatingTime *= 2;\r\n            break;\r\n        case 2:\r\n            // Decode the Manufacturer ID\r\n            state.ManId = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 1);\r\n            // Decode the 4-byte serial number\r\n            state.SerialNumber = state.DeviceId;\r\n            state.SerialNumber |= data.readUInt16LE(Messages.BUFFER_INDEX_MSG_DATA + 2) << 16;\r\n            state.SerialNumber >>>= 0;\r\n            break;\r\n        case 3:\r\n            // Decode HW version, SW version, and model number\r\n            state.HwVersion = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 1);\r\n            state.SwVersion = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 2);\r\n            state.ModelNum = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 3);\r\n            break;\r\n        case 4: {\r\n            const batteryFrac = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 2);\r\n            const batteryStatus = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 3);\r\n            state.BatteryVoltage = (batteryStatus & 0x0f) + batteryFrac / 256;\r\n            const batteryFlags = (batteryStatus & 0x70) >>> 4;\r\n            state.BatteryStatusBit = batteryFlags;\r\n            switch (batteryFlags) {\r\n                case 1:\r\n                    state.BatteryStatus = \"New\";\r\n                    break;\r\n                case 2:\r\n                    state.BatteryStatus = \"Good\";\r\n                    break;\r\n                case 3:\r\n                    state.BatteryStatus = \"Ok\";\r\n                    break;\r\n                case 4:\r\n                    state.BatteryStatus = \"Low\";\r\n                    break;\r\n                case 5:\r\n                    state.BatteryStatus = \"Critical\";\r\n                    break;\r\n                default:\r\n                    state.BatteryVoltage = undefined;\r\n                    state.BatteryStatus = \"Invalid\";\r\n                    break;\r\n            }\r\n            break;\r\n        }\r\n        case 5:\r\n            state.Motion = (data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 1) & 0x01) === 0x01;\r\n            break;\r\n        default:\r\n            break;\r\n    }\r\n\r\n    // Get old state for calculating cumulative values\r\n    const oldCadenceTime = state.CadenceEventTime ?? 0;\r\n    const oldCadenceCount = state.CumulativeCadenceRevolutionCount ?? 0;\r\n\r\n    let cadenceTime = data.readUInt16LE(Messages.BUFFER_INDEX_MSG_DATA + 4);\r\n    let cadenceCount = data.readUInt16LE(Messages.BUFFER_INDEX_MSG_DATA + 6);\r\n\r\n    if (cadenceTime !== oldCadenceTime) {\r\n        state.CadenceEventTime = cadenceTime;\r\n        state.CumulativeCadenceRevolutionCount = cadenceCount;\r\n\r\n        if (oldCadenceTime > cadenceTime) {\r\n            // Hit rollover value\r\n            cadenceTime += 1024 * 64;\r\n        }\r\n\r\n        if (oldCadenceCount > cadenceCount) {\r\n            // Hit rollover value\r\n            cadenceCount += 1024 * 64;\r\n        }\r\n\r\n        const cadence = (60 * (cadenceCount - oldCadenceCount) * 1024) / (cadenceTime - oldCadenceTime);\r\n        if (!isNaN(cadence)) {\r\n            state.CalculatedCadence = cadence;\r\n            sensor.emit(\"cadenceData\", state);\r\n        }\r\n    }\r\n}\r\n","/**\r\n * Represents the state of a Cadence Sensor.\r\n * This class holds the data fields associated with the state of a cadence sensor,\r\n * including event times, revolution counts, and device information.\r\n */\r\nexport class CadenceSensorState {\r\n    /**\r\n     * Creates an instance of the CadenceSensorState.\r\n     *\r\n     * @param {number} deviceId - The unique identifier of the sensor device.\r\n     *\r\n     * @example\r\n     * const sensorState = new CadenceSensorState(12345);\r\n     */\r\n    constructor(deviceId: number) {\r\n        this.DeviceId = deviceId;\r\n    }\r\n\r\n    /**\r\n     * The unique identifier of the sensor device.\r\n     * @type {number}\r\n     */\r\n    DeviceId: number;\r\n\r\n    /**\r\n     * The time of the last cadence event, in seconds.\r\n     * @type {number | undefined}\r\n     */\r\n    CadenceEventTime: number | undefined;\r\n\r\n    /**\r\n     * The cumulative number of cadence revolutions counted by the sensor.\r\n     * @type {number | undefined}\r\n     */\r\n    CumulativeCadenceRevolutionCount: number | undefined;\r\n\r\n    /**\r\n     * The calculated cadence in revolutions per minute (RPM).\r\n     * @type {number | undefined}\r\n     */\r\n    CalculatedCadence: number | undefined;\r\n\r\n    /**\r\n     * The cumulative operating time of the sensor in seconds.\r\n     * @type {number | undefined}\r\n     */\r\n    OperatingTime?: number;\r\n\r\n    /**\r\n     * The manufacturer ID of the sensor.\r\n     * @type {number | undefined}\r\n     */\r\n    ManId?: number;\r\n\r\n    /**\r\n     * The serial number of the sensor.\r\n     * @type {number | undefined}\r\n     */\r\n    SerialNumber?: number;\r\n\r\n    /**\r\n     * The hardware version of the sensor.\r\n     * @type {number | undefined}\r\n     */\r\n    HwVersion?: number;\r\n\r\n    /**\r\n     * The software version of the sensor.\r\n     * @type {number | undefined}\r\n     */\r\n    SwVersion?: number;\r\n\r\n    /**\r\n     * The model number of the sensor.\r\n     * @type {number | undefined}\r\n     */\r\n    ModelNum?: number;\r\n\r\n    /**\r\n     * The battery voltage of the sensor.\r\n     * @type {number | undefined}\r\n     */\r\n    BatteryVoltage?: number;\r\n\r\n    /**\r\n     * The battery status of the sensor.\r\n     * Can be one of the following: \"New\", \"Good\", \"Ok\", \"Low\", \"Critical\", \"Invalid\".\r\n     * @type {\"New\" | \"Good\" | \"Ok\" | \"Low\" | \"Critical\" | \"Invalid\" | undefined}\r\n     */\r\n    BatteryStatus?: \"New\" | \"Good\" | \"Ok\" | \"Low\" | \"Critical\" | \"Invalid\";\r\n\r\n    /**\r\n     * The battery status bit of the sensor.\r\n     */\r\n    BatteryStatusBit?: number;\r\n\r\n    /**\r\n     * Indicates whether the sensor is in motion.\r\n     * @type {boolean | undefined}\r\n     */\r\n    Motion?: boolean;\r\n}\r\n","import { CadenceSensorState } from \"./cadenceSensorState.js\";\n\n/**\n * Represents the state of a Cadence Sensor during scanning.\n * Extends the CadenceSensorState to include additional fields specific to scanning,\n * such as RSSI (Received Signal Strength Indicator) and signal threshold.\n */\nexport class CadenceScanState extends CadenceSensorState {\n    /**\n     * The received signal strength indicator (RSSI) of the sensor signal.\n     * Indicates the strength of the received signal from the cadence sensor.\n     * @type {number | undefined}\n     */\n    Rssi: number | undefined;\n\n    /**\n     * The signal threshold value for the sensor.\n     * Represents the minimum signal strength required for a reliable connection.\n     * @type {number | undefined}\n     */\n    Threshold: number | undefined;\n}\n","/*\n * ANT+ profile: https://www.thisisant.com/developer/ant-plus/device-profiles/#523_tab\n * Spec sheet: https://www.thisisant.com/resources/bicycle-speed-and-cadence/\n */\n\nimport { updateState } from \"./cadenceUtils.js\";\nimport { CadenceSensorState } from \"./cadenceSensorState.js\";\nimport { AntPlusSensor } from \"../antPlusSensor.js\";\n\n/**\n * Represents a Bicycle Cadence sensor.\n * This class extends the AntPlusSensor class to handle specific data related to cadence measurement.\n */\nexport class CadenceSensor extends AntPlusSensor {\n    /**\n     * The device type code for Bicycle Cadence sensors.\n     * @type {number}\n     * @readonly\n     */\n    static deviceType: number = 0x7a;\n\n    /**\n     * The wheel circumference in meters, used to calculate speed.\n     * @type {number}\n     * @default 2.199\n     */\n    wheelCircumference: number = 2.199; // default 70cm wheel\n\n    /**\n     * The current state of the Bicycle Cadence sensor.\n     * @private\n     * @type {CadenceSensorState}\n     */\n    private state!: CadenceSensorState;\n\n    /**\n     * Attaches the sensor to a specified ANT+ channel and initializes its state.\n     *\n     * @public\n     * @param {number} channel - The ANT+ channel number used for communication with the sensor.\n     * @param {number} deviceId - The unique identifier of the sensor device.\n     * @returns {void}\n     *\n     * @example\n     * const sensor = new CadenceSensor();\n     * sensor.attach(1, 12345); // Attaches to channel 1 with device ID 12345\n     */\n    public attach(channel: number, deviceId: number): void {\n        super.attachSensor(channel, \"receive\", deviceId, CadenceSensor.deviceType, 0, 255, 8102);\n        this.state = new CadenceSensorState(deviceId);\n    }\n\n    /**\n     * Sets the wheel circumference for speed calculation.\n     *\n     * @public\n     * @param {number} wheelCircumference - The wheel circumference in meters.\n     * @returns {void}\n     *\n     * @example\n     * const sensor = new CadenceSensor();\n     * sensor.setWheelCircumference(2.105); // Sets the wheel circumference to 2.105 meters\n     */\n    public setWheelCircumference(wheelCircumference: number): void {\n        this.wheelCircumference = wheelCircumference;\n    }\n\n    /**\n     * Updates the state of the sensor based on incoming data.\n     *\n     * @protected\n     * @param {number} deviceId - The unique identifier of the sensor device.\n     * @param {Buffer} data - The raw data buffer received from the sensor.\n     * @returns {void}\n     *\n     * @example\n     * const dataBuffer = getDataFromSensor(); // assume this function gets data from a sensor\n     * sensor.updateState(12345, dataBuffer);\n     */\n    protected updateState(deviceId: number, data: Buffer): void {\n        this.state.DeviceId = deviceId;\n        updateState(this, this.state, data);\n    }\n}\n","import { updateState } from \"./cadenceUtils.js\";\nimport { CadenceScanState } from \"./cadenceScanState.js\";\nimport { CadenceSensor } from \"./cadenceSensor.js\";\nimport { AntPlusScanner } from \"../antPlusScanner.js\";\n\n/**\n * Represents a scanner for Cadence sensors.\n * Extends the AntPlusScanner class to handle scanning and state updates for multiple cadence sensors.\n */\nexport class CadenceScanner extends AntPlusScanner {\n    /**\n     * Returns the device type code for Cadence sensors.\n     *\n     * @protected\n     * @returns {number} The device type code for Cadence sensors.\n     */\n    protected deviceType(): number {\n        return CadenceSensor.deviceType;\n    }\n\n    /**\n     * The wheel circumference used for cadence calculations, in meters.\n     * Defaults to 2.199 meters (70 cm wheel).\n     * @type {number}\n     */\n    wheelCircumference: number = 2.199;\n\n    /**\n     * Sets the wheel circumference for cadence calculations.\n     *\n     * @public\n     * @param {number} wheelCircumference - The wheel circumference in meters.\n     * @returns {void}\n     *\n     * @example\n     * scanner.setWheelCircumference(2.105); // Sets the wheel circumference to 2.105 meters\n     */\n    public setWheelCircumference(wheelCircumference: number): void {\n        this.wheelCircumference = wheelCircumference;\n    }\n\n    /**\n     * A dictionary to store the states of detected Cadence sensors by their device ID.\n     * @private\n     * @type {{ [id: number]: CadenceScanState }}\n     */\n    private states: { [id: number]: CadenceScanState } = {};\n\n    /**\n     * Creates a new state entry for a sensor if it does not already exist.\n     *\n     * @protected\n     * @param {number} deviceId - The unique identifier of the sensor device.\n     * @returns {void}\n     *\n     * @example\n     * scanner.createStateIfNew(12345); // Creates a new state for device ID 12345 if it does not exist.\n     */\n    protected createStateIfNew(deviceId: number): void {\n        if (!this.states[deviceId]) {\n            this.states[deviceId] = new CadenceScanState(deviceId);\n        }\n    }\n\n    /**\n     * Updates the RSSI (Received Signal Strength Indicator) and signal threshold for a specific sensor.\n     *\n     * @protected\n     * @param {number} deviceId - The unique identifier of the sensor device.\n     * @param {number} rssi - The received signal strength indicator of the device.\n     * @param {number} threshold - The signal threshold value for the device.\n     * @returns {void}\n     *\n     * @example\n     * scanner.updateRssiAndThreshold(12345, -70, 30); // Updates the RSSI and threshold for device ID 12345.\n     */\n    protected updateRssiAndThreshold(deviceId: number, rssi: number, threshold: number): void {\n        this.states[deviceId].Rssi = rssi;\n        this.states[deviceId].Threshold = threshold;\n    }\n\n    /**\n     * Updates the state of a sensor based on incoming data.\n     *\n     * @protected\n     * @param {number} deviceId - The unique identifier of the sensor device.\n     * @param {Buffer} data - The raw data buffer received from the sensor.\n     * @returns {void}\n     *\n     * @example\n     * const dataBuffer = getDataFromSensor(); // Assume this function gets data from a sensor\n     * scanner.updateState(12345, dataBuffer); // Updates the state for device ID 12345.\n     */\n    protected updateState(deviceId: number, data: Buffer): void {\n        updateState(this, this.states[deviceId], data);\n    }\n}\n","import { BicyclePowerScanner } from \"./bicyclePowerScanner.js\";\nimport { BicyclePowerScanState } from \"./bicyclePowerScanState.js\";\nimport { BicyclePowerSensor } from \"./bicyclePowerSensor.js\";\nimport { BicyclePowerSensorState } from \"./bicyclePowerSensorState.js\";\nimport { Messages } from \"../../utils/messages.js\";\n\n/**\n * Updates the state of a Bicycle Power sensor or scanner based on incoming data.\n * Processes various types of data pages to update the sensor state, including calibration data,\n * pedal power, cadence, and torque calculations.\n *\n * @param {BicyclePowerSensor | BicyclePowerScanner} sensor - The sensor or scanner to update.\n * @param {BicyclePowerSensorState | BicyclePowerScanState} state - The state object representing the current state of the sensor.\n * @param {Buffer} data - The raw data buffer received from the sensor.\n * @returns {void}\n *\n * @example\n * const sensor = new BicyclePowerSensor();\n * const state = new BicyclePowerSensorState(12345);\n * const dataBuffer = getDataFromSensor(); // Assume this function gets data from a sensor\n * updateState(sensor, state, dataBuffer);\n */\nexport function updateState(sensor: BicyclePowerSensor | BicyclePowerScanner, state: BicyclePowerSensorState | BicyclePowerScanState, data: Buffer): void {\n    const page = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA);\n    switch (page) {\n        case 0x01: {\n            const calId = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 1);\n            if (calId === 0x10) {\n                const calParam = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 2);\n                if (calParam === 0x01) {\n                    state.offset = data.readUInt16LE(Messages.BUFFER_INDEX_MSG_DATA + 6);\n                }\n            }\n            break;\n        }\n        case 0x10: {\n            const pedalPower = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 2);\n            if (pedalPower !== 0xff) {\n                if (pedalPower & 0x80) {\n                    state.PedalPower = pedalPower & 0x7f;\n                    state.RightPedalPower = state.PedalPower;\n                    state.LeftPedalPower = 100 - state.RightPedalPower;\n                } else {\n                    state.PedalPower = pedalPower & 0x7f;\n                    state.RightPedalPower = undefined;\n                    state.LeftPedalPower = undefined;\n                }\n            } else {\n                state.PedalPower = undefined;\n                state.RightPedalPower = undefined;\n                state.LeftPedalPower = undefined;\n            }\n            const cadence = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 3);\n            if (cadence !== 0xff) {\n                state.Cadence = cadence;\n            } else {\n                state.Cadence = undefined;\n            }\n            state.AccumulatedPower = data.readUInt16LE(Messages.BUFFER_INDEX_MSG_DATA + 4);\n            state.Power = data.readUInt16LE(Messages.BUFFER_INDEX_MSG_DATA + 6);\n            break;\n        }\n        case 0x20: {\n            const oldEventCount = state.EventCount ?? 0;\n            const oldTimeStamp = state.TimeStamp ?? 0;\n            const oldTorqueTicksStamp = state.TorqueTicksStamp ?? 0;\n\n            let eventCount = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 1);\n            const slope = data.readUInt16LE(Messages.BUFFER_INDEX_MSG_DATA + 3);\n            let timeStamp = data.readUInt16LE(Messages.BUFFER_INDEX_MSG_DATA + 5);\n            let torqueTicksStamp = data.readUInt16LE(Messages.BUFFER_INDEX_MSG_DATA + 7);\n\n            if (timeStamp !== oldTimeStamp && eventCount !== oldEventCount) {\n                state.EventCount = eventCount;\n                if (oldEventCount > eventCount) {\n                    // Hit rollover value\n                    eventCount += 255;\n                }\n\n                state.TimeStamp = timeStamp;\n                if (oldTimeStamp > timeStamp) {\n                    // Hit rollover value\n                    timeStamp += 65400;\n                }\n\n                state.Slope = slope;\n                state.TorqueTicksStamp = torqueTicksStamp;\n                if (oldTorqueTicksStamp > torqueTicksStamp) {\n                    // Hit rollover value\n                    torqueTicksStamp += 65535;\n                }\n\n                const elapsedTime = (timeStamp - oldTimeStamp) * 0.0005;\n                const torqueTicks = torqueTicksStamp - oldTorqueTicksStamp;\n\n                const cadencePeriod = elapsedTime / (eventCount - oldEventCount); // seconds\n                const cadence = Math.round(60 / cadencePeriod); // RPM\n                state.CalculatedCadence = cadence;\n\n                const torqueFrequency = 1 / (elapsedTime / torqueTicks) - state.offset; // Hz\n                const torque = torqueFrequency / (slope / 10); // Nm\n                state.CalculatedTorque = torque;\n\n                state.CalculatedPower = (torque * cadence * Math.PI) / 30; // Watts\n            }\n            break;\n        }\n        default:\n            return;\n    }\n    sensor.emit(\"powerData\", state);\n}\n","/**\n * Represents the state of a Bicycle Power sensor.\n * Stores various metrics and calculated values related to bicycle power, such as pedal power, cadence, torque, and power.\n */\nexport class BicyclePowerSensorState {\n    /**\n     * Creates an instance of BicyclePowerSensorState.\n     *\n     * @param {number} deviceId - The unique identifier of the sensor device.\n     */\n    constructor(deviceId: number) {\n        this.DeviceId = deviceId;\n    }\n\n    /**\n     * The unique identifier of the sensor device.\n     * @type {number}\n     */\n    DeviceId: number;\n\n    /**\n     * The total pedal power percentage.\n     * Represents the percentage of power produced by the pedal strokes.\n     * @type {number | undefined}\n     */\n    PedalPower?: number;\n\n    /**\n     * The power percentage from the right pedal.\n     * If available, represents the contribution of the right pedal to the total power.\n     * @type {number | undefined}\n     */\n    RightPedalPower?: number;\n\n    /**\n     * The power percentage from the left pedal.\n     * If available, represents the contribution of the left pedal to the total power.\n     * @type {number | undefined}\n     */\n    LeftPedalPower?: number;\n\n    /**\n     * The cadence value in revolutions per minute (RPM).\n     * Represents the number of pedal revolutions per minute.\n     * @type {number | undefined}\n     */\n    Cadence?: number;\n\n    /**\n     * The accumulated power in watts.\n     * Represents the total power output accumulated over time.\n     * @type {number | undefined}\n     */\n    AccumulatedPower?: number;\n\n    /**\n     * The current power output in watts.\n     * Represents the instantaneous power output of the cyclist.\n     * @type {number | undefined}\n     */\n    Power?: number;\n\n    /**\n     * The offset value used for torque calculations.\n     * @type {number}\n     * @default 0\n     */\n    offset: number = 0;\n\n    /**\n     * The event count value.\n     * Represents the number of events recorded by the sensor.\n     * @type {number | undefined}\n     */\n    EventCount?: number;\n\n    /**\n     * The timestamp of the last recorded event.\n     * Represents the time at which the last event was recorded.\n     * @type {number | undefined}\n     */\n    TimeStamp?: number;\n\n    /**\n     * The slope value used for torque calculations.\n     * Represents the slope or gradient used in the torque computation.\n     * @type {number | undefined}\n     */\n    Slope?: number;\n\n    /**\n     * The timestamp for the last torque tick.\n     * Represents the time at which the last torque measurement was recorded.\n     * @type {number | undefined}\n     */\n    TorqueTicksStamp?: number;\n\n    /**\n     * The calculated cadence in RPM.\n     * Represents the calculated cadence based on sensor data.\n     * @type {number | undefined}\n     */\n    CalculatedCadence?: number;\n\n    /**\n     * The calculated torque in Newton meters (Nm).\n     * Represents the torque calculated from sensor data.\n     * @type {number | undefined}\n     */\n    CalculatedTorque?: number;\n\n    /**\n     * The calculated power in watts.\n     * Represents the power calculated from torque and cadence data.\n     * @type {number | undefined}\n     */\n    CalculatedPower?: number;\n}\n","import { BicyclePowerSensorState } from \"./bicyclePowerSensorState.js\";\n\n/**\n * Represents the scan state of a Bicycle Power sensor.\n * Extends the BicyclePowerSensorState to include additional data related to signal quality during a scan.\n */\nexport class BicyclePowerScanState extends BicyclePowerSensorState {\n    /**\n     * Received Signal Strength Indicator (RSSI).\n     * Represents the strength of the received signal from the sensor.\n     * @type {number | undefined}\n     */\n    Rssi: number | undefined;\n\n    /**\n     * The threshold value for the RSSI.\n     * Represents the minimum acceptable signal strength for communication.\n     * @type {number | undefined}\n     */\n    Threshold: number | undefined;\n}\n","/*\n * ANT+ profile: https://www.thisisant.com/developer/ant-plus/device-profiles/#521_tab\n * Spec sheet: https://www.thisisant.com/resources/bicycle-power/\n */\n\nimport { updateState } from \"./bicyclePowerUtils.js\";\nimport { BicyclePowerSensorState } from \"./bicyclePowerSensorState.js\";\nimport { AntPlusSensor } from \"../antPlusSensor.js\";\n\n/**\n * Represents a Bicycle Power sensor.\n * This class extends the AntPlusSensor class to handle specific data related to bicycle power measurement.\n */\nexport class BicyclePowerSensor extends AntPlusSensor {\n    /**\n     * The device type code for Bicycle Power sensors.\n     * @type {number}\n     * @readonly\n     */\n    static deviceType: number = 0x0b;\n\n    /**\n     * The current state of the Bicycle Power sensor.\n     * @private\n     * @type {BicyclePowerSensorState}\n     */\n    private state!: BicyclePowerSensorState;\n\n    /**\n     * Attaches the sensor to a specified ANT+ channel and initializes its state.\n     *\n     * @public\n     * @param {number} channel - The ANT+ channel number used for communication with the sensor.\n     * @param {number} deviceId - The unique identifier of the sensor device.\n     * @returns {void}\n     *\n     * @example\n     * const sensor = new BicyclePowerSensor();\n     * sensor.attach(1, 12345); // Attaches to channel 1 with device ID 12345\n     */\n    public attach(channel: number, deviceId: number): void {\n        super.attachSensor(channel, \"receive\", deviceId, BicyclePowerSensor.deviceType, 0, 255, 8182);\n        this.state = new BicyclePowerSensorState(deviceId);\n    }\n\n    /**\n     * Updates the state of the sensor based on incoming data.\n     *\n     * @protected\n     * @param {number} deviceId - The unique identifier of the sensor device.\n     * @param {Buffer} data - The raw data buffer received from the sensor.\n     * @returns {void}\n     *\n     * @example\n     * const dataBuffer = getDataFromSensor(); // Assume this function gets data from a sensor\n     * sensor.updateState(12345, dataBuffer);\n     */\n    protected updateState(deviceId: number, data: Buffer): void {\n        this.state.DeviceId = deviceId;\n        updateState(this, this.state, data);\n    }\n}\n","import { updateState } from \"./bicyclePowerUtils.js\";\nimport { BicyclePowerScanState } from \"./bicyclePowerScanState.js\";\nimport { BicyclePowerSensor } from \"./bicyclePowerSensor.js\";\nimport { AntPlusScanner } from \"../antPlusScanner.js\";\n\n/**\n * Represents a scanner for Bicycle Power sensors.\n * Extends the AntPlusScanner class to handle scanning for multiple Bicycle Power sensors.\n */\nexport class BicyclePowerScanner extends AntPlusScanner {\n    /**\n     * Returns the device type for Bicycle Power sensors.\n     *\n     * @protected\n     * @returns {number} The device type identifier for Bicycle Power sensors.\n     */\n    protected deviceType() {\n        return BicyclePowerSensor.deviceType;\n    }\n\n    /**\n     * A collection of states for each detected Bicycle Power sensor, keyed by device ID.\n     * @private\n     * @type {{ [id: number]: BicyclePowerScanState }}\n     */\n    private states: { [id: number]: BicyclePowerScanState } = {};\n\n    /**\n     * Creates a new state entry for a Bicycle Power sensor if it does not already exist.\n     *\n     * @protected\n     * @param {number} deviceId - The unique identifier of the sensor device.\n     * @returns {void}\n     */\n    protected createStateIfNew(deviceId: number) {\n        if (!this.states[deviceId]) {\n            this.states[deviceId] = new BicyclePowerScanState(deviceId);\n        }\n    }\n\n    /**\n     * Updates the RSSI (Received Signal Strength Indicator) and threshold for a specific Bicycle Power sensor.\n     *\n     * @protected\n     * @param {number} deviceId - The unique identifier of the sensor device.\n     * @param {number} rssi - The received signal strength indicator value.\n     * @param {number} threshold - The threshold value for the RSSI.\n     * @returns {void}\n     */\n    protected updateRssiAndThreshold(deviceId: number, rssi: number, threshold: number) {\n        this.states[deviceId].Rssi = rssi;\n        this.states[deviceId].Threshold = threshold;\n    }\n\n    /**\n     * Updates the state of a specific Bicycle Power sensor based on incoming data.\n     *\n     * @protected\n     * @param {number} deviceId - The unique identifier of the sensor device.\n     * @param {Buffer} data - The raw data buffer received from the sensor.\n     * @returns {void}\n     *\n     * @example\n     * const dataBuffer = getDataFromSensor(); // assume this function gets data from a sensor\n     * scanner.updateState(12345, dataBuffer);\n     */\n    protected updateState(deviceId: number, data: Buffer) {\n        updateState(this, this.states[deviceId], data);\n    }\n}\n","import { Messages } from \"../../utils/messages.js\";\nimport { FitnessEquipmentSensorState } from \"./fitnessEquipmentSensorState.js\";\nimport { FitnessEquipmentScanState } from \"./fitnessEquipmentScanState.js\";\nimport { FitnessEquipmentSensor } from \"./fitnessEquipmentSensor.js\";\nimport { FitnessEquipmentScanner } from \"./fitnessEquipmentScanner.js\";\n\n/**\n * Resets the state of the fitness equipment sensor by deleting all relevant properties.\n *\n * @param {FitnessEquipmentSensorState | FitnessEquipmentScanState} state - The state object of the fitness equipment sensor to reset.\n * @returns {void}\n */\nfunction resetState(state: FitnessEquipmentSensorState | FitnessEquipmentScanState): void {\n    delete state.ElapsedTime;\n    delete state.Distance;\n    delete state.RealSpeed;\n    delete state.VirtualSpeed;\n    delete state.HeartRate;\n    delete state.HeartRateSource;\n    delete state.CycleLength;\n    delete state.Incline;\n    delete state.Resistance;\n    delete state.METs;\n    delete state.CaloricBurnRate;\n    delete state.Calories;\n    delete state._EventCount0x19;\n    delete state._EventCount0x1A;\n    delete state.Cadence;\n    delete state.AccumulatedPower;\n    delete state.InstantaneousPower;\n    delete state.AveragePower;\n    delete state.TrainerStatus;\n    delete state.TargetStatus;\n    delete state.AscendedDistance;\n    delete state.DescendedDistance;\n    delete state.Strides;\n    delete state.Strokes;\n    delete state.WheelTicks;\n    delete state.WheelPeriod;\n    delete state.Torque;\n}\n\n/**\n * Updates the state of the fitness equipment sensor or scanner based on the received data.\n *\n * @param {FitnessEquipmentSensor | FitnessEquipmentScanner} sensor - The sensor or scanner instance to update.\n * @param {FitnessEquipmentSensorState | FitnessEquipmentScanState} state - The current state of the sensor or scanner.\n * @param {Buffer} data - The raw data buffer received from the fitness equipment.\n * @returns {void}\n *\n * @example\n * updateState(sensor, state, data);\n */\nexport function updateState(sensor: FitnessEquipmentSensor | FitnessEquipmentScanner, state: FitnessEquipmentSensorState | FitnessEquipmentScanState, data: Buffer): void {\n    const page = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA);\n    switch (page) {\n        case 0x01: {\n            const temperature = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 3);\n            if (temperature !== 0xff) {\n                state.Temperature = -25 + temperature * 0.5;\n            }\n            const calBF = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 1);\n            if (calBF & 0x40) {\n                state.ZeroOffset = data.readUInt16LE(Messages.BUFFER_INDEX_MSG_DATA + 4);\n            }\n            if (calBF & 0x80) {\n                state.SpinDownTime = data.readUInt16LE(Messages.BUFFER_INDEX_MSG_DATA + 6);\n            }\n            break;\n        }\n        case 0x10: {\n            const equipmentTypeBF = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 1);\n            switch (equipmentTypeBF & 0x1f) {\n                case 19:\n                    state.EquipmentType = \"Treadmill\";\n                    break;\n                case 20:\n                    state.EquipmentType = \"Elliptical\";\n                    break;\n                case 21:\n                    state.EquipmentType = \"Reserved\";\n                    break;\n                case 22:\n                    state.EquipmentType = \"Rower\";\n                    break;\n                case 23:\n                    state.EquipmentType = \"Climber\";\n                    break;\n                case 24:\n                    state.EquipmentType = \"NordicSkier\";\n                    break;\n                case 25:\n                    state.EquipmentType = \"Trainer/StationaryBike\";\n                    break;\n                default:\n                    state.EquipmentType = \"General\";\n                    break;\n            }\n            let elapsedTime = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 2);\n            let distance = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 3);\n            const speed = data.readUInt16LE(Messages.BUFFER_INDEX_MSG_DATA + 4);\n            const heartRate = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 6);\n            const capStateBF = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 7);\n            if (heartRate !== 0xff) {\n                switch (capStateBF & 0x03) {\n                    case 3: {\n                        state.HeartRate = heartRate;\n                        state.HeartRateSource = \"HandContact\";\n                        break;\n                    }\n                    case 2: {\n                        state.HeartRate = heartRate;\n                        state.HeartRateSource = \"EM\";\n                        break;\n                    }\n                    case 1: {\n                        state.HeartRate = heartRate;\n                        state.HeartRateSource = \"ANT+\";\n                        break;\n                    }\n                    default: {\n                        delete state.HeartRate;\n                        delete state.HeartRateSource;\n                        break;\n                    }\n                }\n            }\n\n            elapsedTime /= 4;\n            const oldElapsedTime = (state.ElapsedTime || 0) % 64;\n            if (elapsedTime !== oldElapsedTime) {\n                if (oldElapsedTime > elapsedTime) {\n                    // Hit rollover value\n                    elapsedTime += 64;\n                }\n            }\n            state.ElapsedTime = (state.ElapsedTime || 0) + elapsedTime - oldElapsedTime;\n\n            if (capStateBF & 0x04) {\n                const oldDistance = (state.Distance || 0) % 256;\n                if (distance !== oldDistance) {\n                    if (oldDistance > distance) {\n                        // Hit rollover value\n                        distance += 256;\n                    }\n                }\n                state.Distance = (state.Distance || 0) + distance - oldDistance;\n            } else {\n                delete state.Distance;\n            }\n            if (capStateBF & 0x08) {\n                state.VirtualSpeed = speed / 1000;\n                delete state.RealSpeed;\n            } else {\n                delete state.VirtualSpeed;\n                state.RealSpeed = speed / 1000;\n            }\n            switch ((capStateBF & 0x70) >> 4) {\n                case 1:\n                    state.State = \"OFF\";\n                    break;\n                case 2:\n                    state.State = \"READY\";\n                    resetState(state);\n                    break;\n                case 3:\n                    state.State = \"IN_USE\";\n                    break;\n                case 4:\n                    state.State = \"FINISHED\";\n                    break;\n                default:\n                    delete state.State;\n                    break;\n            }\n            if (capStateBF & 0x80) {\n                // lap\n            }\n            break;\n        }\n        case 0x11: {\n            const cycleLen = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 3);\n            const incline = data.readInt16LE(Messages.BUFFER_INDEX_MSG_DATA + 4);\n            const resistance = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 6);\n            const capStateBF = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 7);\n            if (cycleLen !== 0xff) {\n                state.CycleLength = cycleLen / 100;\n            }\n            if (incline >= -10000 && incline <= 10000) {\n                state.Incline = incline / 100;\n            }\n            if (resistance !== 0xff) {\n                state.Resistance = resistance;\n            }\n            switch ((capStateBF & 0x70) >> 4) {\n                case 1:\n                    state.State = \"OFF\";\n                    break;\n                case 2:\n                    state.State = \"READY\";\n                    resetState(state);\n                    break;\n                case 3:\n                    state.State = \"IN_USE\";\n                    break;\n                case 4:\n                    state.State = \"FINISHED\";\n                    break;\n                default:\n                    delete state.State;\n                    break;\n            }\n            if (capStateBF & 0x80) {\n                // lap\n            }\n            break;\n        }\n        case 0x12: {\n            const mets = data.readUInt16LE(Messages.BUFFER_INDEX_MSG_DATA + 2);\n            const caloricbr = data.readUInt16LE(Messages.BUFFER_INDEX_MSG_DATA + 4);\n            const calories = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 6);\n            const capStateBF = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 7);\n            if (mets !== 0xffff) {\n                state.METs = mets / 100;\n            }\n            if (caloricbr !== 0xffff) {\n                state.CaloricBurnRate = caloricbr / 10;\n            }\n            if (capStateBF & 0x01) {\n                state.Calories = calories;\n            }\n            switch ((capStateBF & 0x70) >> 4) {\n                case 1:\n                    state.State = \"OFF\";\n                    break;\n                case 2:\n                    state.State = \"READY\";\n                    resetState(state);\n                    break;\n                case 3:\n                    state.State = \"IN_USE\";\n                    break;\n                case 4:\n                    state.State = \"FINISHED\";\n                    break;\n                default:\n                    delete state.State;\n                    break;\n            }\n            if (capStateBF & 0x80) {\n                // lap\n            }\n            break;\n        }\n        case 0x13: {\n            const cadence = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 4);\n            let negDistance = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 5);\n            let posDistance = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 6);\n            const flagStateBF = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 7);\n\n            if (cadence !== 0xff) {\n                state.Cadence = cadence;\n            }\n\n            if (flagStateBF & 0x02) {\n                const oldNegDistance = (state.DescendedDistance || 0) % 256;\n                if (negDistance !== oldNegDistance) {\n                    if (oldNegDistance > negDistance) {\n                        negDistance += 256;\n                    }\n                }\n                state.DescendedDistance = (state.DescendedDistance || 0) + negDistance - oldNegDistance;\n            }\n\n            if (flagStateBF & 0x01) {\n                const oldPosDistance = (state.AscendedDistance || 0) % 256;\n                if (posDistance !== oldPosDistance) {\n                    if (oldPosDistance > posDistance) {\n                        posDistance += 256;\n                    }\n                }\n                state.AscendedDistance = (state.AscendedDistance || 0) + posDistance - oldPosDistance;\n            }\n\n            switch ((flagStateBF & 0x70) >> 4) {\n                case 1:\n                    state.State = \"OFF\";\n                    break;\n                case 2:\n                    state.State = \"READY\";\n                    resetState(state);\n                    break;\n                case 3:\n                    state.State = \"IN_USE\";\n                    break;\n                case 4:\n                    state.State = \"FINISHED\";\n                    break;\n                default:\n                    delete state.State;\n                    break;\n            }\n            if (flagStateBF & 0x80) {\n                // lap\n            }\n\n            break;\n        }\n        case 0x14: {\n            let posDistance = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 2);\n            let strides = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 3);\n            const cadence = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 4);\n            const power = data.readUInt16LE(Messages.BUFFER_INDEX_MSG_DATA + 5);\n            const flagStateBF = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 7);\n\n            if (cadence !== 0xff) {\n                state.Cadence = cadence;\n            }\n\n            if (power !== 0xffff) {\n                state.InstantaneousPower = power;\n            }\n\n            if (flagStateBF & 0x02) {\n                const oldPosDistance = (state.AscendedDistance || 0) % 256;\n                if (posDistance !== oldPosDistance) {\n                    if (oldPosDistance > posDistance) {\n                        posDistance += 256;\n                    }\n                }\n                state.AscendedDistance = (state.AscendedDistance || 0) + posDistance - oldPosDistance;\n            }\n\n            if (flagStateBF & 0x01) {\n                const oldStrides = (state.Strides || 0) % 256;\n                if (strides !== oldStrides) {\n                    if (oldStrides > strides) {\n                        strides += 256;\n                    }\n                }\n                state.Strides = (state.Strides || 0) + strides - oldStrides;\n            }\n\n            switch ((flagStateBF & 0x70) >> 4) {\n                case 1:\n                    state.State = \"OFF\";\n                    break;\n                case 2:\n                    state.State = \"READY\";\n                    resetState(state);\n                    break;\n                case 3:\n                    state.State = \"IN_USE\";\n                    break;\n                case 4:\n                    state.State = \"FINISHED\";\n                    break;\n                default:\n                    delete state.State;\n                    break;\n            }\n            if (flagStateBF & 0x80) {\n                // lap\n            }\n\n            break;\n        }\n        case 0x16: {\n            let strokes = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 3);\n            const cadence = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 4);\n            const power = data.readUInt16LE(Messages.BUFFER_INDEX_MSG_DATA + 5);\n            const flagStateBF = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 7);\n\n            if (cadence !== 0xff) {\n                state.Cadence = cadence;\n            }\n\n            if (power !== 0xffff) {\n                state.InstantaneousPower = power;\n            }\n\n            if (flagStateBF & 0x01) {\n                const oldStrokes = (state.Strokes || 0) % 256;\n                if (strokes !== oldStrokes) {\n                    if (oldStrokes > strokes) {\n                        strokes += 256;\n                    }\n                }\n                state.Strokes = (state.Strokes || 0) + strokes - oldStrokes;\n            }\n\n            switch ((flagStateBF & 0x70) >> 4) {\n                case 1:\n                    state.State = \"OFF\";\n                    break;\n                case 2:\n                    state.State = \"READY\";\n                    resetState(state);\n                    break;\n                case 3:\n                    state.State = \"IN_USE\";\n                    break;\n                case 4:\n                    state.State = \"FINISHED\";\n                    break;\n                default:\n                    delete state.State;\n                    break;\n            }\n            if (flagStateBF & 0x80) {\n                // lap\n            }\n\n            break;\n        }\n        case 0x17: {\n            let strides = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 3);\n            const cadence = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 4);\n            const power = data.readUInt16LE(Messages.BUFFER_INDEX_MSG_DATA + 5);\n            const flagStateBF = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 7);\n\n            if (cadence !== 0xff) {\n                state.Cadence = cadence;\n            }\n\n            if (power !== 0xffff) {\n                state.InstantaneousPower = power;\n            }\n\n            if (flagStateBF & 0x01) {\n                const oldStrides = (state.Strides || 0) % 256;\n                if (strides !== oldStrides) {\n                    if (oldStrides > strides) {\n                        strides += 256;\n                    }\n                }\n                state.Strides = (state.Strides || 0) + strides - oldStrides;\n            }\n\n            switch ((flagStateBF & 0x70) >> 4) {\n                case 1:\n                    state.State = \"OFF\";\n                    break;\n                case 2:\n                    state.State = \"READY\";\n                    resetState(state);\n                    break;\n                case 3:\n                    state.State = \"IN_USE\";\n                    break;\n                case 4:\n                    state.State = \"FINISHED\";\n                    break;\n                default:\n                    delete state.State;\n                    break;\n            }\n            if (flagStateBF & 0x80) {\n                // lap\n            }\n\n            break;\n        }\n        case 0x18: {\n            let strides = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 3);\n            const cadence = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 4);\n            const power = data.readUInt16LE(Messages.BUFFER_INDEX_MSG_DATA + 5);\n            const flagStateBF = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 7);\n\n            if (cadence !== 0xff) {\n                state.Cadence = cadence;\n            }\n\n            if (power !== 0xffff) {\n                state.InstantaneousPower = power;\n            }\n\n            if (flagStateBF & 0x01) {\n                const oldStrides = (state.Strides || 0) % 256;\n                if (strides !== oldStrides) {\n                    if (oldStrides > strides) {\n                        strides += 256;\n                    }\n                }\n                state.Strides = (state.Strides || 0) + strides - oldStrides;\n            }\n\n            switch ((flagStateBF & 0x70) >> 4) {\n                case 1:\n                    state.State = \"OFF\";\n                    break;\n                case 2:\n                    state.State = \"READY\";\n                    resetState(state);\n                    break;\n                case 3:\n                    state.State = \"IN_USE\";\n                    break;\n                case 4:\n                    state.State = \"FINISHED\";\n                    break;\n                default:\n                    delete state.State;\n                    break;\n            }\n            if (flagStateBF & 0x80) {\n                // lap\n            }\n\n            break;\n        }\n        case 0x19: {\n            const oldEventCount = state._EventCount0x19 || 0;\n\n            let eventCount = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 1);\n            const cadence = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 2);\n            let accPower = data.readUInt16LE(Messages.BUFFER_INDEX_MSG_DATA + 3);\n            const power = data.readUInt16LE(Messages.BUFFER_INDEX_MSG_DATA + 5) & 0xfff;\n            const trainerStatus = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 6) >> 4;\n            const flagStateBF = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 7);\n\n            if (eventCount !== oldEventCount) {\n                state._EventCount0x19 = eventCount;\n                if (oldEventCount > eventCount) {\n                    //Hit rollover value\n                    eventCount += 255;\n                }\n            }\n\n            if (cadence !== 0xff) {\n                state.Cadence = cadence;\n            }\n\n            if (power !== 0xfff) {\n                state.InstantaneousPower = power;\n\n                const oldAccPower = (state.AccumulatedPower || 0) % 65536;\n                if (accPower !== oldAccPower) {\n                    if (oldAccPower > accPower) {\n                        accPower += 65536;\n                    }\n                }\n                state.AccumulatedPower = (state.AccumulatedPower || 0) + accPower - oldAccPower;\n\n                state.AveragePower = (accPower - oldAccPower) / (eventCount - oldEventCount);\n            }\n\n            state.TrainerStatus = trainerStatus;\n\n            switch (flagStateBF & 0x03) {\n                case 0:\n                    state.TargetStatus = \"OnTarget\";\n                    break;\n                case 1:\n                    state.TargetStatus = \"LowSpeed\";\n                    break;\n                case 2:\n                    state.TargetStatus = \"HighSpeed\";\n                    break;\n                default:\n                    delete state.TargetStatus;\n                    break;\n            }\n\n            switch ((flagStateBF & 0x70) >> 4) {\n                case 1:\n                    state.State = \"OFF\";\n                    break;\n                case 2:\n                    state.State = \"READY\";\n                    resetState(state);\n                    break;\n                case 3:\n                    state.State = \"IN_USE\";\n                    break;\n                case 4:\n                    state.State = \"FINISHED\";\n                    break;\n                default:\n                    delete state.State;\n                    break;\n            }\n            if (flagStateBF & 0x80) {\n                // lap\n            }\n\n            break;\n        }\n        case 0x1a: {\n            const oldEventCount = state._EventCount0x1A || 0;\n\n            let eventCount = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 1);\n            let wheelTicks = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 2);\n            let accWheelPeriod = data.readUInt16LE(Messages.BUFFER_INDEX_MSG_DATA + 3);\n            let accTorque = data.readUInt16LE(Messages.BUFFER_INDEX_MSG_DATA + 5);\n            const flagStateBF = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 7);\n\n            if (eventCount !== oldEventCount) {\n                state._EventCount0x1A = eventCount;\n                if (oldEventCount > eventCount) {\n                    //Hit rollover value\n                    eventCount += 255;\n                }\n            }\n\n            const oldWheelTicks = (state.WheelTicks || 0) % 256;\n            if (wheelTicks !== oldWheelTicks) {\n                if (oldWheelTicks > wheelTicks) {\n                    wheelTicks += 65536;\n                }\n            }\n            state.WheelTicks = (state.WheelTicks || 0) + wheelTicks - oldWheelTicks;\n\n            const oldWheelPeriod = (state.WheelPeriod || 0) % 256;\n            if (accWheelPeriod !== oldWheelPeriod) {\n                if (oldWheelPeriod > accWheelPeriod) {\n                    accWheelPeriod += 65536;\n                }\n            }\n            state.WheelPeriod = (state.WheelPeriod || 0) + accWheelPeriod - oldWheelPeriod;\n\n            const oldTorque = (state.Torque || 0) % 256;\n            if (accTorque !== oldTorque) {\n                if (oldTorque > accTorque) {\n                    accTorque += 65536;\n                }\n            }\n            state.Torque = (state.Torque || 0) + accTorque - oldTorque;\n\n            switch ((flagStateBF & 0x70) >> 4) {\n                case 1:\n                    state.State = \"OFF\";\n                    break;\n                case 2:\n                    state.State = \"READY\";\n                    resetState(state);\n                    break;\n                case 3:\n                    state.State = \"IN_USE\";\n                    break;\n                case 4:\n                    state.State = \"FINISHED\";\n                    break;\n                default:\n                    delete state.State;\n                    break;\n            }\n            if (flagStateBF & 0x80) {\n                // lap\n            }\n\n            break;\n        }\n        case 0x50: {\n            state.HwVersion = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 3);\n            state.ManId = data.readUInt16LE(Messages.BUFFER_INDEX_MSG_DATA + 4);\n            state.ModelNum = data.readUInt16LE(Messages.BUFFER_INDEX_MSG_DATA + 6);\n            break;\n        }\n        case 0x51: {\n            const swRevSup = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 2);\n            const swRevMain = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 3);\n            const serial = data.readInt32LE(Messages.BUFFER_INDEX_MSG_DATA + 4);\n\n            state.SwVersion = swRevMain;\n\n            if (swRevSup !== 0xff) {\n                state.SwVersion += swRevSup / 1000;\n            }\n\n            if (serial !== 0xffffffff) {\n                state.SerialNumber = serial;\n            }\n\n            break;\n        }\n        case 0x56: {\n            const idx = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 1);\n            const tot = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 2);\n            const chState = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 3);\n            const devId = data.readUInt16LE(Messages.BUFFER_INDEX_MSG_DATA + 4);\n            // eslint-disable-next-line @typescript-eslint/no-unused-vars\n            const trType = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 6);\n            const devType = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 7);\n\n            if (idx === 0) {\n                state.PairedDevices = [];\n            }\n\n            if (tot > 0) {\n                state.PairedDevices.push({\n                    id: devId,\n                    type: devType,\n                    paired: chState & 0x80 ? true : false,\n                });\n            }\n\n            break;\n        }\n        default:\n            return;\n    }\n    sensor.emit(\"fitnessData\", state);\n}\n","import { PairedDevice } from \"../../types/pairedDevice.js\";\n\n/**\n * Represents the state of a Fitness Equipment sensor.\n * This class holds the data fields associated with the state of a fitness equipment sensor,\n * including metrics such as heart rate, speed, distance, power, and more.\n */\nexport class FitnessEquipmentSensorState {\n    /**\n     * Creates an instance of the FitnessEquipmentSensorState.\n     *\n     * @param {number} deviceId - The unique identifier of the sensor device.\n     * @example\n     * const sensorState = new FitnessEquipmentSensorState(12345);\n     */\n    constructor(deviceId: number) {\n        this.DeviceId = deviceId;\n    }\n\n    /**\n     * The event count for page 0x19.\n     * @type {number | undefined}\n     */\n    _EventCount0x19?: number;\n\n    /**\n     * The event count for page 0x1A.\n     * @type {number | undefined}\n     */\n    _EventCount0x1A?: number;\n\n    /**\n     * The unique identifier of the sensor device.\n     * @type {number}\n     */\n    DeviceId: number;\n\n    /**\n     * The temperature measured by the sensor, in degrees Celsius.\n     * @type {number | undefined}\n     */\n    Temperature?: number;\n\n    /**\n     * The zero offset calibration value for the sensor.\n     * @type {number | undefined}\n     */\n    ZeroOffset?: number;\n\n    /**\n     * The spin-down time for the sensor, in seconds.\n     * @type {number | undefined}\n     */\n    SpinDownTime?: number;\n\n    /**\n     * The type of fitness equipment.\n     * Can be \"Treadmill\", \"Elliptical\", \"Reserved\", \"Rower\", \"Climber\", \"NordicSkier\", \"Trainer/StationaryBike\", or \"General\".\n     * @type {\"Treadmill\" | \"Elliptical\" | \"Reserved\" | \"Rower\" | \"Climber\" | \"NordicSkier\" | \"Trainer/StationaryBike\" | \"General\" | undefined}\n     */\n    EquipmentType?: \"Treadmill\" | \"Elliptical\" | \"Reserved\" | \"Rower\" | \"Climber\" | \"NordicSkier\" | \"Trainer/StationaryBike\" | \"General\";\n\n    /**\n     * The total elapsed time, in seconds.\n     * @type {number | undefined}\n     */\n    ElapsedTime?: number;\n\n    /**\n     * The total distance traveled, in meters.\n     * @type {number | undefined}\n     */\n    Distance?: number;\n\n    /**\n     * The real speed of the equipment, in meters per second.\n     * @type {number | undefined}\n     */\n    RealSpeed?: number;\n\n    /**\n     * The virtual speed of the equipment, in meters per second.\n     * @type {number | undefined}\n     */\n    VirtualSpeed?: number;\n\n    /**\n     * The current heart rate, in beats per minute (BPM).\n     * @type {number | undefined}\n     */\n    HeartRate?: number;\n\n    /**\n     * The source of the heart rate data.\n     * Can be \"HandContact\", \"EM\", or \"ANT+\".\n     * @type {\"HandContact\" | \"EM\" | \"ANT+\" | undefined}\n     */\n    HeartRateSource?: \"HandContact\" | \"EM\" | \"ANT+\";\n\n    /**\n     * The state of the equipment.\n     * Can be \"OFF\", \"READY\", \"IN_USE\", or \"FINISHED\".\n     * @type {\"OFF\" | \"READY\" | \"IN_USE\" | \"FINISHED\" | undefined}\n     */\n    State?: \"OFF\" | \"READY\" | \"IN_USE\" | \"FINISHED\";\n\n    /**\n     * The cycle length of the equipment, in meters.\n     * @type {number | undefined}\n     */\n    CycleLength?: number;\n\n    /**\n     * The incline of the equipment, in percentage.\n     * @type {number | undefined}\n     */\n    Incline?: number;\n\n    /**\n     * The resistance level of the equipment.\n     * @type {number | undefined}\n     */\n    Resistance?: number;\n\n    /**\n     * The metabolic equivalent (MET) value.\n     * @type {number | undefined}\n     */\n    METs?: number;\n\n    /**\n     * The caloric burn rate, in kilocalories per hour.\n     * @type {number | undefined}\n     */\n    CaloricBurnRate?: number;\n\n    /**\n     * The total calories burned.\n     * @type {number | undefined}\n     */\n    Calories?: number;\n\n    /**\n     * The distance ascended, in meters.\n     * @type {number | undefined}\n     */\n    AscendedDistance?: number;\n\n    /**\n     * The distance descended, in meters.\n     * @type {number | undefined}\n     */\n    DescendedDistance?: number;\n\n    /**\n     * The total number of strides taken.\n     * @type {number | undefined}\n     */\n    Strides?: number;\n\n    /**\n     * The total number of strokes taken.\n     * @type {number | undefined}\n     */\n    Strokes?: number;\n\n    /**\n     * The current cadence, in revolutions per minute (RPM).\n     * @type {number | undefined}\n     */\n    Cadence?: number;\n\n    /**\n     * The total accumulated power output, in watts.\n     * @type {number | undefined}\n     */\n    AccumulatedPower?: number;\n\n    /**\n     * The instantaneous power output, in watts.\n     * @type {number | undefined}\n     */\n    InstantaneousPower?: number;\n\n    /**\n     * The average power output, in watts.\n     * @type {number | undefined}\n     */\n    AveragePower?: number;\n\n    /**\n     * The trainer status, typically indicating the current mode or condition of the trainer.\n     * @type {number | undefined}\n     */\n    TrainerStatus?: number;\n\n    /**\n     * The target status of the equipment.\n     * Can be \"OnTarget\", \"LowSpeed\", or \"HighSpeed\".\n     * @type {\"OnTarget\" | \"LowSpeed\" | \"HighSpeed\" | undefined}\n     */\n    TargetStatus?: \"OnTarget\" | \"LowSpeed\" | \"HighSpeed\";\n\n    /**\n     * The total number of wheel ticks.\n     * @type {number | undefined}\n     */\n    WheelTicks?: number;\n\n    /**\n     * The wheel period, in seconds.\n     * @type {number | undefined}\n     */\n    WheelPeriod?: number;\n\n    /**\n     * The torque value, in newton-meters.\n     * @type {number | undefined}\n     */\n    Torque?: number;\n\n    /**\n     * The hardware version of the sensor.\n     * @type {number | undefined}\n     */\n    HwVersion?: number;\n\n    /**\n     * The manufacturer ID of the sensor.\n     * @type {number | undefined}\n     */\n    ManId?: number;\n\n    /**\n     * The model number of the sensor.\n     * @type {number | undefined}\n     */\n    ModelNum?: number;\n\n    /**\n     * The software version of the sensor.\n     * @type {number | undefined}\n     */\n    SwVersion?: number;\n\n    /**\n     * The serial number of the sensor.\n     * @type {number | undefined}\n     */\n    SerialNumber?: number;\n\n    /**\n     * The list of paired devices associated with the sensor.\n     * @type {PairedDevice[]}\n     */\n    PairedDevices: PairedDevice[] = [];\n}\n","import { FitnessEquipmentSensorState } from \"./fitnessEquipmentSensorState.js\";\n\n/**\n * Represents the state of a Fitness Equipment sensor during scanning.\n * Extends the FitnessEquipmentSensorState to include additional fields specific to scanning,\n * such as RSSI (Received Signal Strength Indicator) and signal threshold.\n */\nexport class FitnessEquipmentScanState extends FitnessEquipmentSensorState {\n    /**\n     * The received signal strength indicator (RSSI) of the sensor signal.\n     * Indicates the strength of the received signal from the fitness equipment sensor.\n     * @type {number | undefined}\n     */\n    Rssi: number | undefined;\n\n    /**\n     * The signal threshold value for the sensor.\n     * Represents the minimum signal strength required for a reliable connection.\n     * @type {number | undefined}\n     */\n    Threshold: number | undefined;\n}\n","/*\n * ANT+ profile: https://www.thisisant.com/developer/ant-plus/device-profiles/#521_tab\n * Spec sheet: https://www.thisisant.com/resources/bicycle-power/\n */\n\nimport { updateState } from \"./fitnessEquipmentUtils.js\";\nimport { FitnessEquipmentSensorState } from \"./fitnessEquipmentSensorState.js\";\nimport { AntPlusSensor } from \"../antPlusSensor.js\";\nimport { SendCallback } from \"../../types/sendCallback.js\";\nimport { Messages } from \"../../utils/messages.js\";\n\n/**\n * Represents a Fitness Equipment sensor.\n * This class extends the AntPlusSensor class to handle specific data related to fitness equipment.\n */\nexport class FitnessEquipmentSensor extends AntPlusSensor {\n    /**\n     * The device type code for Fitness Equipment sensors.\n     * @type {number}\n     * @readonly\n     */\n    static deviceType: number = 0x11;\n\n    /**\n     * The current state of the Fitness Equipment sensor.\n     * @private\n     * @type {FitnessEquipmentSensorState}\n     */\n    private state!: FitnessEquipmentSensorState;\n\n    /**\n     * Attaches the sensor to a specified ANT+ channel and initializes its state.\n     *\n     * @public\n     * @param {number} channel - The ANT+ channel number used for communication with the sensor.\n     * @param {number} deviceId - The unique identifier of the sensor device.\n     * @returns {void}\n     *\n     * @example\n     * const sensor = new FitnessEquipmentSensor();\n     * sensor.attach(1, 12345); // Attaches to channel 1 with device ID 12345\n     */\n    public attach(channel: number, deviceId: number): void {\n        super.attachSensor(channel, \"receive\", deviceId, FitnessEquipmentSensor.deviceType, 0, 255, 8192);\n        this.state = new FitnessEquipmentSensorState(deviceId);\n    }\n\n    /**\n     * Updates the state of the sensor based on incoming data.\n     *\n     * @protected\n     * @param {number} deviceId - The unique identifier of the sensor device.\n     * @param {Buffer} data - The raw data buffer received from the sensor.\n     * @returns {void}\n     */\n    protected updateState(deviceId: number, data: Buffer): void {\n        this.state.DeviceId = deviceId;\n        updateState(this, this.state, data);\n    }\n\n    /**\n     * Sends user configuration data to the sensor internally.\n     *\n     * @private\n     * @param {number} [userWeight] - The user's weight in kilograms.\n     * @param {number} [bikeWeight] - The weight of the bike in kilograms.\n     * @param {number} [wheelDiameter] - The diameter of the wheel in meters.\n     * @param {number} [gearRatio] - The gear ratio.\n     * @param {SendCallback} [cbk] - Optional callback function to handle the send response.\n     * @returns {void}\n     */\n    private setUserConfigurationInternal(userWeight?: number, bikeWeight?: number, wheelDiameter?: number, gearRatio?: number, cbk?: SendCallback): void {\n        const m = userWeight == null ? 0xffff : Math.max(0, Math.min(65534, Math.round(userWeight * 100)));\n        const df = wheelDiameter == null ? 0xff : Math.round(wheelDiameter * 10) % 10;\n        const mb = bikeWeight == null ? 0xfff : Math.max(0, Math.min(1000, Math.round(bikeWeight * 20)));\n        const d = wheelDiameter == null ? 0xff : Math.max(0, Math.min(254, Math.round(wheelDiameter)));\n        const gr = gearRatio == null ? 0x00 : Math.max(1, Math.min(255, Math.round(gearRatio / 0.03)));\n        const payload = [0x37, m & 0xff, (m >> 8) & 0xff, 0xff, (df & 0xf) | ((mb & 0xf) << 4), (mb >> 4) & 0xf, d & 0xff, gr & 0xff];\n        const msg = Messages.acknowledgedData(this.channel!, payload);\n        this.send(msg, cbk);\n    }\n\n    /**\n     * Sets the user configuration for the sensor.\n     *\n     * @public\n     * @param {number|SendCallback} [userWeightOrCallback] - The user's weight in kilograms or a callback function.\n     * @param {number} [bikeWeight] - The weight of the bike in kilograms.\n     * @param {number} [wheelDiameter] - The diameter of the wheel in meters.\n     * @param {number} [gearRatio] - The gear ratio.\n     * @param {SendCallback} [cbk] - Optional callback function to handle the send response.\n     * @returns {void}\n     *\n     * @example\n     * sensor.setUserConfiguration(70, 10, 0.7, 3.5, callbackFunction);\n     */\n    public setUserConfiguration(userWeightOrCallback?: number | SendCallback, bikeWeight?: number, wheelDiameter?: number, gearRatio?: number, cbk?: SendCallback): void {\n        if (typeof userWeightOrCallback === \"function\") {\n            this.setUserConfigurationInternal(undefined, undefined, undefined, undefined, userWeightOrCallback);\n        } else if (typeof bikeWeight === \"function\") {\n            this.setUserConfigurationInternal(userWeightOrCallback, undefined, undefined, undefined, bikeWeight);\n        } else if (typeof wheelDiameter === \"function\") {\n            this.setUserConfigurationInternal(userWeightOrCallback, bikeWeight, undefined, undefined, wheelDiameter);\n        } else if (typeof gearRatio === \"function\") {\n            this.setUserConfigurationInternal(userWeightOrCallback, bikeWeight, wheelDiameter, undefined, gearRatio);\n        } else {\n            this.setUserConfigurationInternal(userWeightOrCallback, bikeWeight, wheelDiameter, gearRatio, cbk);\n        }\n    }\n\n    /**\n     * Sets the basic resistance level on the fitness equipment.\n     *\n     * @public\n     * @param {number} resistance - The resistance level to set (0 to 100).\n     * @param {SendCallback} [cbk] - Optional callback function to handle the send response.\n     * @returns {void}\n     *\n     * @example\n     * sensor.setBasicResistance(50, callbackFunction);\n     */\n    public setBasicResistance(resistance: number, cbk?: SendCallback): void {\n        const res = Math.max(0, Math.min(200, Math.round(resistance * 2)));\n        const payload = [0x30, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, res & 0xff];\n        const msg = Messages.acknowledgedData(this.channel!, payload);\n        this.send(msg, cbk);\n    }\n\n    /**\n     * Sets the target power level on the fitness equipment.\n     *\n     * @public\n     * @param {number} power - The target power level in watts.\n     * @param {SendCallback} [cbk] - Optional callback function to handle the send response.\n     * @returns {void}\n     *\n     * @example\n     * sensor.setTargetPower(250, callbackFunction);\n     */\n    public setTargetPower(power: number, cbk?: SendCallback): void {\n        const p = Math.max(0, Math.min(4000, Math.round(power * 4)));\n        const payload = [0x31, 0xff, 0xff, 0xff, 0xff, 0xff, p & 0xff, (p >> 8) & 0xff];\n        const msg = Messages.acknowledgedData(this.channel!, payload);\n        this.send(msg, cbk);\n    }\n\n    /**\n     * Sends wind resistance data to the sensor internally.\n     *\n     * @private\n     * @param {number} [windCoeff] - The wind resistance coefficient.\n     * @param {number} [windSpeed] - The wind speed in km/h.\n     * @param {number} [draftFactor] - The drafting factor (0 to 1).\n     * @param {SendCallback} [cbk] - Optional callback function to handle the send response.\n     * @returns {void}\n     */\n    private setWindResistanceInternal(windCoeff?: number, windSpeed?: number, draftFactor?: number, cbk?: SendCallback): void {\n        const wc = windCoeff == null ? 0xff : Math.max(0, Math.min(186, Math.round(windCoeff * 100)));\n        const ws = windSpeed == null ? 0xff : Math.max(0, Math.min(254, Math.round(windSpeed + 127)));\n        const df = draftFactor == null ? 0xff : Math.max(0, Math.min(100, Math.round(draftFactor * 100)));\n        const payload = [0x32, 0xff, 0xff, 0xff, 0xff, wc & 0xff, ws & 0xff, df & 0xff];\n        const msg = Messages.acknowledgedData(this.channel!, payload);\n        this.send(msg, cbk);\n    }\n\n    /**\n     * Sets the wind resistance on the fitness equipment.\n     *\n     * @public\n     * @param {number|SendCallback} [windCoeffOrCallback] - The wind resistance coefficient or a callback function.\n     * @param {number} [windSpeed] - The wind speed in km/h.\n     * @param {number} [draftFactor] - The drafting factor (0 to 1).\n     * @param {SendCallback} [cbk] - Optional callback function to handle the send response.\n     * @returns {void}\n     *\n     * @example\n     * sensor.setWindResistance(0.5, 20, 0.1, callbackFunction);\n     */\n    public setWindResistance(windCoeffOrCallback?: number | SendCallback, windSpeed?: number, draftFactor?: number, cbk?: SendCallback): void {\n        if (typeof windCoeffOrCallback === \"function\") {\n            this.setWindResistanceInternal(undefined, undefined, undefined, windCoeffOrCallback);\n        } else if (typeof windSpeed === \"function\") {\n            this.setWindResistanceInternal(windCoeffOrCallback, undefined, undefined, windSpeed);\n        } else if (typeof draftFactor === \"function\") {\n            this.setWindResistanceInternal(windCoeffOrCallback, windSpeed, undefined, draftFactor);\n        } else {\n            this.setWindResistanceInternal(windCoeffOrCallback, windSpeed, draftFactor, cbk);\n        }\n    }\n\n    /**\n     * Sends track resistance data to the sensor internally.\n     *\n     * @private\n     * @param {number} [slope] - The track slope percentage.\n     * @param {number} [rollingResistanceCoeff] - The rolling resistance coefficient.\n     * @param {SendCallback} [cbk] - Optional callback function to handle the send response.\n     * @returns {void}\n     */\n    private setTrackResistanceInternal(slope?: number, rollingResistanceCoeff?: number, cbk?: SendCallback): void {\n        const s = slope == null ? 0xffff : Math.max(0, Math.min(40000, Math.round((slope + 200) * 100)));\n        const rr = rollingResistanceCoeff == null ? 0xff : Math.max(0, Math.min(254, Math.round(rollingResistanceCoeff * 20000)));\n        const payload = [0x33, 0xff, 0xff, 0xff, 0xff, s & 0xff, (s >> 8) & 0xff, rr & 0xff];\n        const msg = Messages.acknowledgedData(this.channel!, payload);\n        this.send(msg, cbk);\n    }\n\n    /**\n     * Sets the track resistance on the fitness equipment.\n     *\n     * @public\n     * @param {number|SendCallback} [slopeOrCallback] - The track slope percentage or a callback function.\n     * @param {number} [rollingResistanceCoeff] - The rolling resistance coefficient.\n     * @param {SendCallback} [cbk] - Optional callback function to handle the send response.\n     * @returns {void}\n     *\n     * @example\n     * sensor.setTrackResistance(5, 0.005, callbackFunction);\n     */\n    public setTrackResistance(slopeOrCallback?: number | SendCallback, rollingResistanceCoeff?: number, cbk?: SendCallback): void {\n        if (typeof slopeOrCallback === \"function\") {\n            this.setTrackResistanceInternal(undefined, undefined, slopeOrCallback);\n        } else if (typeof rollingResistanceCoeff === \"function\") {\n            this.setTrackResistanceInternal(slopeOrCallback, undefined, rollingResistanceCoeff);\n        } else {\n            this.setTrackResistanceInternal(slopeOrCallback, rollingResistanceCoeff, cbk);\n        }\n    }\n}\n","import { updateState } from \"./fitnessEquipmentUtils.js\";\nimport { FitnessEquipmentScanState } from \"./fitnessEquipmentScanState.js\";\nimport { FitnessEquipmentSensor } from \"./fitnessEquipmentSensor.js\";\nimport { AntPlusScanner } from \"../antPlusScanner.js\";\n\n/**\n * Represents a scanner for Fitness Equipment sensors.\n * Extends the AntPlusScanner class to handle scanning and state updates for multiple fitness equipment sensors.\n */\nexport class FitnessEquipmentScanner extends AntPlusScanner {\n    /**\n     * Returns the device type code for Fitness Equipment sensors.\n     *\n     * @protected\n     * @returns {number} The device type code for Fitness Equipment sensors.\n     */\n    protected deviceType(): number {\n        return FitnessEquipmentSensor.deviceType;\n    }\n\n    /**\n     * A dictionary to store the states of detected Fitness Equipment sensors by their device ID.\n     * @private\n     * @type {{ [id: number]: FitnessEquipmentScanState }}\n     */\n    private states: { [id: number]: FitnessEquipmentScanState } = {};\n\n    /**\n     * Creates a new state entry for a sensor if it does not already exist.\n     *\n     * @protected\n     * @param {number} deviceId - The unique identifier of the sensor device.\n     * @returns {void}\n     * @example\n     * scanner.createStateIfNew(12345); // Creates a new state for device ID 12345 if it does not exist.\n     */\n    protected createStateIfNew(deviceId: number): void {\n        if (!this.states[deviceId]) {\n            this.states[deviceId] = new FitnessEquipmentScanState(deviceId);\n        }\n    }\n\n    /**\n     * Updates the RSSI (Received Signal Strength Indicator) and signal threshold for a specific sensor.\n     *\n     * @protected\n     * @param {number} deviceId - The unique identifier of the sensor device.\n     * @param {number} rssi - The received signal strength indicator of the device.\n     * @param {number} threshold - The signal threshold value for the device.\n     * @returns {void}\n     * @example\n     * scanner.updateRssiAndThreshold(12345, -70, 30); // Updates the RSSI and threshold for device ID 12345.\n     */\n    protected updateRssiAndThreshold(deviceId: number, rssi: number, threshold: number): void {\n        this.states[deviceId].Rssi = rssi;\n        this.states[deviceId].Threshold = threshold;\n    }\n\n    /**\n     * Updates the state of a sensor based on incoming data.\n     *\n     * @protected\n     * @param {number} deviceId - The unique identifier of the sensor device.\n     * @param {Buffer} data - The raw data buffer received from the sensor.\n     * @returns {void}\n     * @example\n     * const dataBuffer = getDataFromSensor(); // Assume this function gets data from a sensor\n     * scanner.updateState(12345, dataBuffer); // Updates the state for device ID 12345.\n     */\n    protected updateState(deviceId: number, data: Buffer): void {\n        updateState(this, this.states[deviceId], data);\n    }\n}\n","import { Messages } from \"../../utils/messages.js\";\r\nimport { MuscleOxygenSensorState } from \"./muscleOxygenSensorState.js\";\r\nimport { MuscleOxygenScanState } from \"./muscleOxygenScanState.js\";\r\nimport { MuscleOxygenSensor } from \"./muscleOxygenSensor.js\";\r\nimport { MuscleOxygenScanner } from \"./muscleOxygenScanner.js\";\r\n\r\n/**\r\n * Updates the state of a Muscle Oxygen sensor or scanner based on the incoming data.\r\n * Decodes various pages of data to update the state, including event counts, sensor capabilities,\r\n * measurement intervals, total hemoglobin concentration, and battery status.\r\n *\r\n * @param {MuscleOxygenSensor | MuscleOxygenScanner} sensor - The sensor or scanner instance emitting the data.\r\n * @param {MuscleOxygenSensorState | MuscleOxygenScanState} state - The current state of the sensor or scanner.\r\n * @param {Buffer} data - The raw data buffer received from the sensor.\r\n * @returns {void}\r\n *\r\n * @example\r\n * const sensor = new MuscleOxygenSensor();\r\n * const state = new MuscleOxygenSensorState(12345);\r\n * const dataBuffer = getDataFromSensor(); // Assume this function gets data from a sensor\r\n * updateState(sensor, state, dataBuffer);\r\n */\r\nexport function updateState(sensor: MuscleOxygenSensor | MuscleOxygenScanner, state: MuscleOxygenSensorState | MuscleOxygenScanState, data: Buffer) {\r\n    const oldEventCount = state._EventCount || 0;\r\n    const page = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA);\r\n\r\n    switch (page) {\r\n        case 0x01: {\r\n            let eventCount = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 1);\r\n            const notifications = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 2);\r\n            const capabilities = data.readUInt16LE(Messages.BUFFER_INDEX_MSG_DATA + 3);\r\n            const total = data.readUInt16LE(Messages.BUFFER_INDEX_MSG_DATA + 4) & 0xfff;\r\n            const previous = (data.readUInt16LE(Messages.BUFFER_INDEX_MSG_DATA + 5) >> 4) & 0x3ff;\r\n            const current = (data.readUInt16LE(Messages.BUFFER_INDEX_MSG_DATA + 6) >> 6) & 0x3ff;\r\n\r\n            if (eventCount !== oldEventCount) {\r\n                state._EventCount = eventCount;\r\n                if (oldEventCount > eventCount) {\r\n                    // Hit rollover value\r\n                    eventCount += 255;\r\n                }\r\n            }\r\n\r\n            state.UTCTimeRequired = (notifications & 0x01) === 0x01;\r\n            state.SupportANTFS = (capabilities & 0x01) === 0x01;\r\n\r\n            switch ((capabilities >> 1) & 0x7) {\r\n                case 1:\r\n                    state.MeasurementInterval = 0.25;\r\n                    break;\r\n                case 2:\r\n                    state.MeasurementInterval = 0.5;\r\n                    break;\r\n                case 3:\r\n                    state.MeasurementInterval = 1;\r\n                    break;\r\n                case 4:\r\n                    state.MeasurementInterval = 2;\r\n                    break;\r\n                default:\r\n                    delete state.MeasurementInterval;\r\n            }\r\n\r\n            switch (total) {\r\n                case 0xffe:\r\n                    state.TotalHemoglobinConcentration = \"AmbientLightTooHigh\";\r\n                    break;\r\n                case 0xfff:\r\n                    state.TotalHemoglobinConcentration = \"Invalid\";\r\n                    break;\r\n                default:\r\n                    state.TotalHemoglobinConcentration = total;\r\n            }\r\n\r\n            switch (previous) {\r\n                case 0x3fe:\r\n                    state.PreviousSaturatedHemoglobinPercentage = \"AmbientLightTooHigh\";\r\n                    break;\r\n                case 0x3ff:\r\n                    state.PreviousSaturatedHemoglobinPercentage = \"Invalid\";\r\n                    break;\r\n                default:\r\n                    state.PreviousSaturatedHemoglobinPercentage = previous;\r\n            }\r\n\r\n            switch (current) {\r\n                case 0x3fe:\r\n                    state.CurrentSaturatedHemoglobinPercentage = \"AmbientLightTooHigh\";\r\n                    break;\r\n                case 0x3ff:\r\n                    state.CurrentSaturatedHemoglobinPercentage = \"Invalid\";\r\n                    break;\r\n                default:\r\n                    state.CurrentSaturatedHemoglobinPercentage = current;\r\n            }\r\n\r\n            break;\r\n        }\r\n        case 0x50: {\r\n            state.HwVersion = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 3);\r\n            state.ManId = data.readUInt16LE(Messages.BUFFER_INDEX_MSG_DATA + 4);\r\n            state.ModelNum = data.readUInt16LE(Messages.BUFFER_INDEX_MSG_DATA + 6);\r\n            break;\r\n        }\r\n        case 0x51: {\r\n            const swRevSup = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 2);\r\n            const swRevMain = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 3);\r\n            const serial = data.readInt32LE(Messages.BUFFER_INDEX_MSG_DATA + 4);\r\n\r\n            state.SwVersion = swRevMain;\r\n\r\n            if (swRevSup !== 0xff) {\r\n                state.SwVersion += swRevSup / 1000;\r\n            }\r\n\r\n            if (serial !== 0xffffffff) {\r\n                state.SerialNumber = serial;\r\n            }\r\n\r\n            break;\r\n        }\r\n        case 0x52: {\r\n            // eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n            const batteryId = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 2);\r\n            const operatingTime = data.readUInt32LE(Messages.BUFFER_INDEX_MSG_DATA + 3) & 0xffffff;\r\n            const batteryFrac = data.readInt32LE(Messages.BUFFER_INDEX_MSG_DATA + 6);\r\n            const batteryStatus = data.readInt32LE(Messages.BUFFER_INDEX_MSG_DATA + 7);\r\n\r\n            state.OperatingTime = operatingTime * ((batteryStatus & 0x80) === 0x80 ? 2 : 16);\r\n            state.BatteryVoltage = (batteryStatus & 0x0f) + batteryFrac / 256;\r\n            const batteryFlags = (batteryStatus & 0x70) >>> 4;\r\n            state.BatteryStatusBit = batteryFlags;\r\n            switch (batteryFlags) {\r\n                case 1:\r\n                    state.BatteryStatus = \"New\";\r\n                    break;\r\n                case 2:\r\n                    state.BatteryStatus = \"Good\";\r\n                    break;\r\n                case 3:\r\n                    state.BatteryStatus = \"Ok\";\r\n                    break;\r\n                case 4:\r\n                    state.BatteryStatus = \"Low\";\r\n                    break;\r\n                case 5:\r\n                    state.BatteryStatus = \"Critical\";\r\n                    break;\r\n                default:\r\n                    state.BatteryVoltage = undefined;\r\n                    state.BatteryStatus = \"Invalid\";\r\n                    break;\r\n            }\r\n            break;\r\n        }\r\n        default:\r\n            return;\r\n    }\r\n    if (page !== 0x01 || state._EventCount !== oldEventCount) {\r\n        sensor.emit(\"oxygenData\", state);\r\n    }\r\n}\r\n","/**\r\n * Represents the state of a Muscle Oxygen sensor.\r\n * This class holds the data fields associated with the state of a Muscle Oxygen sensor, including\r\n * event count, device details, measurement data, and battery status.\r\n */\r\nexport class MuscleOxygenSensorState {\r\n    /**\r\n     * Creates an instance of the MuscleOxygenSensorState.\r\n     *\r\n     * @param {number} deviceId - The unique identifier of the sensor device.\r\n     * @example\r\n     * const sensorState = new MuscleOxygenSensorState(12345);\r\n     */\r\n    constructor(deviceId: number) {\r\n        this.DeviceId = deviceId;\r\n    }\r\n\r\n    /**\r\n     * The count of events detected by the sensor.\r\n     * @type {number | undefined}\r\n     */\r\n    _EventCount?: number;\r\n\r\n    /**\r\n     * The unique identifier of the sensor device.\r\n     * @type {number}\r\n     */\r\n    DeviceId: number;\r\n\r\n    /**\r\n     * Indicates whether UTC time is required by the sensor.\r\n     * @type {boolean | undefined}\r\n     */\r\n    UTCTimeRequired?: boolean;\r\n\r\n    /**\r\n     * Indicates whether ANT-FS is supported by the sensor.\r\n     * @type {boolean | undefined}\r\n     */\r\n    SupportANTFS?: boolean;\r\n\r\n    /**\r\n     * The measurement interval in seconds.\r\n     * Possible values: 0.25, 0.5, 1, or 2 seconds.\r\n     * @type {0.25 | 0.5 | 1 | 2 | undefined}\r\n     */\r\n    MeasurementInterval?: 0.25 | 0.5 | 1 | 2;\r\n\r\n    /**\r\n     * The total hemoglobin concentration.\r\n     * Can be a numeric value, \"AmbientLightTooHigh\", or \"Invalid\".\r\n     * @type {number | \"AmbientLightTooHigh\" | \"Invalid\" | undefined}\r\n     */\r\n    TotalHemoglobinConcentration?: number | \"AmbientLightTooHigh\" | \"Invalid\";\r\n\r\n    /**\r\n     * The percentage of saturated hemoglobin from the previous measurement.\r\n     * Can be a numeric value, \"AmbientLightTooHigh\", or \"Invalid\".\r\n     * @type {number | \"AmbientLightTooHigh\" | \"Invalid\" | undefined}\r\n     */\r\n    PreviousSaturatedHemoglobinPercentage?: number | \"AmbientLightTooHigh\" | \"Invalid\";\r\n\r\n    /**\r\n     * The percentage of saturated hemoglobin from the current measurement.\r\n     * Can be a numeric value, \"AmbientLightTooHigh\", or \"Invalid\".\r\n     * @type {number | \"AmbientLightTooHigh\" | \"Invalid\" | undefined}\r\n     */\r\n    CurrentSaturatedHemoglobinPercentage?: number | \"AmbientLightTooHigh\" | \"Invalid\";\r\n\r\n    /**\r\n     * The hardware version of the sensor.\r\n     * @type {number | undefined}\r\n     */\r\n    HwVersion?: number;\r\n\r\n    /**\r\n     * The manufacturer ID of the sensor.\r\n     * @type {number | undefined}\r\n     */\r\n    ManId?: number;\r\n\r\n    /**\r\n     * The model number of the sensor.\r\n     * @type {number | undefined}\r\n     */\r\n    ModelNum?: number;\r\n\r\n    /**\r\n     * The software version of the sensor.\r\n     * @type {number | undefined}\r\n     */\r\n    SwVersion?: number;\r\n\r\n    /**\r\n     * The serial number of the sensor.\r\n     * @type {number | undefined}\r\n     */\r\n    SerialNumber?: number;\r\n\r\n    /**\r\n     * The cumulative operating time of the sensor in seconds.\r\n     * @type {number | undefined}\r\n     */\r\n    OperatingTime?: number;\r\n\r\n    /**\r\n     * The battery voltage of the sensor.\r\n     * @type {number | undefined}\r\n     */\r\n    BatteryVoltage?: number;\r\n\r\n    /**\r\n     * The battery status of the sensor.\r\n     * Can be \"New\", \"Good\", \"Ok\", \"Low\", \"Critical\", or \"Invalid\".\r\n     * @type {\"New\" | \"Good\" | \"Ok\" | \"Low\" | \"Critical\" | \"Invalid\" | undefined}\r\n     */\r\n    BatteryStatus?: \"New\" | \"Good\" | \"Ok\" | \"Low\" | \"Critical\" | \"Invalid\";\r\n\r\n    /**\r\n     * The battery status bit of the sensor.\r\n     */\r\n    BatteryStatusBit?: number;\r\n}\r\n","import { MuscleOxygenSensorState } from \"./muscleOxygenSensorState.js\";\n\n/**\n * Represents the state of a Muscle Oxygen sensor during scanning.\n * Extends the MuscleOxygenSensorState to include additional fields specific to scanning,\n * such as RSSI (Received Signal Strength Indicator) and signal threshold.\n */\nexport class MuscleOxygenScanState extends MuscleOxygenSensorState {\n    /**\n     * The received signal strength indicator (RSSI) of the sensor signal.\n     * @type {number | undefined}\n     */\n    Rssi: number | undefined;\n\n    /**\n     * The signal threshold value for the sensor.\n     * @type {number | undefined}\n     */\n    Threshold: number | undefined;\n}\n","/*\n * ANT+ profile: https://www.thisisant.com/developer/ant-plus/device-profiles/#521_tab\n * Spec sheet: https://www.thisisant.com/resources/bicycle-power/\n */\n\nimport { updateState } from \"./muscleOxygenUtils.js\";\nimport { MuscleOxygenSensorState } from \"./muscleOxygenSensorState.js\";\nimport { AntPlusSensor } from \"../antPlusSensor.js\";\nimport { SendCallback } from \"../../types/sendCallback.js\";\nimport { Messages } from \"../../utils/messages.js\";\n\n/**\n * Represents a Muscle Oxygen sensor.\n * This class extends the AntPlusSensor class to handle specific data related to muscle oxygen measurements.\n */\nexport class MuscleOxygenSensor extends AntPlusSensor {\n    /**\n     * The device type code for Muscle Oxygen sensors.\n     * @type {number}\n     * @readonly\n     */\n    static deviceType: number = 0x1f;\n\n    /**\n     * The current state of the Muscle Oxygen sensor.\n     * @private\n     * @type {MuscleOxygenSensorState}\n     */\n    private state!: MuscleOxygenSensorState;\n\n    /**\n     * Attaches the sensor to a specified ANT+ channel and initializes its state.\n     *\n     * @public\n     * @param {number} channel - The ANT+ channel number used for communication with the sensor.\n     * @param {number} deviceId - The unique identifier of the sensor device.\n     * @returns {void}\n     *\n     * @example\n     * const sensor = new MuscleOxygenSensor();\n     * sensor.attach(1, 12345); // Attaches to channel 1 with device ID 12345\n     */\n    public attach(channel: number, deviceId: number) {\n        super.attachSensor(channel, \"receive\", deviceId, MuscleOxygenSensor.deviceType, 0, 255, 8192);\n        this.state = new MuscleOxygenSensorState(deviceId);\n    }\n\n    /**\n     * Updates the state of the sensor based on incoming data.\n     *\n     * @protected\n     * @param {number} deviceId - The unique identifier of the sensor device.\n     * @param {Buffer} data - The raw data buffer received from the sensor.\n     * @returns {void}\n     *\n     * @example\n     * const dataBuffer = getDataFromSensor(); // assume this function gets data from a sensor\n     * sensor.updateState(12345, dataBuffer);\n     */\n    protected updateState(deviceId: number, data: Buffer) {\n        this.state.DeviceId = deviceId;\n        updateState(this, this.state, data);\n    }\n\n    /**\n     * Sends a time-based command to the sensor.\n     *\n     * @private\n     * @param {number} cmd - The command code to be sent.\n     * @param {SendCallback} [cbk] - Optional callback function to handle the send response.\n     * @returns {void}\n     *\n     * @example\n     * sensor._sendTimeCmd(0x00, callbackFunction);\n     */\n    private _sendTimeCmd(cmd: number, cbk?: SendCallback) {\n        const now = new Date();\n        const utc = Math.round((now.getTime() - Date.UTC(1989, 11, 31, 0, 0, 0, 0)) / 1000);\n        const offset = -Math.round(now.getTimezoneOffset() / 15);\n        const payload = [0x10, cmd & 0xff, 0xff, offset & 0xff, (utc >> 0) & 0xff, (utc >> 8) & 0xff, (utc >> 16) & 0xff, (utc >> 24) & 0xff];\n        const msg = Messages.acknowledgedData(this.channel!, payload);\n        this.send(msg, cbk);\n    }\n\n    /**\n     * Sets the UTC time on the sensor.\n     *\n     * @public\n     * @param {SendCallback} [cbk] - Optional callback function to handle the send response.\n     * @returns {void}\n     *\n     * @example\n     * sensor.setUTCTime(callbackFunction);\n     */\n    public setUTCTime(cbk?: SendCallback) {\n        this._sendTimeCmd(0x00, cbk);\n    }\n\n    /**\n     * Starts a new session on the sensor.\n     *\n     * @public\n     * @param {SendCallback} [cbk] - Optional callback function to handle the send response.\n     * @returns {void}\n     *\n     * @example\n     * sensor.startSession(callbackFunction);\n     */\n    public startSession(cbk?: SendCallback) {\n        this._sendTimeCmd(0x01, cbk);\n    }\n\n    /**\n     * Stops the current session on the sensor.\n     *\n     * @public\n     * @param {SendCallback} [cbk] - Optional callback function to handle the send response.\n     * @returns {void}\n     *\n     * @example\n     * sensor.stopSession(callbackFunction);\n     */\n    public stopSession(cbk?: SendCallback) {\n        this._sendTimeCmd(0x02, cbk);\n    }\n\n    /**\n     * Sets a lap marker on the sensor.\n     *\n     * @public\n     * @param {SendCallback} [cbk] - Optional callback function to handle the send response.\n     * @returns {void}\n     *\n     * @example\n     * sensor.setLap(callbackFunction);\n     */\n    public setLap(cbk?: SendCallback) {\n        this._sendTimeCmd(0x03, cbk);\n    }\n}\n","import { updateState } from \"./muscleOxygenUtils.js\";\nimport { MuscleOxygenScanState } from \"./muscleOxygenScanState.js\";\nimport { MuscleOxygenSensor } from \"./muscleOxygenSensor.js\";\nimport { AntPlusScanner } from \"../antPlusScanner.js\";\n\n/**\n * Represents a scanner for Muscle Oxygen sensors.\n * Extends the AntPlusScanner class to handle scanning and state updates for multiple Muscle Oxygen sensors.\n */\nexport class MuscleOxygenScanner extends AntPlusScanner {\n    /**\n     * Returns the device type code for Muscle Oxygen sensors.\n     *\n     * @protected\n     * @returns {number} The device type code for Muscle Oxygen sensors.\n     */\n    protected deviceType(): number {\n        return MuscleOxygenSensor.deviceType;\n    }\n\n    /**\n     * A dictionary to store the states of detected Muscle Oxygen sensors by their device ID.\n     * @private\n     * @type {{ [id: number]: MuscleOxygenScanState }}\n     */\n    private states: { [id: number]: MuscleOxygenScanState } = {};\n\n    /**\n     * Creates a new state entry for a sensor if it does not already exist.\n     *\n     * @protected\n     * @param {number} deviceId - The unique identifier of the sensor device.\n     * @returns {void}\n     *\n     * @example\n     * scanner.createStateIfNew(12345); // Creates a new state for device ID 12345 if it does not exist.\n     */\n    protected createStateIfNew(deviceId: number): void {\n        if (!this.states[deviceId]) {\n            this.states[deviceId] = new MuscleOxygenScanState(deviceId);\n        }\n    }\n\n    /**\n     * Updates the RSSI (Received Signal Strength Indicator) and signal threshold for a specific sensor.\n     *\n     * @protected\n     * @param {number} deviceId - The unique identifier of the sensor device.\n     * @param {number} rssi - The received signal strength indicator of the device.\n     * @param {number} threshold - The signal threshold value for the device.\n     * @returns {void}\n     *\n     * @example\n     * scanner.updateRssiAndThreshold(12345, -70, 30); // Updates the RSSI and threshold for device ID 12345.\n     */\n    protected updateRssiAndThreshold(deviceId: number, rssi: number, threshold: number): void {\n        this.states[deviceId].Rssi = rssi;\n        this.states[deviceId].Threshold = threshold;\n    }\n\n    /**\n     * Updates the state of a sensor based on incoming data.\n     *\n     * @protected\n     * @param {number} deviceId - The unique identifier of the sensor device.\n     * @param {Buffer} data - The raw data buffer received from the sensor.\n     * @returns {void}\n     *\n     * @example\n     * const dataBuffer = getDataFromSensor(); // Assume this function gets data from a sensor\n     * scanner.updateState(12345, dataBuffer); // Updates the state for device ID 12345.\n     */\n    protected updateState(deviceId: number, data: Buffer): void {\n        updateState(this, this.states[deviceId], data);\n    }\n}\n","import { EnvironmentScanner } from \"./environmentScanner.js\";\nimport { EnvironmentScanState } from \"./environmentScanState.js\";\nimport { EnvironmentSensor } from \"./environmentSensor.js\";\nimport { EnvironmentSensorState } from \"./environmentSensorState.js\";\nimport { Messages } from \"../../utils/messages.js\";\n\n/**\n * Updates the state of an Environment sensor or scanner based on incoming data.\n * Decodes the data buffer and updates the sensor state accordingly.\n *\n * @param {EnvironmentSensor | EnvironmentScanner} sensor - The sensor or scanner instance emitting the data.\n * @param {EnvironmentSensorState | EnvironmentScanState} state - The current state of the sensor or scanner.\n * @param {Buffer} data - The raw data buffer received from the sensor.\n * @returns {void}\n *\n * @example\n * const sensor = new EnvironmentSensor();\n * const state = new EnvironmentSensorState(12345);\n * const dataBuffer = getDataFromSensor(); // Assume this function gets data from a sensor\n * updateState(sensor, state, dataBuffer); // Updates the state based on the received data.\n */\nexport function updateState(sensor: EnvironmentSensor | EnvironmentScanner, state: EnvironmentSensorState | EnvironmentScanState, data: Buffer): void {\n    const page = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA);\n    if (page === 1) {\n        state.EventCount = data.readUInt8(Messages.BUFFER_INDEX_MSG_DATA + 2);\n        state.Temperature = data.readInt16LE(Messages.BUFFER_INDEX_MSG_DATA + 6) / 100;\n    }\n    sensor.emit(\"envdata\", state);\n    sensor.emit(\"envData\", state);\n}\n","/**\n * Represents the state of an Environment Sensor.\n * This class holds the data fields associated with the state of an environment sensor,\n * such as the event count and temperature.\n */\nexport class EnvironmentSensorState {\n    /**\n     * Creates an instance of the EnvironmentSensorState.\n     *\n     * @param {number} deviceId - The unique identifier of the sensor device.\n     *\n     * @example\n     * const sensorState = new EnvironmentSensorState(12345);\n     */\n    constructor(deviceId: number) {\n        this.DeviceId = deviceId;\n    }\n\n    /**\n     * The unique identifier of the sensor device.\n     * @type {number}\n     */\n    DeviceId: number;\n\n    /**\n     * The event count recorded by the sensor.\n     * @type {number | undefined}\n     */\n    EventCount: number | undefined;\n\n    /**\n     * The temperature measured by the sensor, in degrees Celsius.\n     * @type {number | undefined}\n     */\n    Temperature: number | undefined;\n}\n","import { EnvironmentSensorState } from \"./environmentSensorState.js\";\n\n/**\n * Represents the state of an Environment Sensor during scanning.\n * Extends the EnvironmentSensorState to include additional fields specific to scanning,\n * such as RSSI (Received Signal Strength Indicator) and signal threshold.\n */\nexport class EnvironmentScanState extends EnvironmentSensorState {\n    /**\n     * The received signal strength indicator (RSSI) of the sensor signal.\n     * Indicates the strength of the received signal from the environment sensor.\n     * @type {number | undefined}\n     */\n    Rssi: number | undefined;\n\n    /**\n     * The signal threshold value for the sensor.\n     * Represents the minimum signal strength required for a reliable connection.\n     * @type {number | undefined}\n     */\n    Threshold: number | undefined;\n}\n","/*\n * ANT+ profile: https://www.thisisant.com/developer/ant-plus/device-profiles/#524_tab\n * Spec sheet: https://www.thisisant.com/resources/environment/\n */\n\nimport { updateState } from \"./environmentUtils.js\";\nimport { EnvironmentSensorState } from \"./environmentSensorState.js\";\nimport { AntPlusSensor } from \"../antPlusSensor.js\";\n\n/**\n * Represents an Environment sensor.\n * This class extends the AntPlusSensor class to handle specific data related to environmental monitoring.\n */\nexport class EnvironmentSensor extends AntPlusSensor {\n    /**\n     * The device type code for Environment sensors.\n     * @type {number}\n     * @readonly\n     */\n    static deviceType: number = 25;\n\n    /**\n     * Attaches the sensor to a specified ANT+ channel and initializes its state.\n     *\n     * @public\n     * @param {number} channel - The ANT+ channel number used for communication with the sensor.\n     * @param {number} deviceId - The unique identifier of the sensor device.\n     * @returns {void}\n     *\n     * @example\n     * const sensor = new EnvironmentSensor();\n     * sensor.attach(1, 12345); // Attaches to channel 1 with device ID 12345\n     */\n    public attach(channel: number, deviceId: number): void {\n        super.attachSensor(channel, \"receive\", deviceId, EnvironmentSensor.deviceType, 0, 255, 8192);\n        this.state = new EnvironmentSensorState(deviceId);\n    }\n\n    /**\n     * The current state of the Environment sensor.\n     * @private\n     * @type {EnvironmentSensorState}\n     */\n    private state!: EnvironmentSensorState;\n\n    /**\n     * Updates the state of the sensor based on incoming data.\n     *\n     * @protected\n     * @param {number} deviceId - The unique identifier of the sensor device.\n     * @param {Buffer} data - The raw data buffer received from the sensor.\n     * @returns {void}\n     *\n     * @example\n     * const dataBuffer = getDataFromSensor(); // assume this function gets data from a sensor\n     * sensor.updateState(12345, dataBuffer);\n     */\n    protected updateState(deviceId: number, data: Buffer): void {\n        this.state.DeviceId = deviceId;\n        updateState(this, this.state, data);\n    }\n}\n","import { updateState } from \"./environmentUtils.js\";\nimport { EnvironmentScanState } from \"./environmentScanState.js\";\nimport { EnvironmentSensor } from \"./environmentSensor.js\";\nimport { AntPlusScanner } from \"../antPlusScanner.js\";\n\n/**\n * Represents a scanner for Environment sensors.\n * Extends the AntPlusScanner class to handle scanning and state updates for multiple environment sensors.\n */\nexport class EnvironmentScanner extends AntPlusScanner {\n    /**\n     * Returns the device type code for Environment sensors.\n     *\n     * @protected\n     * @returns {number} The device type code for Environment sensors.\n     */\n    protected deviceType(): number {\n        return EnvironmentSensor.deviceType;\n    }\n\n    /**\n     * A dictionary to store the states of detected Environment sensors by their device ID.\n     * @private\n     * @type {{ [id: number]: EnvironmentScanState }}\n     */\n    private states: { [id: number]: EnvironmentScanState } = {};\n\n    /**\n     * Creates a new state entry for a sensor if it does not already exist.\n     *\n     * @protected\n     * @param {number} deviceId - The unique identifier of the sensor device.\n     * @returns {void}\n     *\n     * @example\n     * scanner.createStateIfNew(12345); // Creates a new state for device ID 12345 if it does not exist.\n     */\n    protected createStateIfNew(deviceId: number): void {\n        if (!this.states[deviceId]) {\n            this.states[deviceId] = new EnvironmentScanState(deviceId);\n        }\n    }\n\n    /**\n     * Updates the RSSI (Received Signal Strength Indicator) and signal threshold for a specific sensor.\n     *\n     * @protected\n     * @param {number} deviceId - The unique identifier of the sensor device.\n     * @param {number} rssi - The received signal strength indicator of the device.\n     * @param {number} threshold - The signal threshold value for the device.\n     * @returns {void}\n     *\n     * @example\n     * scanner.updateRssiAndThreshold(12345, -70, 30); // Updates the RSSI and threshold for device ID 12345.\n     */\n    protected updateRssiAndThreshold(deviceId: number, rssi: number, threshold: number): void {\n        this.states[deviceId].Rssi = rssi;\n        this.states[deviceId].Threshold = threshold;\n    }\n\n    /**\n     * Updates the state of a sensor based on incoming data.\n     *\n     * @protected\n     * @param {number} deviceId - The unique identifier of the sensor device.\n     * @param {Buffer} data - The raw data buffer received from the sensor.\n     * @returns {void}\n     *\n     * @example\n     * const dataBuffer = getDataFromSensor(); // Assume this function gets data from a sensor\n     * scanner.updateState(12345, dataBuffer); // Updates the state for device ID 12345.\n     */\n    protected updateState(deviceId: number, data: Buffer): void {\n        updateState(this, this.states[deviceId], data);\n    }\n}\n"],"names":["Constants","static","Messages","resetSystem","payload","push","this","buildMessage","MESSAGE_SYSTEM_RESET","requestMessage","channel","messageId","concat","intToLEHexArray","MESSAGE_CHANNEL_REQUEST","setNetworkKey","DEFAULT_NETWORK_NUMBER","MESSAGE_NETWORK_KEY","assignChannel","type","CHANNEL_TYPE_TWOWAY_RECEIVE","CHANNEL_TYPE_ONEWAY_RECEIVE","CHANNEL_TYPE_SHARED_RECEIVE","CHANNEL_TYPE_TWOWAY_TRANSMIT","CHANNEL_TYPE_ONEWAY_TRANSMIT","Error","CHANNEL_TYPE_SHARED_TRANSMIT","MESSAGE_CHANNEL_ASSIGN","setDevice","deviceId","deviceType","transmissionType","MESSAGE_CHANNEL_ID","searchChannel","timeout","MESSAGE_CHANNEL_SEARCH_TIMEOUT","setPeriod","period","MESSAGE_CHANNEL_PERIOD","setFrequency","frequency","MESSAGE_CHANNEL_FREQUENCY","setRxExt","MESSAGE_ENABLE_RX_EXT","libConfig","how","MESSAGE_LIB_CONFIG","openRxScan","MESSAGE_CHANNEL_OPEN_RX_SCAN","openChannel","MESSAGE_CHANNEL_OPEN","closeChannel","MESSAGE_CHANNEL_CLOSE","unassignChannel","MESSAGE_CHANNEL_UNASSIGN","acknowledgedData","MESSAGE_CHANNEL_ACKNOWLEDGED_DATA","broadcastData","MESSAGE_CHANNEL_BROADCAST_DATA","message","MESSAGE_TX_SYNC","length","forEach","byte","getChecksum","Buffer","from","int","numBytes","a","b","decimalToHex","i","d","numDigits","hex","Number","toString","checksum","USBDriver","EventEmitter","idVendor","idProduct","device","iface","detachedKernelDriver","inEndpoint","outEndpoint","leftover","usedChannels","attachedSensors","maxChannels","canScan","constructor","debugOptions","super","setMaxListeners","usb","setDebugLevel","usbDebugLevel","getDevices","getDeviceList","filter","deviceDescriptor","deviceInUse","indexOf","isPresent","open","devices","shift","interfaces","isKernelDriverActive","detachKernelDriver","claim","close","undefined","endpoints","on","data","readUInt8","len","beginBlock","slice","endBlock","readData","read","err","console","error","startPoll","reset","openAsync","signal","controller","AbortController","addEventListener","abort","doOpen","Promise","resolve","reject","fn","then","removeListener","catch","aborted","setImmediate","emit","detach_all","stopPoll","release","attachKernelDriver","devIdx","splice","listenerCount","write","isScanning","attach","sensor","forScan","detach","idx","transfer","MESSAGE_STARTUP","MESSAGE_CAPABILITIES","MESSAGE_CHANNEL_EVENT","GarminStick2","GarminStick3","PageState","updateState","state","page","pageNum","BUFFER_INDEX_MSG_DATA","pageState","INIT_PAGE","STD_PAGE","oldPage","EXT_PAGE","OperatingTime","ManId","SerialNumber","DeviceId","readUInt16LE","HwVersion","SwVersion","ModelNum","PreviousBeat","IntervalAverage","IntervalMax","SessionAverage","SupportedFeatures","EnabledFeatures","batteryLevel","batteryFrac","batteryStatus","BatteryLevel","BatteryVoltage","batteryFlags","BatteryStatusBit","BatteryStatus","pucPayload","BeatTime","BeatCount","ComputedHeartRate","DecodeDefaultHRM","HeartRateSensorState","HeartRateScannerState","Rssi","Threshold","BaseSensor","stick","messageQueue","decodeDataCbk","statusCbk","handleEventMessages","bind","scan","onStatus","status","msg","MESSAGE_RF","code","EVENT_CHANNEL_CLOSED","EVENT_RX_FAIL_GO_TO_SEARCH","EVENT_TRANSFER_TX_COMPLETED","EVENT_TRANSFER_TX_FAILED","EVENT_RX_FAIL","INVALID_SCAN_TX_CHANNEL","mc","cbk","process","nextTick","TRANSFER_IN_PROGRESS","attachSensor","EVENT_CHANNEL_COLLISION","BUFFER_INDEX_MSG_TYPE","BUFFER_INDEX_CHANNEL_NUM","log","send","AntPlusBaseSensor","AntPlusSensor","decodeData","MESSAGE_CHANNEL_BURST_DATA","HeartRateSensor","AntPlusScanner","BUFFER_INDEX_EXT_MSG_BEGIN","createStateIfNew","updateRssiAndThreshold","readInt8","HeartRateScanner","states","pages","rssi","threshold","TimeFractional","TimeInteger","DistanceInteger","DistanceFractional","SpeedInteger","SpeedFractional","StrideCount","UpdateLatency","CadenceInteger","CadenceFractional","Status","Calories","StrideSpeedDistanceSensorState","StrideSpeedDistanceScanState","StrideSpeedDistanceSensor","StrideSpeedDistanceScanner","oldCadenceTime","CadenceEventTime","oldCadenceCount","CumulativeCadenceRevolutionCount","oldSpeedTime","SpeedEventTime","oldSpeedCount","CumulativeSpeedRevolutionCount","cadenceTime","cadenceCount","speedEventTime","speedRevolutionCount","cadence","isNaN","CalculatedCadence","distance","wheelCircumference","CalculatedDistance","speed","CalculatedSpeed","SpeedCadenceSensorState","SpeedCadenceScanState","SpeedCadenceSensor","setWheelCircumference","SpeedCadenceScanner","Motion","SpeedSensorState","SpeedScanState","SpeedSensor","SpeedScanner","CadenceSensorState","CadenceScanState","CadenceSensor","CadenceScanner","offset","pedalPower","PedalPower","RightPedalPower","LeftPedalPower","Cadence","AccumulatedPower","Power","oldEventCount","EventCount","oldTimeStamp","TimeStamp","oldTorqueTicksStamp","TorqueTicksStamp","eventCount","slope","timeStamp","torqueTicksStamp","Slope","elapsedTime","torqueTicks","cadencePeriod","Math","round","torque","CalculatedTorque","CalculatedPower","PI","BicyclePowerSensorState","BicyclePowerScanState","BicyclePowerSensor","BicyclePowerScanner","resetState","ElapsedTime","Distance","RealSpeed","VirtualSpeed","HeartRate","HeartRateSource","CycleLength","Incline","Resistance","METs","CaloricBurnRate","_EventCount0x19","_EventCount0x1A","InstantaneousPower","AveragePower","TrainerStatus","TargetStatus","AscendedDistance","DescendedDistance","Strides","Strokes","WheelTicks","WheelPeriod","Torque","temperature","Temperature","calBF","ZeroOffset","SpinDownTime","EquipmentType","heartRate","capStateBF","oldElapsedTime","oldDistance","State","cycleLen","incline","readInt16LE","resistance","mets","caloricbr","calories","negDistance","posDistance","flagStateBF","oldNegDistance","oldPosDistance","strides","power","oldStrides","strokes","oldStrokes","accPower","trainerStatus","oldAccPower","wheelTicks","accWheelPeriod","accTorque","oldWheelTicks","oldWheelPeriod","oldTorque","swRevSup","swRevMain","serial","readInt32LE","tot","chState","devId","devType","PairedDevices","id","paired","FitnessEquipmentSensorState","FitnessEquipmentScanState","FitnessEquipmentSensor","setUserConfigurationInternal","userWeight","bikeWeight","wheelDiameter","gearRatio","m","max","min","df","mb","setUserConfiguration","userWeightOrCallback","setBasicResistance","setTargetPower","p","setWindResistanceInternal","windCoeff","windSpeed","draftFactor","setWindResistance","windCoeffOrCallback","setTrackResistanceInternal","rollingResistanceCoeff","s","setTrackResistance","slopeOrCallback","FitnessEquipmentScanner","_EventCount","notifications","capabilities","total","previous","current","UTCTimeRequired","SupportANTFS","MeasurementInterval","TotalHemoglobinConcentration","PreviousSaturatedHemoglobinPercentage","CurrentSaturatedHemoglobinPercentage","operatingTime","readUInt32LE","MuscleOxygenSensorState","MuscleOxygenScanState","MuscleOxygenSensor","_sendTimeCmd","cmd","now","Date","utc","getTime","UTC","getTimezoneOffset","setUTCTime","startSession","stopSession","setLap","MuscleOxygenScanner","EnvironmentSensorState","EnvironmentScanState","EnvironmentSensor","EnvironmentScanner"],"mappings":"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"}